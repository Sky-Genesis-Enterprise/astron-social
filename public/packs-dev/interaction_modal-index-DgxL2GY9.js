import{j as e}from"./client-BG6VvM0b.js";import{g as Y,r as s,u as J,d as Q}from"./index-ykyyQSL-.js";import{c as I}from"./index-guCj-HqV.js";import{a as Z}from"./toString-CBWlLvSL.js";import{c as ee}from"./index.module-CVExFLDO.js";import{S as ae}from"./insert_chart-Ii2pHaWX.js";import{S as te}from"./person_add-BFk09DvP.js";import{u as oe,a as T,ak as ie,o as ne,I as v,w as se,ab as re,aT as ue}from"./useSelectableClick-DBo53LOf.js";import{d as me}from"./api-uqk9CYtW.js";import{B as le}from"./index-JeRepxZU.js";import{d as de,a as L,r as ce}from"./initial_state-BP3UcUr4.js";import{M as l}from"./message-Bb0z64dP.js";import"./index-DHslUCy5.js";import"./ready-DpOgoWSg.js";import"./short_number--sxn3OKQ.js";import"./numbers-CGZQWBYL.js";import"./load_locale-C-B7BkCQ.js";import"./index-lj9VQs0f.js";var w,O;function fe(){if(O)return w;O=1;var a=Z(),o=/[\\^$.*+?()[\]{}|]/g,n=RegExp(o.source);function d(f){return f=a(f),f&&n.test(f)?f.replace(o,"\\$&"):f}return w=d,w}var pe=fe();const he=Y(pe),A=Q({loginPrompt:{id:"interaction_modal.username_prompt",defaultMessage:"E.g. {example}"}}),U="mastodon_home",F="username@mastodon.social",be=a=>{const o=new URL("https:///path");return o.hostname=a,o.hostname===a},D=a=>{if(/^https?:\/\//.test(a))try{return new URL(a).host}catch{return null}else if(a.includes("@")){const[o,n,...d]=a.replace(/^@/,"").split("@");return!n||d.length>0?null:D(n)}return a},P=(a,o)=>(a=a.trim(),a.includes(".")&&be(a)?[a].concat(o.filter(n=>n!==a)):o),xe=a=>{let o=!1,n=null;if(a.startsWith("/"))return!1;if(a.startsWith("@")&&(a=a.slice(1),o=!0),a==="")return!0;/^https?:\/\//.test(a)&&!o?n=a:n=`https://${a}`;try{return new URL(n),!0}catch{return!1}},y=(a,o)=>{var n;if(D(o.trim())===de){window.location.href="/auth/sign_in";return}(n=a==null?void 0:a.contentWindow)==null||n.postMessage({type:"fetchInteractionURL",uri_or_domain:o.trim()},window.origin)},Ne=({resourceUrl:a})=>{const o=J(),[n,d]=s.useState(localStorage.getItem(U)??""),[f,g]=s.useState(!1),[p,x]=s.useState(-1),[b,u]=s.useState(!1),[h,m]=s.useState(!1),[c,N]=s.useState([]),[R,S]=s.useState([]),[q,M]=s.useState(!1),W=s.useRef(null),_=s.useRef(null),j=s.useRef(null);s.useEffect(()=>{const i=t=>{var r;if(!(t.origin!==window.origin||t.source!==((r=_.current)==null?void 0:r.contentWindow))){if(t.data.type==="fetchInteractionURL-failure")u(!1),m(!0);else if(t.data.type==="fetchInteractionURL-success")if(t.data.template&&/^https?:\/\//.test(t.data.template))try{const E=new URL(t.data.template.replace("{uri}",encodeURIComponent(a)));localStorage.setItem(U,t.data.uri_or_domain),window.location.href=E.toString()}catch{u(!1),m(!0)}else u(!1),m(!0)}};return window.addEventListener("message",i),()=>{window.removeEventListener("message",i)}},[a,u,m]);const C=ee(i=>{j.current&&j.current.abort();const t=D(i.trim());if(t===null||t.length===0){N([]),S([]);return}j.current=new AbortController,me("GET","v1/peers/search",{signal:j.current.signal,params:{q:t}}).then(r=>(S(r??[]),N(P(i,r??[])),"")).catch(()=>{})},500,{leading:!0,trailing:!0}),$=s.useCallback(({target:{value:i}})=>{d(i),M(!0),m(!xe(i)),N(P(i,R)),C(i)},[m,d,M,N,R,C]),V=s.useCallback(()=>{u(!0),y(_.current,n)},[u,n]),G=s.useCallback(()=>{g(!0)},[g]),H=s.useCallback(()=>{g(!1)},[g]),K=s.useCallback(i=>{const t=c[p];switch(i.key){case"ArrowDown":i.preventDefault(),c.length>0&&x(r=>Math.min(r+1,c.length-1));break;case"ArrowUp":i.preventDefault(),c.length>0&&x(r=>Math.max(r-1,-1));break;case"Enter":i.preventDefault(),p===-1?V():c.length>0&&t&&(m(!1),d(t),u(!0),y(_.current,t));break}},[V,x,m,d,p,c]),z=s.useCallback(i=>{i.preventDefault();const t=Number(i.currentTarget.getAttribute("data-index")),r=c[t];r&&(x(t),d(r),m(!1),u(!0),y(_.current,r))},[c,x,d,m]),B=(D(n)??"").trim(),X=new RegExp(`(${he(B)})`,"gi"),k=q&&B.length>0&&c.length>0;return e.jsxDEV("div",{className:I("interaction-modal__login",{focused:f,expanded:k,invalid:h}),children:[e.jsxDEV("iframe",{ref:_,style:{display:"none"},src:"/remote_interaction_helper",sandbox:"allow-scripts allow-same-origin",title:"remote interaction helper"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:343,columnNumber:7},void 0),e.jsxDEV("div",{className:"interaction-modal__login__input",children:[e.jsxDEV("input",{ref:W,type:"text",value:n,placeholder:o.formatMessage(A.loginPrompt,{example:F}),"aria-label":o.formatMessage(A.loginPrompt,{example:F}),autoFocus:!0,onChange:$,onFocus:G,onBlur:H,onKeyDown:K,autoComplete:"off",autoCapitalize:"off",spellCheck:"false"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:352,columnNumber:9},void 0),e.jsxDEV(le,{onClick:V,disabled:b||h,children:e.jsxDEV(l,{id:"interaction_modal.go",defaultMessage:"Go"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:374,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:373,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:351,columnNumber:7},void 0),k&&e.jsxDEV("div",{className:"search__popout",children:e.jsxDEV("div",{className:"search__popout__menu",children:c.map((i,t)=>e.jsxDEV("button",{onMouseDown:z,"data-index":t,className:I("search__popout__menu__item",{selected:p===t}),children:i.split(X).map((r,E)=>r.toLowerCase()===B.toLowerCase()?e.jsxDEV("mark",{children:r},E,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:394,columnNumber:13},void 0):e.jsxDEV("span",{children:r},E,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:396,columnNumber:13},void 0))},i,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:382,columnNumber:11},void 0))},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:380,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:379,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:336,columnNumber:5},void 0)},Oe=({accountId:a,url:o,type:n})=>{const d=oe(),f=T(c=>{var N;return((N=c.accounts.get(a))==null?void 0:N.display_name_html)??""}),g=T(c=>c.server.getIn(["server","registrations","url"],null)||"/auth/sign_up"),p=e.jsxDEV("bdi",{dangerouslySetInnerHTML:{__html:f}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:422,columnNumber:16},void 0),x=s.useCallback(()=>{d(ie({modalType:void 0,ignoreFocus:!1})),d(ne({modalType:"CLOSED_REGISTRATIONS",modalProps:{}}))},[d]);let b,u,h;switch(n){case"reply":u=e.jsxDEV(v,{id:"reply",icon:ue},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:446,columnNumber:14},void 0),b=e.jsxDEV(l,{id:"interaction_modal.title.reply",defaultMessage:"Reply to {name}'s post",values:{name:p}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:448,columnNumber:7},void 0),h=e.jsxDEV(l,{id:"interaction_modal.action.reply",defaultMessage:"To continue, you need to reply from your account."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:455,columnNumber:7},void 0);break;case"reblog":u=e.jsxDEV(v,{id:"retweet",icon:re},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:462,columnNumber:14},void 0),b=e.jsxDEV(l,{id:"interaction_modal.title.reblog",defaultMessage:"Boost {name}'s post",values:{name:p}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:464,columnNumber:7},void 0),h=e.jsxDEV(l,{id:"interaction_modal.action.reblog",defaultMessage:"To continue, you need to reblog from your account."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:471,columnNumber:7},void 0);break;case"favourite":u=e.jsxDEV(v,{id:"star",icon:se},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:478,columnNumber:14},void 0),b=e.jsxDEV(l,{id:"interaction_modal.title.favourite",defaultMessage:"Favorite {name}'s post",values:{name:p}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:480,columnNumber:7},void 0),h=e.jsxDEV(l,{id:"interaction_modal.action.favourite",defaultMessage:"To continue, you need to favorite from your account."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:487,columnNumber:7},void 0);break;case"follow":u=e.jsxDEV(v,{id:"user-plus",icon:te},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:494,columnNumber:14},void 0),b=e.jsxDEV(l,{id:"interaction_modal.title.follow",defaultMessage:"Follow {name}",values:{name:p}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:496,columnNumber:7},void 0),h=e.jsxDEV(l,{id:"interaction_modal.action.follow",defaultMessage:"To continue, you need to follow from your account."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:503,columnNumber:7},void 0);break;case"vote":u=e.jsxDEV(v,{id:"tasks",icon:ae},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:510,columnNumber:14},void 0),b=e.jsxDEV(l,{id:"interaction_modal.title.vote",defaultMessage:"Vote in {name}'s poll",values:{name:p}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:512,columnNumber:7},void 0),h=e.jsxDEV(l,{id:"interaction_modal.action.vote",defaultMessage:"To continue, you need to vote from your account."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:519,columnNumber:7},void 0);break}let m;return L?m=e.jsxDEV("a",{href:L,"data-method":"post",className:"link-button",children:e.jsxDEV(l,{id:"sign_in_banner.create_account",defaultMessage:"Create account"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:532,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:531,columnNumber:5},void 0):ce?m=e.jsxDEV("a",{href:g,className:"link-button",children:e.jsxDEV(l,{id:"sign_in_banner.create_account",defaultMessage:"Create account"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:541,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:540,columnNumber:5},void 0):m=e.jsxDEV("button",{className:"link-button",onClick:x,children:e.jsxDEV(l,{id:"sign_in_banner.create_account",defaultMessage:"Create account"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:550,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:549,columnNumber:5},void 0),e.jsxDEV("div",{className:"modal-root__modal interaction-modal",children:[e.jsxDEV("div",{className:"interaction-modal__lead",children:[e.jsxDEV("h3",{children:[e.jsxDEV("span",{className:"interaction-modal__icon",children:u},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:562,columnNumber:11},void 0)," ",b]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:561,columnNumber:9},void 0),e.jsxDEV("p",{children:h},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:564,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:560,columnNumber:7},void 0),e.jsxDEV(Ne,{resourceUrl:o},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:567,columnNumber:7},void 0),e.jsxDEV("p",{children:[e.jsxDEV(l,{id:"interaction_modal.no_account_yet",defaultMessage:"Don't have an account yet?"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:570,columnNumber:9},void 0)," ",m]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:569,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/interaction_modal/index.tsx",lineNumber:559,columnNumber:5},void 0)};export{Oe as default};
//# sourceMappingURL=interaction_modal-index-DgxL2GY9.js.map
