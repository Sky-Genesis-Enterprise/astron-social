import{j as o}from"./client-BG6VvM0b.js";import{u as B,r as i,d as w}from"./index-ykyyQSL-.js";import{c as V}from"./index-guCj-HqV.js";import{bh as M,bi as P,bj as R,bk as S,a as T,d as F,u as O,o as A,bl as I,bm as H,g as L,I as $,S as q,i as G}from"./useSelectableClick-DBo53LOf.js";import{c as K,b as z}from"./api-uqk9CYtW.js";import{R as J,e as W}from"./index-DHslUCy5.js";import{M as N}from"./message-Bb0z64dP.js";const Y=a=>z(`v1/polls/${a}`),Q=(a,s)=>K(`v1/polls/${a}/votes`,{choices:s}),C=P("poll/importFetched",(a,{dispatch:s,getState:u})=>{const{poll:t}=a;s(R({polls:[S(t,u().polls[t.id])]}))}),U=M("poll/vote",({pollId:a,choices:s})=>Q(a,s),async(a,{dispatch:s,discardLoadData:u})=>(await s(C({poll:a})),u)),X=M("poll/fetch",({pollId:a})=>Y(a),async(a,{dispatch:s})=>{await s(C({poll:a}))}),k=w({closed:{id:"poll.closed",defaultMessage:"Closed"},voted:{id:"poll.voted",defaultMessage:"You voted for this answer"},votes:{id:"poll.votes",defaultMessage:"{votes, plural, one {# vote} other {# votes}}"}}),ie=({pollId:a,disabled:s,status:u})=>{const t=T(e=>e.polls[a]),n=F(),l=B(),m=O(),[d,c]=i.useState(!1),[f,h]=i.useState({}),v=i.useMemo(()=>{if(!t)return!1;const e=t.expires_at;return t.expired||new Date(e).getTime()<Date.now()},[t]),x=i.useMemo(()=>t?v?l.formatMessage(k.closed):o.jsxDEV(J,{timestamp:t.expires_at,futureDate:!0},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:72,columnNumber:12},void 0):null,[v,l,t]),j=i.useMemo(()=>t?t.voters_count?o.jsxDEV(N,{id:"poll.total_people",defaultMessage:"{count, plural, one {# person} other {# people}}",values:{count:t.voters_count}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:80,columnNumber:9},void 0):o.jsxDEV(N,{id:"poll.total_votes",defaultMessage:"{count, plural, one {# vote} other {# votes}}",values:{count:t.votes_count}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:88,columnNumber:7},void 0):null,[t]),b=s||Object.values(f).every(e=>!e),_=i.useCallback(()=>{b||(n.signedIn?m(U({pollId:a,choices:Object.keys(f)})):m(A({modalType:"INTERACTION",modalProps:{type:"vote",accountId:u.getIn(["account","id"]),url:u.get("uri")}})))},[b,m,n,a,f,u]),D=i.useCallback(()=>{c(!0)},[]),E=i.useCallback(()=>{s||m(X({pollId:a}))},[s,m,a]),g=i.useCallback(e=>{t&&(t.multiple?h(r=>({...r,[e]:!r[e]})):h({[e]:!0}))},[t]);if(!t)return null;const p=t.voted||d||v;return o.jsxDEV("div",{className:"poll",children:[o.jsxDEV("ul",{children:t.options.map((e,r)=>o.jsxDEV(Z,{index:r,poll:t,option:e,showResults:p,active:!!f[r],onChange:g},e.title||r,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:158,columnNumber:9},void 0))},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:156,columnNumber:7},void 0),o.jsxDEV("div",{className:"poll__footer",children:[!p&&o.jsxDEV("button",{className:"button button-secondary",disabled:b,onClick:_,children:o.jsxDEV(N,{id:"poll.vote",defaultMessage:"Vote"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:177,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:172,columnNumber:9},void 0),!p&&o.jsxDEV(o.Fragment,{children:[o.jsxDEV("button",{className:"poll__link",onClick:D,children:o.jsxDEV(N,{id:"poll.reveal",defaultMessage:"See results"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:183,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:182,columnNumber:13},void 0)," ","·"," "]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:181,columnNumber:9},void 0),p&&!s&&o.jsxDEV(o.Fragment,{children:[o.jsxDEV("button",{className:"poll__link",onClick:E,children:o.jsxDEV(N,{id:"poll.refresh",defaultMessage:"Refresh"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:191,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:190,columnNumber:13},void 0)," ","·"," "]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:189,columnNumber:9},void 0),j,t.expires_at&&o.jsxDEV(o.Fragment,{children:[" · ",x]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:197,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:170,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:155,columnNumber:5},void 0)},Z=a=>{var g,p;const{active:s,lang:u,disabled:t,poll:n,option:l,index:m,showResults:d,onChange:c}=a,f=l.voted||((g=n.own_votes)==null?void 0:g.includes(m)),h=((p=l.translation)==null?void 0:p.title)??l.title,v=B(),x=i.useMemo(()=>{const e=n.voters_count??n.votes_count;return e===0?0:l.votes_count/e*100},[l,n]),j=i.useMemo(()=>n.options.filter(e=>e.title!==l.title).every(e=>l.votes_count>=e.votes_count),[n,l]),b=i.useMemo(()=>{var r;let e=((r=l.translation)==null?void 0:r.titleHtml)??l.titleHtml;if(!e){const y=I(n.emojis);e=W(H(h),y)}return e},[l,n,h]),_=i.useCallback(()=>{c(m)},[m,c]),D=i.useCallback(e=>{(e.key==="Enter"||e.key===" ")&&(c(m),e.stopPropagation(),e.preventDefault())},[m,c]),E=L({from:{width:"0%"},to:{width:`${x}%`}});return o.jsxDEV("li",{children:[o.jsxDEV("label",{className:V("poll__option",{selectable:!d}),children:[o.jsxDEV("input",{name:"vote-options",type:n.multiple?"checkbox":"radio",value:m,checked:s,onChange:_,disabled:t},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:274,columnNumber:9},void 0),!d&&o.jsxDEV("span",{className:V("poll__input",{checkbox:n.multiple,active:s}),tabIndex:0,role:n.multiple?"checkbox":"radio",onKeyDown:D,"aria-checked":s,"aria-label":h,lang:u,"data-index":m},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:284,columnNumber:9},void 0),d&&o.jsxDEV("span",{className:"poll__number",title:v.formatMessage(k.votes,{votes:l.votes_count}),children:[Math.round(x),"%"]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:299,columnNumber:9},void 0),o.jsxDEV("span",{className:"poll__option__text translate",lang:u,dangerouslySetInnerHTML:{__html:b}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:309,columnNumber:9},void 0),!!f&&o.jsxDEV("span",{className:"poll__voted",children:o.jsxDEV($,{id:"check",icon:q,className:"poll__voted__mark",title:v.formatMessage(k.voted)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:317,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:316,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:271,columnNumber:7},void 0),d&&o.jsxDEV(G.span,{className:V("poll__chart",{leading:j}),style:E},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:328,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/poll.tsx",lineNumber:270,columnNumber:5},void 0)};export{ie as P};
//# sourceMappingURL=poll-wjP7LpZg.js.map
