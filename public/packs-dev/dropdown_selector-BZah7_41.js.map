{"version":3,"file":"dropdown_selector-BZah7_41.js","sources":["../../app/javascript/mastodon/components/dropdown_selector.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\n\nimport classNames from 'classnames';\n\nimport { supportsPassiveEvents } from 'detect-passive-events';\n\nimport InfoIcon from '@/material-icons/400-24px/info.svg?react';\n\nimport type { IconProp } from './icon';\nimport { Icon } from './icon';\n\nconst listenerOptions = supportsPassiveEvents\n  ? { passive: true, capture: true }\n  : true;\n\nexport interface SelectItem {\n  value: string;\n  icon?: string;\n  iconComponent?: IconProp;\n  text: string;\n  meta?: string;\n  extra?: string;\n}\n\ninterface Props {\n  value: string;\n  classNamePrefix: string;\n  style?: React.CSSProperties;\n  items: SelectItem[];\n  onChange: (value: string) => void;\n  onClose: () => void;\n}\n\nexport const DropdownSelector: React.FC<Props> = ({\n  style,\n  items,\n  value,\n  classNamePrefix = 'privacy-dropdown',\n  onClose,\n  onChange,\n}) => {\n  const nodeRef = useRef<HTMLUListElement>(null);\n  const focusedItemRef = useRef<HTMLLIElement>(null);\n  const [currentValue, setCurrentValue] = useState(value);\n\n  const handleDocumentClick = useCallback(\n    (e: MouseEvent | TouchEvent) => {\n      if (\n        nodeRef.current &&\n        e.target instanceof Node &&\n        !nodeRef.current.contains(e.target)\n      ) {\n        onClose();\n        e.stopPropagation();\n      }\n    },\n    [nodeRef, onClose],\n  );\n\n  const handleClick = useCallback(\n    (\n      e: React.MouseEvent<HTMLLIElement> | React.KeyboardEvent<HTMLLIElement>,\n    ) => {\n      const value = e.currentTarget.getAttribute('data-index');\n\n      e.preventDefault();\n\n      onClose();\n      if (value) onChange(value);\n    },\n    [onClose, onChange],\n  );\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLLIElement>) => {\n      const value = e.currentTarget.getAttribute('data-index');\n      const index = items.findIndex((item) => item.value === value);\n\n      let element: Element | null | undefined = null;\n\n      switch (e.key) {\n        case 'Escape':\n          onClose();\n          break;\n        case ' ':\n        case 'Enter':\n          handleClick(e);\n          break;\n        case 'ArrowDown':\n          element =\n            nodeRef.current?.children[index + 1] ??\n            nodeRef.current?.firstElementChild;\n          break;\n        case 'ArrowUp':\n          element =\n            nodeRef.current?.children[index - 1] ??\n            nodeRef.current?.lastElementChild;\n          break;\n        case 'Tab':\n          if (e.shiftKey) {\n            element =\n              nodeRef.current?.children[index + 1] ??\n              nodeRef.current?.firstElementChild;\n          } else {\n            element =\n              nodeRef.current?.children[index - 1] ??\n              nodeRef.current?.lastElementChild;\n          }\n          break;\n        case 'Home':\n          element = nodeRef.current?.firstElementChild;\n          break;\n        case 'End':\n          element = nodeRef.current?.lastElementChild;\n          break;\n      }\n\n      if (element && element instanceof HTMLElement) {\n        const selectedValue = element.getAttribute('data-index');\n        element.focus();\n        if (selectedValue) setCurrentValue(selectedValue);\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    },\n    [nodeRef, items, onClose, handleClick, setCurrentValue],\n  );\n\n  useEffect(() => {\n    document.addEventListener('click', handleDocumentClick, { capture: true });\n    document.addEventListener('touchend', handleDocumentClick, listenerOptions);\n    focusedItemRef.current?.focus({ preventScroll: true });\n\n    return () => {\n      document.removeEventListener('click', handleDocumentClick, {\n        capture: true,\n      });\n      document.removeEventListener(\n        'touchend',\n        handleDocumentClick,\n        listenerOptions,\n      );\n    };\n  }, [handleDocumentClick]);\n\n  return (\n    <ul style={style} role='listbox' ref={nodeRef}>\n      {items.map((item) => (\n        <li\n          role='option'\n          tabIndex={0}\n          key={item.value}\n          data-index={item.value}\n          onKeyDown={handleKeyDown}\n          onClick={handleClick}\n          className={classNames(`${classNamePrefix}__option`, {\n            active: item.value === currentValue,\n          })}\n          aria-selected={item.value === currentValue}\n          ref={item.value === currentValue ? focusedItemRef : null}\n        >\n          {item.icon && item.iconComponent && (\n            <div className={`${classNamePrefix}__option__icon`}>\n              <Icon id={item.icon} icon={item.iconComponent} />\n            </div>\n          )}\n\n          <div className={`${classNamePrefix}__option__content`}>\n            <strong>{item.text}</strong>\n            {item.meta}\n          </div>\n\n          {item.extra && (\n            <div\n              className={`${classNamePrefix}__option__additional`}\n              title={item.extra}\n            >\n              <Icon id='info-circle' icon={InfoIcon} />\n            </div>\n          )}\n        </li>\n      ))}\n    </ul>\n  );\n};\n"],"names":["listenerOptions","supportsPassiveEvents","passive","capture","DropdownSelector","style","items","value","classNamePrefix","onClose","onChange","nodeRef","useRef","focusedItemRef","currentValue","setCurrentValue","useState","handleDocumentClick","useCallback","e","current","target","Node","contains","stopPropagation","handleClick","currentTarget","getAttribute","preventDefault","handleKeyDown","index","findIndex","item","element","key","children","firstElementChild","lastElementChild","shiftKey","HTMLElement","selectedValue","focus","useEffect","document","addEventListener","preventScroll","removeEventListener","map","jsxDEV","classNames","active","icon","iconComponent","Icon","this","text","meta","extra","InfoIcon"],"mappings":"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"}