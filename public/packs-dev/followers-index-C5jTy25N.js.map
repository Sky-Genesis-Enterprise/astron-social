{"version":3,"file":"followers-index-C5jTy25N.js","sources":["../../app/javascript/mastodon/features/followers/index.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\n\nimport { FormattedMessage } from 'react-intl';\n\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\nimport { connect } from 'react-redux';\n\nimport { debounce } from 'lodash';\n\nimport { Account } from 'mastodon/components/account';\nimport { TimelineHint } from 'mastodon/components/timeline_hint';\nimport { AccountHeader } from 'mastodon/features/account_timeline/components/account_header';\nimport BundleColumnError from 'mastodon/features/ui/components/bundle_column_error';\nimport { normalizeForLookup } from 'mastodon/reducers/accounts_map';\nimport { getAccountHidden } from 'mastodon/selectors/accounts';\nimport { useAppSelector } from 'mastodon/store';\n\nimport {\n  lookupAccount,\n  fetchAccount,\n  fetchFollowers,\n  expandFollowers,\n} from '../../actions/accounts';\nimport { ColumnBackButton } from '../../components/column_back_button';\nimport { LoadingIndicator } from '../../components/loading_indicator';\nimport ScrollableList from '../../components/scrollable_list';\nimport { LimitedAccountHint } from '../account_timeline/components/limited_account_hint';\nimport Column from '../ui/components/column';\n\nconst mapStateToProps = (state, { params: { acct, id } }) => {\n  const accountId = id || state.accounts_map[normalizeForLookup(acct)];\n\n  if (!accountId) {\n    return {\n      isLoading: true,\n    };\n  }\n\n  return {\n    accountId,\n    remote: !!(state.getIn(['accounts', accountId, 'acct']) !== state.getIn(['accounts', accountId, 'username'])),\n    remoteUrl: state.getIn(['accounts', accountId, 'url']),\n    isAccount: !!state.getIn(['accounts', accountId]),\n    accountIds: state.getIn(['user_lists', 'followers', accountId, 'items']),\n    hasMore: !!state.getIn(['user_lists', 'followers', accountId, 'next']),\n    isLoading: state.getIn(['user_lists', 'followers', accountId, 'isLoading'], true),\n    suspended: state.getIn(['accounts', accountId, 'suspended'], false),\n    hideCollections: state.getIn(['accounts', accountId, 'hide_collections'], false),\n    hidden: getAccountHidden(state, accountId),\n    blockedBy: state.getIn(['relationships', accountId, 'blocked_by'], false),\n  };\n};\n\nconst RemoteHint = ({ accountId, url }) => {\n  const acct = useAppSelector(state => state.accounts.get(accountId)?.acct);\n  const domain = acct ? acct.split('@')[1] : undefined;\n\n  return (\n    <TimelineHint\n      url={url}\n      message={<FormattedMessage id='hints.profiles.followers_may_be_missing' defaultMessage='Followers for this profile may be missing.' />}\n      label={<FormattedMessage id='hints.profiles.see_more_followers' defaultMessage='See more followers on {domain}' values={{ domain: <strong>{domain}</strong> }} />}\n    />\n  );\n};\n\nRemoteHint.propTypes = {\n  url: PropTypes.string.isRequired,\n  accountId: PropTypes.string.isRequired,\n};\n\nclass Followers extends ImmutablePureComponent {\n\n  static propTypes = {\n    params: PropTypes.shape({\n      acct: PropTypes.string,\n      id: PropTypes.string,\n    }).isRequired,\n    accountId: PropTypes.string,\n    dispatch: PropTypes.func.isRequired,\n    accountIds: ImmutablePropTypes.list,\n    hasMore: PropTypes.bool,\n    isLoading: PropTypes.bool,\n    blockedBy: PropTypes.bool,\n    isAccount: PropTypes.bool,\n    suspended: PropTypes.bool,\n    hidden: PropTypes.bool,\n    remote: PropTypes.bool,\n    remoteUrl: PropTypes.string,\n    multiColumn: PropTypes.bool,\n  };\n\n  _load () {\n    const { accountId, isAccount, dispatch } = this.props;\n\n    if (!isAccount) dispatch(fetchAccount(accountId));\n    dispatch(fetchFollowers(accountId));\n  }\n\n  componentDidMount () {\n    const { params: { acct }, accountId, dispatch } = this.props;\n\n    if (accountId) {\n      this._load();\n    } else {\n      dispatch(lookupAccount(acct));\n    }\n  }\n\n  componentDidUpdate (prevProps) {\n    const { params: { acct }, accountId, dispatch } = this.props;\n\n    if (prevProps.accountId !== accountId && accountId) {\n      this._load();\n    } else if (prevProps.params.acct !== acct) {\n      dispatch(lookupAccount(acct));\n    }\n  }\n\n  handleLoadMore = debounce(() => {\n    this.props.dispatch(expandFollowers(this.props.accountId));\n  }, 300, { leading: true });\n\n  render () {\n    const { accountId, accountIds, hasMore, blockedBy, isAccount, multiColumn, isLoading, suspended, hidden, remote, remoteUrl, hideCollections } = this.props;\n\n    if (!isAccount) {\n      return (\n        <BundleColumnError multiColumn={multiColumn} errorType='routing' />\n      );\n    }\n\n    if (!accountIds) {\n      return (\n        <Column>\n          <LoadingIndicator />\n        </Column>\n      );\n    }\n\n    let emptyMessage;\n\n    const forceEmptyState = blockedBy || suspended || hidden;\n\n    if (suspended) {\n      emptyMessage = <FormattedMessage id='empty_column.account_suspended' defaultMessage='Account suspended' />;\n    } else if (hidden) {\n      emptyMessage = <LimitedAccountHint accountId={accountId} />;\n    } else if (blockedBy) {\n      emptyMessage = <FormattedMessage id='empty_column.account_unavailable' defaultMessage='Profile unavailable' />;\n    } else if (hideCollections && accountIds.isEmpty()) {\n      emptyMessage = <FormattedMessage id='empty_column.account_hides_collections' defaultMessage='This user has chosen to not make this information available' />;\n    } else if (remote && accountIds.isEmpty()) {\n      emptyMessage = <RemoteHint accountId={accountId} url={remoteUrl} />;\n    } else {\n      emptyMessage = <FormattedMessage id='account.followers.empty' defaultMessage='No one follows this user yet.' />;\n    }\n\n    const remoteMessage = remote ? <RemoteHint accountId={accountId} url={remoteUrl} /> : null;\n\n    return (\n      <Column>\n        <ColumnBackButton />\n\n        <ScrollableList\n          scrollKey='followers'\n          hasMore={!forceEmptyState && hasMore}\n          isLoading={isLoading}\n          onLoadMore={this.handleLoadMore}\n          prepend={<AccountHeader accountId={this.props.accountId} hideTabs />}\n          alwaysPrepend\n          append={remoteMessage}\n          emptyMessage={emptyMessage}\n          bindToDocument={!multiColumn}\n        >\n          {forceEmptyState ? [] : accountIds.map(id =>\n            <Account key={id} id={id} />,\n          )}\n        </ScrollableList>\n      </Column>\n    );\n  }\n\n}\n\nexport default connect(mapStateToProps)(Followers);\n"],"names":["mapStateToProps","state","params","acct","id","accountId","accounts_map","normalizeForLookup","remote","getIn","remoteUrl","isAccount","accountIds","hasMore","isLoading","suspended","hideCollections","hidden","getAccountHidden","blockedBy","RemoteHint","url","useAppSelector","accounts","get","domain","split","undefined","jsxDEV","TimelineHint","FormattedMessage","this","Followers","ImmutablePureComponent","handleLoadMore","debounce","props","dispatch","expandFollowers","leading","_load","fetchAccount","fetchFollowers","componentDidMount","lookupAccount","componentDidUpdate","prevProps","render","multiColumn","BundleColumnError","Column","LoadingIndicator","emptyMessage","forceEmptyState","LimitedAccountHint","isEmpty","remoteMessage","ColumnBackButton","ScrollableList","AccountHeader","map","Account","__publicField","propTypes","PropTypes","shape","string","isRequired","func","ImmutablePropTypes","list","bool","index","connect"],"mappings":"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"}