var j=Object.defineProperty;var x=(r,l,e)=>l in r?j(r,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[l]=e;var i=(r,l,e)=>x(r,typeof l!="symbol"?l+"":l,e);import{j as t}from"./client-BG6VvM0b.js";import{P as n}from"./short_number--sxn3OKQ.js";import{r as f,i as p,d as N}from"./index-ykyyQSL-.js";import{j as c,I as v,y as D,a2 as w,dV as V,dW as B,dX as E,b as S}from"./useSelectableClick-DBo53LOf.js";import{S as y}from"./close-DPVxbBbs.js";import{B as C}from"./index-JeRepxZU.js";import{ap as b}from"./content_warning-ZcoJE_cd.js";import{M as o}from"./message-Bb0z64dP.js";import{f as F}from"./fuzzysort-CBu_fJo_.js";import{S as M}from"./add-ZanakRnh.js";import"./numbers-CGZQWBYL.js";import"./api-uqk9CYtW.js";import"./index-lj9VQs0f.js";import"./initial_state-BP3UcUr4.js";import"./ready-DpOgoWSg.js";import"./index-DHslUCy5.js";import"./load_locale-C-B7BkCQ.js";import"./index-guCj-HqV.js";import"./skeleton-_5CK2hDo.js";const k=(r,{filterId:l})=>({filter:r.getIn(["filters",l])});class I extends f.PureComponent{constructor(){super(...arguments);i(this,"handleCloseClick",()=>{const{onClose:e}=this.props;e()})}render(){const{filter:e,contextType:a}=this.props;let s=null;e.get("expires_at")&&e.get("expires_at")<new Date&&(s=t.jsxDEV(t.Fragment,{children:[t.jsxDEV("h4",{className:"report-dialog-modal__subtitle",children:t.jsxDEV(o,{id:"filter_modal.added.expired_title",defaultMessage:"Expired filter!"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:37,columnNumber:57},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:37,columnNumber:11},this),t.jsxDEV("p",{className:"report-dialog-modal__lead",children:t.jsxDEV(o,{id:"filter_modal.added.expired_explanation",defaultMessage:"This filter category has expired, you will need to change the expiration date for it to apply."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:39,columnNumber:13},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:38,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:36,columnNumber:7},this));let m=null;a&&!e.get("context").includes(b(a))&&(m=t.jsxDEV(t.Fragment,{children:[t.jsxDEV("h4",{className:"report-dialog-modal__subtitle",children:t.jsxDEV(o,{id:"filter_modal.added.context_mismatch_title",defaultMessage:"Context mismatch!"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:52,columnNumber:57},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:52,columnNumber:11},this),t.jsxDEV("p",{className:"report-dialog-modal__lead",children:t.jsxDEV(o,{id:"filter_modal.added.context_mismatch_explanation",defaultMessage:"This filter category does not apply to the context in which you have accessed this post. If you want the post to be filtered in this context too, you will have to edit the filter."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:54,columnNumber:13},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:53,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:51,columnNumber:7},this));const u=t.jsxDEV("a",{href:`/filters/${e.get("id")}/edit`,children:t.jsxDEV(o,{id:"filter_modal.added.settings_link",defaultMessage:"settings page"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:65,columnNumber:9},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:64,columnNumber:5},this);return t.jsxDEV(t.Fragment,{children:[t.jsxDEV("h3",{className:"report-dialog-modal__title",children:t.jsxDEV(o,{id:"filter_modal.added.title",defaultMessage:"Filter added!"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:74,columnNumber:52},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:74,columnNumber:9},this),t.jsxDEV("p",{className:"report-dialog-modal__lead",children:t.jsxDEV(o,{id:"filter_modal.added.short_explanation",defaultMessage:"This post has been added to the following filter category: {title}.",values:{title:e.get("title")}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:76,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:75,columnNumber:9},this),s,m,t.jsxDEV("h4",{className:"report-dialog-modal__subtitle",children:t.jsxDEV(o,{id:"filter_modal.added.review_and_configure_title",defaultMessage:"Filter settings"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:86,columnNumber:55},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:86,columnNumber:9},this),t.jsxDEV("p",{className:"report-dialog-modal__lead",children:t.jsxDEV(o,{id:"filter_modal.added.review_and_configure",defaultMessage:"To review and further configure this filter category, go to the {settings_link}.",values:{settings_link:u}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:88,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:87,columnNumber:9},this),t.jsxDEV("div",{className:"flex-spacer"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:95,columnNumber:9},this),t.jsxDEV("div",{className:"report-dialog-modal__actions",children:t.jsxDEV(C,{onClick:this.handleCloseClick,children:t.jsxDEV(o,{id:"report.close",defaultMessage:"Done"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:98,columnNumber:51},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:98,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:97,columnNumber:9},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/added_to_filter.jsx",lineNumber:73,columnNumber:7},this)}}const T=c(k)(I),A=t.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13",children:t.jsxDEV("path",{d:"M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/utils/icons.tsx",lineNumber:10,columnNumber:5},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/utils/icons.tsx",lineNumber:4,columnNumber:1},void 0),K=t.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13",children:t.jsxDEV("path",{d:"M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/utils/icons.tsx",lineNumber:21,columnNumber:5},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/utils/icons.tsx",lineNumber:15,columnNumber:1},void 0),h=N({search:{id:"filter_modal.select_filter.search",defaultMessage:"Search or create"},clear:{id:"emoji_button.clear",defaultMessage:"Clear"}}),P=(r,{contextType:l})=>({filters:Array.from(r.get("filters").values()).map(e=>{var a;return[e.get("id"),e.get("title"),(a=e.get("keywords"))==null?void 0:a.map(s=>s.get("keyword")).join(`
`),e.get("expires_at")&&e.get("expires_at")<new Date,l&&!e.get("context").includes(b(l))]})});class z extends f.PureComponent{constructor(){super(...arguments);i(this,"state",{searchValue:""});i(this,"renderItem",e=>{let a=null;return(e[3]||e[4])&&(a=t.jsxDEV("span",{className:"language-dropdown__dropdown__results__item__common-name",children:["(",e[3]&&t.jsxDEV(o,{id:"filter_modal.select_filter.expired",defaultMessage:"expired"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:64,columnNumber:25},this),e[3]&&e[4]&&", ",e[4]&&t.jsxDEV(o,{id:"filter_modal.select_filter.context_mismatch",defaultMessage:"does not apply to this context"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:66,columnNumber:25},this),")"]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:62,columnNumber:7},this)),t.jsxDEV("div",{role:"button",tabIndex:0,"data-index":e[0],className:"language-dropdown__dropdown__results__item",onClick:this.handleItemClick,onKeyDown:this.handleKeyDown,children:[t.jsxDEV("span",{className:"language-dropdown__dropdown__results__item__native-name",children:e[1]},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:74,columnNumber:9},this)," ",a]},e[0],!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:73,columnNumber:7},this)});i(this,"handleSearchChange",({target:e})=>{this.setState({searchValue:e.value})});i(this,"setListRef",e=>{this.listNode=e});i(this,"handleKeyDown",e=>{const a=Array.from(this.listNode.childNodes).findIndex(m=>m===e.currentTarget);let s=null;switch(e.key){case" ":case"Enter":e.currentTarget.click();break;case"ArrowDown":s=this.listNode.childNodes[a+1]||this.listNode.firstChild;break;case"ArrowUp":s=this.listNode.childNodes[a-1]||this.listNode.lastChild;break;case"Tab":e.shiftKey?s=this.listNode.childNodes[a-1]||this.listNode.lastChild:s=this.listNode.childNodes[a+1]||this.listNode.firstChild;break;case"Home":s=this.listNode.firstChild;break;case"End":s=this.listNode.lastChild;break}s&&(s.focus(),e.preventDefault(),e.stopPropagation())});i(this,"handleSearchKeyDown",e=>{let a=null;switch(e.key){case"Tab":case"ArrowDown":a=this.listNode.firstChild,a&&(a.focus(),e.preventDefault(),e.stopPropagation());break}});i(this,"handleClear",()=>{this.setState({searchValue:""})});i(this,"handleItemClick",e=>{const a=e.currentTarget.getAttribute("data-index");e.preventDefault(),this.props.onSelectFilter(a)});i(this,"handleNewFilterClick",e=>{e.preventDefault(),this.props.onNewFilter(this.state.searchValue)})}search(){const{filters:e}=this.props,{searchValue:a}=this.state;return a===""?e:F.go(a,e,{keys:["1","2"],limit:5,threshold:-1e4}).map(s=>s.obj)}renderCreateNew(e){return t.jsxDEV("div",{role:"button",tabIndex:0,className:"language-dropdown__dropdown__results__item",onClick:this.handleNewFilterClick,onKeyDown:this.handleKeyDown,children:[t.jsxDEV(v,{id:"plus",icon:M},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:82,columnNumber:9},this)," ",t.jsxDEV(o,{id:"filter_modal.select_filter.prompt_new",defaultMessage:"New category: {name}",values:{name:e}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:82,columnNumber:43},this)]},"add-new-filter",!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:81,columnNumber:7},this)}render(){const{intl:e}=this.props,{searchValue:a}=this.state,s=a!=="",m=this.search();return t.jsxDEV(t.Fragment,{children:[t.jsxDEV("h3",{className:"report-dialog-modal__title",children:t.jsxDEV(o,{id:"filter_modal.select_filter.title",defaultMessage:"Filter this post"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:178,columnNumber:52},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:178,columnNumber:9},this),t.jsxDEV("p",{className:"report-dialog-modal__lead",children:t.jsxDEV(o,{id:"filter_modal.select_filter.subtitle",defaultMessage:"Use an existing category or create a new one"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:179,columnNumber:50},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:179,columnNumber:9},this),t.jsxDEV("div",{className:"emoji-mart-search",children:[t.jsxDEV("input",{type:"search",value:a,onChange:this.handleSearchChange,onKeyDown:this.handleSearchKeyDown,placeholder:e.formatMessage(h.search),autoFocus:!0},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:182,columnNumber:11},this),t.jsxDEV("button",{type:"button",className:"emoji-mart-search-icon",disabled:!s,"aria-label":e.formatMessage(h.clear),onClick:this.handleClear,children:s?K:A},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:183,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:181,columnNumber:9},this),t.jsxDEV("div",{className:"language-dropdown__dropdown__results emoji-mart-scroll",role:"listbox",ref:this.setListRef,children:[m.map(this.renderItem),s&&this.renderCreateNew(a)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:186,columnNumber:9},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/filters/select_filter.jsx",lineNumber:177,columnNumber:7},this)}}const L=c(P)(p(z)),R=N({close:{id:"lightbox.close",defaultMessage:"Close"}});class _ extends D{constructor(){super(...arguments);i(this,"state",{step:"select",filterId:null,isSubmitting:!1,isSubmitted:!1});i(this,"handleNewFilterSuccess",e=>{this.handleSelectFilter(e.id)});i(this,"handleSuccess",()=>{const{dispatch:e,statusId:a}=this.props;e(w(a,!0)),this.setState({isSubmitting:!1,isSubmitted:!0,step:"submitted"})});i(this,"handleFail",()=>{this.setState({isSubmitting:!1})});i(this,"handleNextStep",e=>{this.setState({step:e})});i(this,"handleSelectFilter",e=>{const{dispatch:a,statusId:s}=this.props;this.setState({isSubmitting:!0,filterId:e}),a(V({filter_id:e,status_id:s},this.handleSuccess,this.handleFail))});i(this,"handleNewFilter",e=>{const{dispatch:a}=this.props;this.setState({isSubmitting:!0}),a(B({title:e,context:["home","notifications","public","thread","account"],action:"warn"},this.handleNewFilterSuccess,this.handleFail))})}componentDidMount(){const{dispatch:e}=this.props;e(E())}render(){const{intl:e,statusId:a,contextType:s,onClose:m}=this.props,{step:u,filterId:g}=this.state;let d;switch(u){case"select":d=t.jsxDEV(L,{contextType:s,onSelectFilter:this.handleSelectFilter,onNewFilter:this.handleNewFilter},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:100,columnNumber:9},this);break;case"create":d=null;break;case"submitted":d=t.jsxDEV(T,{contextType:s,filterId:g,statusId:a,onClose:m},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:112,columnNumber:9},this)}return t.jsxDEV("div",{className:"modal-root__modal report-dialog-modal",children:[t.jsxDEV("div",{className:"report-modal__target",children:[t.jsxDEV(S,{className:"report-modal__close",title:e.formatMessage(R.close),icon:"times",iconComponent:y,onClick:m,size:20},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:124,columnNumber:11},this),t.jsxDEV(o,{id:"filter_modal.title.status",defaultMessage:"Filter a post"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:125,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:123,columnNumber:9},this),t.jsxDEV("div",{className:"report-dialog-modal__container",children:d},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:128,columnNumber:9},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/filter_modal.jsx",lineNumber:122,columnNumber:7},this)}}i(_,"propTypes",{statusId:n.string.isRequired,contextType:n.string,dispatch:n.func.isRequired,intl:n.object.isRequired});const me=c()(p(_));export{me as default};
//# sourceMappingURL=filter_modal-DGMuuaIo.js.map
