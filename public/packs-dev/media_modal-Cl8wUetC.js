var me=Object.defineProperty;var ce=(t,i,e)=>i in t?me(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var I=(t,i,e)=>ce(t,typeof i!="symbol"?i+"":i,e);import{j as h}from"./client-BG6VvM0b.js";import{u as he,r as b,d as ie,i as fe}from"./index-ykyyQSL-.js";import{d as pe,e as ge,P as R}from"./short_number--sxn3OKQ.js";import{d as be,u as ve,a as K,o as O,af as _e,a$ as ye,b0 as Ne,b as S,aT as Y,v as xe,w as Ee,b1 as Ie,aU as we,aV as Me,aW as je,ab as Ce,aX as ke,aY as Re,aZ as De,b2 as Se,g as Te,h as Ae,b3 as Be,b4 as Ve,i as He,y as Le,z as ze,I as Q,aQ as Oe,V as Pe}from"./useSelectableClick-DBo53LOf.js";import{c as Z}from"./index-guCj-HqV.js";import{R as Ze}from"./index-DTgehdR6.js";import{S as Fe}from"./chevron_left-R_fqLHXp.js";import{S as We}from"./close-DPVxbBbs.js";import{e as Ue,A as $e}from"./initial_state-BP3UcUr4.js";import{c as Ke,d as qe,p as Ge}from"./use-gesture-react.esm-D-KUJBjj.js";import{L as Xe}from"./loading_indicator-BBuNQ1GS.js";const D=ie({reply:{id:"status.reply",defaultMessage:"Reply"},replyAll:{id:"status.replyAll",defaultMessage:"Reply to thread"},reblog:{id:"status.reblog",defaultMessage:"Boost"},reblog_private:{id:"status.reblog_private",defaultMessage:"Boost with original visibility"},cancel_reblog_private:{id:"status.cancel_reblog_private",defaultMessage:"Unboost"},cannot_reblog:{id:"status.cannot_reblog",defaultMessage:"This post cannot be boosted"},favourite:{id:"status.favourite",defaultMessage:"Favorite"},removeFavourite:{id:"status.remove_favourite",defaultMessage:"Remove from favorites"},open:{id:"status.open",defaultMessage:"Expand this status"}}),Ye=({statusId:t,withOpenButton:i,onClose:e})=>{const{signedIn:n}=be(),l=he(),r=pe(),u=ve(),s=K(M=>M.statuses.get(t)),v=s==null?void 0:s.get("account"),y=K(M=>v?M.accounts.get(v):void 0),j=K(M=>M.compose.get("text").trim().length!==0),p=b.useCallback(()=>{s&&(n?(e(!0),u(j?O({modalType:"CONFIRM_REPLY",modalProps:{status:s}}):_e(s))):u(O({modalType:"INTERACTION",modalProps:{type:"reply",accountId:s.getIn(["account","id"]),url:s.get("uri")}})))},[u,s,n,j,e]),o=b.useCallback(()=>{s&&u(n?ye(s.get("id")):O({modalType:"INTERACTION",modalProps:{type:"favourite",accountId:s.getIn(["account","id"]),url:s.get("uri")}}))},[u,s,n]),a=b.useCallback(M=>{s&&u(n?Ne(s.get("id"),M.shiftKey):O({modalType:"INTERACTION",modalProps:{type:"reblog",accountId:s.getIn(["account","id"]),url:s.get("uri")}}))},[u,s,n]),c=b.useCallback(M=>{M.button!==0||!s||(e(),r.push(`/@${y==null?void 0:y.acct}/${s.get("id")}`))},[r,s,y,e]);if(!s)return null;const d=["public","unlisted"].includes(s.get("visibility")),f=s.getIn(["account","id"])===Ue&&s.get("visibility")==="private";let _,g,N;s.get("in_reply_to_id",null)===null?(_="reply",g=Y,N=l.formatMessage(D.reply)):(_="reply-all",g=we,N=l.formatMessage(D.replyAll));let w,m;s.get("reblogged")?(w=l.formatMessage(D.cancel_reblog_private),m=d?Me:je):d?(w=l.formatMessage(D.reblog),m=Ce):f?(w=l.formatMessage(D.reblog_private),m=ke):(w=l.formatMessage(D.cannot_reblog),m=Re);const x=l.formatMessage(s.get("favourited")?D.removeFavourite:D.favourite);return h.jsxDEV("div",{className:"picture-in-picture__footer",children:[h.jsxDEV(S,{className:"status__action-bar-button",title:N,icon:s.get("in_reply_to_account_id")===s.getIn(["account","id"])?"reply":_,iconComponent:s.get("in_reply_to_account_id")===s.getIn(["account","id"])?Y:g,onClick:p,counter:s.get("replies_count")},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/picture_in_picture/components/footer.tsx",lineNumber:202,columnNumber:7},void 0),h.jsxDEV(S,{className:Z("status__action-bar-button",{reblogPrivate:f}),disabled:!d&&!f,active:s.get("reblogged"),title:w,icon:"retweet",iconComponent:m,onClick:a,counter:s.get("reblogs_count")},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/picture_in_picture/components/footer.tsx",lineNumber:221,columnNumber:7},void 0),h.jsxDEV(S,{className:"status__action-bar-button star-icon",animate:!0,active:s.get("favourited"),title:x,icon:"star",iconComponent:s.get("favourited")?xe:Ee,onClick:o,counter:s.get("favourites_count")},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/picture_in_picture/components/footer.tsx",lineNumber:232,columnNumber:7},void 0),i&&h.jsxDEV(S,{className:"status__action-bar-button",title:l.formatMessage(D.open),icon:"external-link",iconComponent:Ie,onClick:c,href:`/@${y==null?void 0:y.acct}/${s.get("id")}`},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/picture_in_picture/components/footer.tsx",lineNumber:244,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/picture_in_picture/components/footer.tsx",lineNumber:201,columnNumber:5},void 0)};var J={},ee;function Qe(){if(ee)return J;ee=1;var t=function(){function e(n,l){for(var r=0;r<l.length;r++){var u=l[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}return function(n,l,r){return l&&e(n.prototype,l),r&&e(n,r),n}}();function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}return function(){if(typeof window>"u"||typeof Element>"u")return;var e=Array.prototype.slice,n=Element.prototype.matches||Element.prototype.msMatchesSelector,l=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","details","summary","iframe","object","embed","video","[contenteditable]"].join(","),r=function(){function p(o,a){i(this,p),this._inertManager=a,this._rootElement=o,this._managedNodes=new Set,this._rootElement.hasAttribute("aria-hidden")?this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"):this._savedAriaHidden=null,this._rootElement.setAttribute("aria-hidden","true"),this._makeSubtreeUnfocusable(this._rootElement),this._observer=new MutationObserver(this._onMutation.bind(this)),this._observer.observe(this._rootElement,{attributes:!0,childList:!0,subtree:!0})}return t(p,[{key:"destructor",value:function(){this._observer.disconnect(),this._rootElement&&(this._savedAriaHidden!==null?this._rootElement.setAttribute("aria-hidden",this._savedAriaHidden):this._rootElement.removeAttribute("aria-hidden")),this._managedNodes.forEach(function(a){this._unmanageNode(a.node)},this),this._observer=null,this._rootElement=null,this._managedNodes=null,this._inertManager=null}},{key:"_makeSubtreeUnfocusable",value:function(a){var c=this;v(a,function(g){return c._visitNode(g)});var d=document.activeElement;if(!document.body.contains(a)){for(var f=a,_=void 0;f;){if(f.nodeType===Node.DOCUMENT_FRAGMENT_NODE){_=f;break}f=f.parentNode}_&&(d=_.activeElement)}a.contains(d)&&(d.blur(),d===document.activeElement&&document.body.focus())}},{key:"_visitNode",value:function(a){if(a.nodeType===Node.ELEMENT_NODE){var c=a;c!==this._rootElement&&c.hasAttribute("inert")&&this._adoptInertRoot(c),(n.call(c,l)||c.hasAttribute("tabindex"))&&this._manageNode(c)}}},{key:"_manageNode",value:function(a){var c=this._inertManager.register(a,this);this._managedNodes.add(c)}},{key:"_unmanageNode",value:function(a){var c=this._inertManager.deregister(a,this);c&&this._managedNodes.delete(c)}},{key:"_unmanageSubtree",value:function(a){var c=this;v(a,function(d){return c._unmanageNode(d)})}},{key:"_adoptInertRoot",value:function(a){var c=this._inertManager.getInertRoot(a);c||(this._inertManager.setInert(a,!0),c=this._inertManager.getInertRoot(a)),c.managedNodes.forEach(function(d){this._manageNode(d.node)},this)}},{key:"_onMutation",value:function(a,c){a.forEach(function(d){var f=d.target;if(d.type==="childList")e.call(d.addedNodes).forEach(function(g){this._makeSubtreeUnfocusable(g)},this),e.call(d.removedNodes).forEach(function(g){this._unmanageSubtree(g)},this);else if(d.type==="attributes"){if(d.attributeName==="tabindex")this._manageNode(f);else if(f!==this._rootElement&&d.attributeName==="inert"&&f.hasAttribute("inert")){this._adoptInertRoot(f);var _=this._inertManager.getInertRoot(f);this._managedNodes.forEach(function(g){f.contains(g.node)&&_._manageNode(g.node)})}}},this)}},{key:"managedNodes",get:function(){return new Set(this._managedNodes)}},{key:"hasSavedAriaHidden",get:function(){return this._savedAriaHidden!==null}},{key:"savedAriaHidden",set:function(a){this._savedAriaHidden=a},get:function(){return this._savedAriaHidden}}]),p}(),u=function(){function p(o,a){i(this,p),this._node=o,this._overrodeFocusMethod=!1,this._inertRoots=new Set([a]),this._savedTabIndex=null,this._destroyed=!1,this.ensureUntabbable()}return t(p,[{key:"destructor",value:function(){if(this._throwIfDestroyed(),this._node&&this._node.nodeType===Node.ELEMENT_NODE){var a=this._node;this._savedTabIndex!==null?a.setAttribute("tabindex",this._savedTabIndex):a.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete a.focus}this._node=null,this._inertRoots=null,this._destroyed=!0}},{key:"_throwIfDestroyed",value:function(){if(this.destroyed)throw new Error("Trying to access destroyed InertNode")}},{key:"ensureUntabbable",value:function(){if(this.node.nodeType===Node.ELEMENT_NODE){var a=this.node;if(n.call(a,l)){if(a.tabIndex===-1&&this.hasSavedTabIndex)return;a.hasAttribute("tabindex")&&(this._savedTabIndex=a.tabIndex),a.setAttribute("tabindex","-1"),a.nodeType===Node.ELEMENT_NODE&&(a.focus=function(){},this._overrodeFocusMethod=!0)}else a.hasAttribute("tabindex")&&(this._savedTabIndex=a.tabIndex,a.removeAttribute("tabindex"))}}},{key:"addInertRoot",value:function(a){this._throwIfDestroyed(),this._inertRoots.add(a)}},{key:"removeInertRoot",value:function(a){this._throwIfDestroyed(),this._inertRoots.delete(a),this._inertRoots.size===0&&this.destructor()}},{key:"destroyed",get:function(){return this._destroyed}},{key:"hasSavedTabIndex",get:function(){return this._savedTabIndex!==null}},{key:"node",get:function(){return this._throwIfDestroyed(),this._node}},{key:"savedTabIndex",set:function(a){this._throwIfDestroyed(),this._savedTabIndex=a},get:function(){return this._throwIfDestroyed(),this._savedTabIndex}}]),p}(),s=function(){function p(o){if(i(this,p),!o)throw new Error("Missing required argument; InertManager needs to wrap a document.");this._document=o,this._managedNodes=new Map,this._inertRoots=new Map,this._observer=new MutationObserver(this._watchForInert.bind(this)),y(o.head||o.body||o.documentElement),o.readyState==="loading"?o.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}return t(p,[{key:"setInert",value:function(a,c){if(c){if(this._inertRoots.has(a))return;var d=new r(a,this);if(a.setAttribute("inert",""),this._inertRoots.set(a,d),!this._document.body.contains(a))for(var f=a.parentNode;f;)f.nodeType===11&&y(f),f=f.parentNode}else{if(!this._inertRoots.has(a))return;var _=this._inertRoots.get(a);_.destructor(),this._inertRoots.delete(a),a.removeAttribute("inert")}}},{key:"getInertRoot",value:function(a){return this._inertRoots.get(a)}},{key:"register",value:function(a,c){var d=this._managedNodes.get(a);return d!==void 0?d.addInertRoot(c):d=new u(a,c),this._managedNodes.set(a,d),d}},{key:"deregister",value:function(a,c){var d=this._managedNodes.get(a);return d?(d.removeInertRoot(c),d.destroyed&&this._managedNodes.delete(a),d):null}},{key:"_onDocumentLoaded",value:function(){var a=e.call(this._document.querySelectorAll("[inert]"));a.forEach(function(c){this.setInert(c,!0)},this),this._observer.observe(this._document.body||this._document.documentElement,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function(a,c){var d=this;a.forEach(function(f){switch(f.type){case"childList":e.call(f.addedNodes).forEach(function(N){if(N.nodeType===Node.ELEMENT_NODE){var w=e.call(N.querySelectorAll("[inert]"));n.call(N,"[inert]")&&w.unshift(N),w.forEach(function(m){this.setInert(m,!0)},d)}},d);break;case"attributes":if(f.attributeName!=="inert")return;var _=f.target,g=_.hasAttribute("inert");d.setInert(_,g);break}},this)}}]),p}();function v(p,o,a){if(p.nodeType==Node.ELEMENT_NODE){var c=p;o&&o(c);var d=c.shadowRoot;if(d){v(d,o);return}if(c.localName=="content"){for(var f=c,_=f.getDistributedNodes?f.getDistributedNodes():[],g=0;g<_.length;g++)v(_[g],o);return}if(c.localName=="slot"){for(var N=c,w=N.assignedNodes?N.assignedNodes({flatten:!0}):[],m=0;m<w.length;m++)v(w[m],o);return}}for(var x=p.firstChild;x!=null;)v(x,o),x=x.nextSibling}function y(p){if(!p.querySelector("style#inert-style, link#inert-style")){var o=document.createElement("style");o.setAttribute("id","inert-style"),o.textContent=`
[inert] {
  pointer-events: none;
  cursor: default;
}

[inert], [inert] * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
`,p.appendChild(o)}}if(!HTMLElement.prototype.hasOwnProperty("inert")){var j=new s(document);Object.defineProperty(HTMLElement.prototype,"inert",{enumerable:!0,get:function(){return this.hasAttribute("inert")},set:function(o){j.setInert(this,o)}})}}(),J}Qe();function Je(t,i,e){return{r:255*e(t.r/255,i.r/255),g:255*e(t.g/255,i.g/255),b:255*e(t.b/255,i.b/255)}}function et(t,i){return t*i}function P(t,i,e){return Math.min(Math.max(t||0,i),e)}function q(t){return{r:P(t.r,0,255),g:P(t.g,0,255),b:P(t.b,0,255),a:P(t.a,0,1)}}function te(t){return{r:255*t.r,g:255*t.g,b:255*t.b,a:t.a}}function tt(t){return{r:t.r/255,g:t.g/255,b:t.b/255,a:t.a}}function ae(t,i){i===void 0&&(i=0);var e=Math.pow(10,i);return{r:Math.round(t.r*e)/e,g:Math.round(t.g*e)/e,b:Math.round(t.b*e)/e,a:t.a}}function G(t,i,e,n,l,r){return(1-i/e)*n+i/e*Math.round((1-t)*l+t*r)}function at(t,i,e,n,l){l===void 0&&(l={unitInput:!1,unitOutput:!1,roundOutput:!0}),l.unitInput&&(t=te(t),i=te(i)),t=q(t);var r=(i=q(i)).a+t.a-i.a*t.a,u=e(t,i,n),s=q({r:G(t.a,i.a,r,t.r,i.r,u.r),g:G(t.a,i.a,r,t.g,i.g,u.g),b:G(t.a,i.a,r,t.b,i.b,u.b),a:r});return s=l.unitOutput?tt(s):l.roundOutput?ae(s):function(v){return ae(v,9)}(s),s}function it(t,i){return at(t,i,Je,et)}class nt extends b.PureComponent{constructor(){super(...arguments);I(this,"activeElement",this.props.children?document.activeElement:null);I(this,"handleKeyUp",e=>{(e.key==="Escape"||e.key==="Esc"||e.keyCode===27)&&this.props.children&&this.props.onClose()});I(this,"handleKeyDown",e=>{if(e.key==="Tab"){const n=Array.from(this.node.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(u=>window.getComputedStyle(u).display!=="none"),l=n.indexOf(e.target);let r;e.shiftKey?r=n[l-1]||n[n.length-1]:r=n[l+1]||n[0],r&&(r.focus(),e.stopPropagation(),e.preventDefault())}});I(this,"getSiblings",()=>Array(...this.node.parentElement.childNodes).filter(e=>e!==this.node));I(this,"setRef",e=>{this.node=e})}componentDidMount(){window.addEventListener("keyup",this.handleKeyUp,!1),window.addEventListener("keydown",this.handleKeyDown,!1),this.history=this.props.history||ge()}UNSAFE_componentWillReceiveProps(e){e.children&&!this.props.children&&(this.activeElement=document.activeElement,this.getSiblings().forEach(n=>n.setAttribute("inert",!0)))}componentDidUpdate(e){!this.props.children&&e.children&&(this.getSiblings().forEach(n=>n.removeAttribute("inert")),Promise.resolve().then(()=>{this.props.ignoreFocus||this.activeElement.focus({preventScroll:!0}),this.activeElement=null}).catch(console.error),this._handleModalClose()),this.props.children&&!e.children&&this._handleModalOpen(),this.props.children&&this._ensureHistoryBuffer()}componentWillUnmount(){window.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("keydown",this.handleKeyDown)}_handleModalOpen(){this._modalHistoryKey=Date.now(),this.unlistenHistory=this.history.listen((e,n)=>{n==="POP"&&this.props.onClose()})}_handleModalClose(){this.unlistenHistory&&this.unlistenHistory();const{state:e}=this.history.location;e&&e.mastodonModalKey===this._modalHistoryKey&&this.history.goBack()}_ensureHistoryBuffer(){const{pathname:e,search:n,hash:l,state:r}=this.history.location;(!r||r.mastodonModalKey!==this._modalHistoryKey)&&this.history.push({pathname:e,search:n,hash:l},{...r,mastodonModalKey:this._modalHistoryKey})}render(){const{children:e,onClose:n}=this.props,l=!!e;if(!l)return h.jsxDEV("div",{className:"modal-root",ref:this.setRef,style:{opacity:0}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/modal_root.jsx",lineNumber:141,columnNumber:9},this);let r=null;if(this.props.backgroundColor&&typeof this.props.backgroundColor=="string")r=this.props.backgroundColor;else if(this.props.backgroundColor){const u=it({...this.props.backgroundColor,a:1},{r:0,g:0,b:0,a:.7});r=`rgb(${u.r}, ${u.g}, ${u.b})`}return h.jsxDEV("div",{className:"modal-root",ref:this.setRef,children:h.jsxDEV("div",{style:{pointerEvents:l?"auto":"none"},children:[h.jsxDEV("div",{role:"presentation",className:"modal-root__overlay",onClick:n,style:{backgroundColor:r}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/modal_root.jsx",lineNumber:157,columnNumber:11},this),h.jsxDEV("div",{role:"dialog",className:"modal-root__container",children:e},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/modal_root.jsx",lineNumber:158,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/modal_root.jsx",lineNumber:156,columnNumber:9},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/modal_root.jsx",lineNumber:155,columnNumber:7},this)}}const Rt=De(nt),ne=b.forwardRef(({src:t,alt:i,lang:e,width:n,height:l,onClick:r,onMouseDown:u,onTouchStart:s},v)=>{const[y,j]=b.useState(!0),p=b.useCallback(()=>{j(!1)},[j]),o=b.useCallback(a=>{a.stopPropagation(),r==null||r(a)},[r]);return h.jsxDEV("div",{className:"gifv",children:[y&&h.jsxDEV("canvas",{role:"button",tabIndex:0,"aria-label":i,title:i,lang:e,onClick:o},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/gifv.tsx",lineNumber:36,columnNumber:9},void 0),h.jsxDEV("video",{ref:v,src:t,role:"button",tabIndex:0,"aria-label":i,title:i,lang:e,width:n,height:l,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,onClick:o,onLoadedData:p,onMouseDown:u,onTouchStart:s},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/gifv.tsx",lineNumber:46,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/gifv.tsx",lineNumber:34,columnNumber:7},void 0)});ne.displayName="GIFV";let X=null;const ot=()=>{const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const i=document.createElement("div");t.appendChild(i);const e=t.offsetWidth-i.offsetWidth;return t.remove(),e},Dt=()=>{if(X!==null)return X;const t=Se(window.innerWidth)?0:ot();return X=t,t},st=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],rt=t=>{let i=0,e;for(const n of t)e=st.indexOf(n),i=i*83+e;return i},lt=t=>({r:Math.max(0,t>>16),g:Math.max(0,t>>8&255),b:Math.max(0,t&255)}),ut=t=>t?lt(rt(t.slice(2,6))):null,V=1,dt=4,mt=250,ct=(t,i,e,n)=>{const{clientWidth:l,clientHeight:r}=t,{offsetWidth:u,offsetHeight:s}=i,y=(e/n<l/r?"width":"height")==="width"?Math.min(l,e)/u:Math.min(r,n)/s;return{containerWidth:l,containerHeight:r,imageWidth:u,imageHeight:s,initialScale:y}},ht=Ke([qe,Ge]),ft=(t,i)=>{if(!t||i===V)return{left:-1/0,right:1/0,top:-1/0,bottom:1/0};const{containerWidth:e,containerHeight:n,imageWidth:l,imageHeight:r}=t;return{left:-Math.max(l*i-e,0)/2,right:Math.max(l*i-e,0)/2,top:-Math.max(r*i-n,0)/2,bottom:Math.max(r*i-n,0)/2}},pt=({alt:t="",lang:i="",src:e,width:n,height:l,onClick:r,onDoubleClick:u,onClose:s,onZoomChange:v,zoomedIn:y,blurhash:j})=>{b.useEffect(()=>{const E=C=>{C.preventDefault()};return document.addEventListener("gesturestart",E),document.addEventListener("gesturechange",E),document.addEventListener("gestureend",E),()=>{document.removeEventListener("gesturestart",E),document.removeEventListener("gesturechange",E),document.removeEventListener("gestureend",E)}},[]);const[p,o]=b.useState(!1),[a,c]=b.useState(!1),[d,f]=b.useState(!1),_=b.useRef(null),g=b.useRef(null),N=b.useRef(),w=b.useRef(null),[m,x]=Te(()=>({x:0,y:0,scale:1,onRest:{scale({value:E}){v&&v(E!==V)}}}));ht({onDrag({pinching:E,cancel:C,active:A,last:L,offset:[W,k],velocity:[,U],direction:[,z],tap:$}){if($){N.current?(clearTimeout(N.current),N.current=null,u==null||u()):N.current=setTimeout(()=>{r==null||r(),N.current=null},mt);return}if(!y){if(L){(U>.5&&z!==0||Math.abs(k)>150)&&(s==null||s()),x.start({y:0,config:Ae.wobbly});return}else if(z!==0){x.start({y:k,immediate:!0});return}C();return}if(E){C();return}o(!!A),x.start({x:W,y:k})},onPinch({origin:[E,C],first:A,movement:[L],offset:[W],memo:k}){if(!g.current)return;if(A){const{width:$,height:se,x:re,y:le}=g.current.getBoundingClientRect(),ue=E-(re+$/2),de=C-(le+se/2);k=[m.x.get(),m.y.get(),ue,de]}const U=k[0]-(L-1)*k[2],z=k[1]-(L-1)*k[3];return x.start({scale:W,x:U,y:z}),k}},{target:g,drag:{from:()=>[m.x.get(),m.y.get()],filterTaps:!0,bounds:()=>ft(w.current,m.scale.get()),rubberband:!0},pinch:{scaleBounds:{min:V,max:dt},rubberband:!0}}),b.useEffect(()=>{!a||!_.current||!g.current||(w.current=ct(_.current,g.current,n,l),y?m.scale.get()===V&&x.start({scale:w.current.initialScale,x:0,y:0}):x.start({scale:V,x:0,y:0}))},[x,m.scale,y,n,l,a]);const M=b.useCallback(E=>{E.preventDefault(),E.stopPropagation()},[]),H=b.useCallback(()=>{c(!0)},[c]),T=b.useCallback(()=>{f(!0)},[f]),F=Be([m.scale,m.x,m.y],(E,C,A)=>`matrix(${E}, 0, 0, ${E}, ${C}, ${A})`);return h.jsxDEV("div",{className:Z("zoomable-image",{"zoomable-image--zoomed-in":y,"zoomable-image--error":d,"zoomable-image--dragging":p}),ref:_,children:[!a&&j&&h.jsxDEV("div",{className:"zoomable-image__preview",style:{aspectRatio:`${n}/${l}`,height:`min(${l}px, 100%)`},children:h.jsxDEV(Ve,{hash:j},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/zoomable_image.tsx",lineNumber:303,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/zoomable_image.tsx",lineNumber:296,columnNumber:7},void 0),h.jsxDEV(He.img,{style:{transform:F},role:"presentation",ref:g,alt:t,title:t,lang:i,src:e,width:n,height:l,draggable:!1,onLoad:H,onError:T,onClickCapture:M},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/zoomable_image.tsx",lineNumber:307,columnNumber:7},void 0),!a&&!d&&h.jsxDEV(Xe,{},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/zoomable_image.tsx",lineNumber:323,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/zoomable_image.tsx",lineNumber:287,columnNumber:5},void 0)},gt=t=>b.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...t},b.createElement("path",{d:"M800-600v-120H680v-80h120q33 0 56.5 23.5T880-720v120h-80Zm-720 0v-120q0-33 23.5-56.5T160-800h120v80H160v120H80Zm600 440v-80h120v-120h80v120q0 33-23.5 56.5T800-160H680Zm-520 0q-33 0-56.5-23.5T80-240v-120h80v120h120v80H160Zm80-160v-320h480v320H240Zm80-80h320v-160H320v160Zm0 0v-160 160Z"})),bt=t=>b.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},b.createElement("path",{d:"M3.1002 20.2C2.46686 20.2 1.9252 19.9833 1.4752 19.55C1.04186 19.1 0.825195 18.5583 0.825195 17.925V6.07499C0.825195 5.44165 1.04186 4.90832 1.4752 4.47499C1.9252 4.02499 2.46686 3.79999 3.1002 3.79999H20.9002C21.5335 3.79999 22.0669 4.02499 22.5002 4.47499C22.9502 4.90832 23.1752 5.44165 23.1752 6.07499V17.925C23.1752 18.5583 22.9502 19.1 22.5002 19.55C22.0669 19.9833 21.5335 20.2 20.9002 20.2H3.1002ZM3.1002 17.925H20.9002V6.07499H3.1002V17.925Z",fill:"black"}),b.createElement("path",{d:"M8.12522 16V9.85782H6.25043V8H10V16H8.12522ZM11.1461 16V14.1422H13.0209V16H11.1461ZM15.1252 16V9.85782H13.2313V8H17V16H15.1252ZM11.1461 12.8578V11H13.0209V12.8578H11.1461Z",fill:"black"})),B=ie({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"},zoomIn:{id:"lightbox.zoom_in",defaultMessage:"Zoom to actual size"},zoomOut:{id:"lightbox.zoom_out",defaultMessage:"Zoom to fit"}});class oe extends Le{constructor(){super(...arguments);I(this,"state",{index:null,navigationHidden:!1,zoomedIn:!1});I(this,"handleZoomClick",()=>{this.setState(e=>({zoomedIn:!e.zoomedIn}))});I(this,"handleZoomChange",e=>{this.setState({zoomedIn:e})});I(this,"handleSwipe",e=>{this.setState({index:e%this.props.media.size,zoomedIn:!1})});I(this,"handleTransitionEnd",()=>{this.setState({zoomedIn:!1})});I(this,"handleNextClick",()=>{this.setState({index:(this.getIndex()+1)%this.props.media.size,zoomedIn:!1})});I(this,"handlePrevClick",()=>{this.setState({index:(this.props.media.size+this.getIndex()-1)%this.props.media.size,zoomedIn:!1})});I(this,"handleChangeIndex",e=>{const n=Number(e.currentTarget.getAttribute("data-index"));this.setState({index:n%this.props.media.size,zoomedIn:!1})});I(this,"handleKeyDown",e=>{switch(e.key){case"ArrowLeft":this.handlePrevClick(),e.preventDefault(),e.stopPropagation();break;case"ArrowRight":this.handleNextClick(),e.preventDefault(),e.stopPropagation();break}});I(this,"handleToggleNavigation",()=>{this.setState(e=>({navigationHidden:!e.navigationHidden}))});I(this,"setRef",e=>{this.setState({viewportWidth:e==null?void 0:e.clientWidth,viewportHeight:e==null?void 0:e.clientHeight})})}componentDidMount(){window.addEventListener("keydown",this.handleKeyDown,!1),this._sendBackgroundColor()}componentDidUpdate(e,n){n.index!==this.state.index&&this._sendBackgroundColor()}_sendBackgroundColor(){const{media:e,onChangeBackgroundColor:n}=this.props,l=this.getIndex(),r=e.getIn([l,"blurhash"]);if(r){const u=ut(r);n(u)}}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown),this.props.onChangeBackgroundColor(null)}getIndex(){return this.state.index!==null?this.state.index:this.props.index}render(){const{media:e,statusId:n,lang:l,intl:r,onClose:u}=this.props,{navigationHidden:s,zoomedIn:v,viewportWidth:y,viewportHeight:j}=this.state,p=this.getIndex(),o=e.size>1&&h.jsxDEV("button",{tabIndex:0,className:"media-modal__nav media-modal__nav--prev",onClick:this.handlePrevClick,"aria-label":r.formatMessage(B.previous),children:h.jsxDEV(Q,{id:"chevron-left",icon:Fe},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:171,columnNumber:194},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:171,columnNumber:39},this),a=e.size>1&&h.jsxDEV("button",{tabIndex:0,className:"media-modal__nav  media-modal__nav--next",onClick:this.handleNextClick,"aria-label":r.formatMessage(B.next),children:h.jsxDEV(Q,{id:"chevron-right",icon:Oe},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:172,columnNumber:192},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:172,columnNumber:40},this),c=e.map((m,x)=>{const M=m.getIn(["meta","original","width"])||null,H=m.getIn(["meta","original","height"])||null,T=m.getIn(["translation","description"])||m.get("description");if(m.get("type")==="image")return h.jsxDEV(pt,{src:m.get("url"),blurhash:m.get("blurhash"),width:M,height:H,alt:T,lang:l,onClick:this.handleToggleNavigation,onDoubleClick:this.handleZoomClick,onClose:u,onZoomChange:this.handleZoomChange,zoomedIn:v&&x===p},m.get("url"),!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:181,columnNumber:11},this);if(m.get("type")==="video"){const{currentTime:F,autoPlay:E,volume:C}=this.props;return h.jsxDEV(Pe,{preview:m.get("preview_url"),blurhash:m.get("blurhash"),src:m.get("url"),width:m.get("width"),height:m.get("height"),frameRate:m.getIn(["meta","original","frame_rate"]),aspectRatio:`${m.getIn(["meta","original","width"])} / ${m.getIn(["meta","original","height"])}`,startTime:F||0,startPlaying:E||!1,startVolume:C||1,onCloseVideo:u,detailed:!0,alt:T,lang:l},m.get("url"),!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:200,columnNumber:11},this)}else if(m.get("type")==="gifv")return h.jsxDEV(ne,{src:m.get("url"),width:M,height:H,alt:T,lang:l,onClick:this.toggleNavigation},m.get("url"),!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:220,columnNumber:11},this);return null}).toArray(),d={width:"100%",height:"100%"},f={alignItems:"center"},_=Z("media-modal__navigation",{"media-modal__navigation--hidden":s});let g;e.size>1&&(g=e.map((m,x)=>h.jsxDEV("button",{className:Z("media-modal__page-dot",{active:x===p}),"data-index":x,onClick:this.handleChangeIndex,children:x+1},x,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:256,columnNumber:7},this)));const N=e.get(p),w=N.get("type")==="image"&&(N.getIn(["meta","original","width"])>y||N.getIn(["meta","original","height"])>j);return h.jsxDEV("div",{className:"modal-root__modal media-modal",ref:this.setRef,children:[h.jsxDEV("div",{className:"media-modal__closer",role:"presentation",onClick:u,children:h.jsxDEV(Ze,{style:d,containerStyle:f,onChangeIndex:this.handleSwipe,onTransitionEnd:this.handleTransitionEnd,index:p,disabled:$e||v,children:c},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:268,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:267,columnNumber:9},this),h.jsxDEV("div",{className:_,children:[h.jsxDEV("div",{className:"media-modal__buttons",children:[w&&h.jsxDEV(S,{title:r.formatMessage(v?B.zoomOut:B.zoomIn),iconComponent:v?gt:bt,onClick:this.handleZoomClick},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:282,columnNumber:26},this),h.jsxDEV(S,{title:r.formatMessage(B.close),icon:"times",iconComponent:We,onClick:u},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:283,columnNumber:13},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:281,columnNumber:11},this),o,a,h.jsxDEV("div",{className:"media-modal__overlay",children:[g&&h.jsxDEV("ul",{className:"media-modal__pagination",children:g},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:290,columnNumber:28},this),n&&h.jsxDEV(Ye,{statusId:n,withOpenButton:!0,onClose:u},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:291,columnNumber:26},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:289,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:280,columnNumber:9},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/ui/components/media_modal.jsx",lineNumber:266,columnNumber:7},this)}}I(oe,"propTypes",{media:ze.list.isRequired,statusId:R.string,lang:R.string,index:R.number.isRequired,onClose:R.func.isRequired,intl:R.object.isRequired,onChangeBackgroundColor:R.func.isRequired,currentTime:R.number,autoPlay:R.bool,volume:R.number});const St=fe(oe);export{Ye as F,ne as G,Rt as M,pt as Z,Dt as a,St as b,ut as g};
//# sourceMappingURL=media_modal-Cl8wUetC.js.map
