var x=Object.defineProperty;var _=(t,a,o)=>a in t?x(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;var b=(t,a,o)=>_(t,typeof a!="symbol"?a+"":a,o);import{j as e}from"./client-BG6VvM0b.js";import{r as g,F as u,b as N}from"./index-ykyyQSL-.js";import{c as j}from"./index-guCj-HqV.js";import{a as D}from"./api-uqk9CYtW.js";import{r as v}from"./numbers-CGZQWBYL.js";import{M as l}from"./message-Bb0z64dP.js";import"./index-lj9VQs0f.js";import"./initial_state-BP3UcUr4.js";import"./ready-DpOgoWSg.js";const E=t=>{const a="UTC";switch(t.frequency){case"day":return e.jsxDEV(N,{value:t.period,month:"long",day:"2-digit",timeZone:a},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:15,columnNumber:14},void 0);default:return e.jsxDEV(N,{value:t.period,month:"long",year:"numeric",timeZone:a},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:17,columnNumber:14},void 0)}};class U extends g.PureComponent{constructor(){super(...arguments);b(this,"state",{loading:!0,data:null})}componentDidMount(){const{start_at:o,end_at:m,frequency:d}=this.props;D(!1).post("/api/v1/admin/retention",{start_at:o,end_at:m,frequency:d}).then(s=>{this.setState({loading:!1,data:s.data})}).catch(s=>{console.error(s)})}render(){const{loading:o,data:m}=this.state,{frequency:d}=this.props;let s;o?s=e.jsxDEV(l,{id:"loading_indicator.label",defaultMessage:"Loadingâ€¦"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:54,columnNumber:17},this):s=e.jsxDEV("table",{className:"retention__table",children:[e.jsxDEV("thead",{children:[e.jsxDEV("tr",{children:[e.jsxDEV("th",{children:e.jsxDEV("div",{className:"retention__table__date retention__table__label",children:e.jsxDEV(l,{id:"admin.dashboard.retention.cohort",defaultMessage:"Sign-up month"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:62,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:61,columnNumber:17},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:60,columnNumber:15},this),e.jsxDEV("th",{children:e.jsxDEV("div",{className:"retention__table__number retention__table__label",children:e.jsxDEV(l,{id:"admin.dashboard.retention.cohort_size",defaultMessage:"New users"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:68,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:67,columnNumber:17},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:66,columnNumber:15},this),m[0].data.slice(1).map((i,n)=>e.jsxDEV("th",{children:e.jsxDEV("div",{className:"retention__table__number retention__table__label",children:n+1},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:74,columnNumber:19},this)},i.date,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:73,columnNumber:13},this))]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:59,columnNumber:13},this),e.jsxDEV("tr",{children:[e.jsxDEV("td",{children:e.jsxDEV("div",{className:"retention__table__date retention__table__average",children:e.jsxDEV(l,{id:"admin.dashboard.retention.average",defaultMessage:"Average"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:84,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:83,columnNumber:17},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:82,columnNumber:15},this),e.jsxDEV("td",{children:e.jsxDEV("div",{className:"retention__table__size",children:e.jsxDEV(u,{value:m.reduce((i,n,r)=>i+(n.data[0].value*1-i)/(r+1),0),maximumFractionDigits:0},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:90,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:89,columnNumber:17},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:88,columnNumber:15},this),m[0].data.slice(1).map((i,n)=>{const r=m.reduce((c,h,f)=>h.data[n+1]?c+(h.data[n+1].rate-c)/(f+1):c,0);return e.jsxDEV("td",{children:e.jsxDEV("div",{className:j("retention__table__box","retention__table__average",`retention__table__box--${v(r*100)}`),children:e.jsxDEV(u,{value:r,style:"percent"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:100,columnNumber:23},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:99,columnNumber:21},this)},i.date,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:98,columnNumber:17},this)})]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:81,columnNumber:13},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:58,columnNumber:11},this),e.jsxDEV("tbody",{children:m.slice(0,-1).map(i=>e.jsxDEV("tr",{children:[e.jsxDEV("td",{children:e.jsxDEV("div",{className:"retention__table__date",children:E(i)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:112,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:111,columnNumber:17},this),e.jsxDEV("td",{children:e.jsxDEV("div",{className:"retention__table__size",children:e.jsxDEV(u,{value:i.data[0].value},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:119,columnNumber:21},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:118,columnNumber:19},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:117,columnNumber:17},this),i.data.slice(1).map(n=>e.jsxDEV("td",{children:e.jsxDEV("div",{className:j("retention__table__box",`retention__table__box--${v(n.rate*100)}`),children:e.jsxDEV(u,{value:n.rate,style:"percent"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:126,columnNumber:23},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:125,columnNumber:21},this)},n.date,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:124,columnNumber:13},this))]},i.period,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:110,columnNumber:11},this))},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:108,columnNumber:11},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:57,columnNumber:7},this);let p=null;switch(d){case"day":p=e.jsxDEV(l,{id:"admin.dashboard.daily_retention",defaultMessage:"User retention rate by day after sign-up"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:140,columnNumber:17},this);break;default:p=e.jsxDEV(l,{id:"admin.dashboard.monthly_retention",defaultMessage:"User retention rate by month after sign-up"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:143,columnNumber:17},this)}return e.jsxDEV("div",{className:"retention",children:[e.jsxDEV("h4",{children:p},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:148,columnNumber:9},this),s]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/admin/Retention.jsx",lineNumber:147,columnNumber:7},this)}}export{U as default};
//# sourceMappingURL=Retention-DPeK780G.js.map
