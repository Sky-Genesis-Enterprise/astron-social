import{a as M,A as ee}from"../index-lj9VQs0f.js";import{r as de}from"../ready-DpOgoWSg.js";function te(n){const c="==".slice(0,(4-n.length%4)%4),o=n.replace(/-/g,"+").replace(/_/g,"/")+c,a=atob(o),u=new ArrayBuffer(a.length),v=new Uint8Array(u);for(let p=0;p<a.length;p++)v[p]=a.charCodeAt(p);return u}function re(n){const c=new Uint8Array(n);let o="";for(const v of c)o+=String.fromCharCode(v);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var l="copy",w="convert";function k(n,c,o){if(c===l)return o;if(c===w)return n(o);if(c instanceof Array)return o.map(a=>k(n,c[0],a));if(c instanceof Object){const a={};for(const[u,v]of Object.entries(c)){if(v.derive){const p=v.derive(o);p!==void 0&&(o[u]=p)}if(!(u in o)){if(v.required)throw new Error(`Missing key: ${u}`);continue}if(o[u]==null){a[u]=null;continue}a[u]=k(n,v.schema,o[u])}return a}}function H(n,c){return{required:!0,schema:n,derive:c}}function d(n){return{required:!0,schema:n}}function h(n){return{required:!1,schema:n}}var ne={type:d(l),id:d(w),transports:h(l)},ie={appid:h(l),appidExclude:h(l),credProps:h(l)},oe={appid:h(l),appidExclude:h(l),credProps:h(l)},he={publicKey:d({rp:d(l),user:d({id:d(w),name:d(l),displayName:d(l)}),challenge:d(w),pubKeyCredParams:d(l),timeout:h(l),excludeCredentials:h([ne]),authenticatorSelection:h(l),attestation:h(l),extensions:h(ie)}),signal:h(l)},pe={type:d(l),id:d(l),rawId:d(w),authenticatorAttachment:h(l),response:d({clientDataJSON:d(w),attestationObject:d(w),transports:H(l,n=>{var c;return((c=n.getTransports)==null?void 0:c.call(n))||[]})}),clientExtensionResults:H(oe,n=>n.getClientExtensionResults())},ve={mediation:h(l),publicKey:d({challenge:d(w),timeout:h(l),rpId:h(l),allowCredentials:h([ne]),userVerification:h(l),extensions:h(ie)}),signal:h(l)},ye={type:d(l),id:d(l),rawId:d(w),authenticatorAttachment:h(l),response:d({clientDataJSON:d(w),authenticatorData:d(w),signature:d(w),userHandle:d(w)}),clientExtensionResults:H(oe,n=>n.getClientExtensionResults())};function me(n){return k(te,he,n)}function ge(n){return k(re,pe,n)}async function we(n){const c=await navigator.credentials.create(me(n));return ge(c)}function be(n){return k(te,ve,n)}function Ee(n){return k(re,ye,n)}async function Se(n){const c=await navigator.credentials.get(be(n));return Ee(c)}function Le(){return!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential)}var F={exports:{}},Q;function _e(){return Q||(Q=1,function(n){var c=function(o){var a=Object.prototype,u=a.hasOwnProperty,v=Object.defineProperty||function(t,e,r){t[e]=r.value},p,T=typeof Symbol=="function"?Symbol:{},A=T.iterator||"@@iterator",se=T.asyncIterator||"@@asyncIterator",G=T.toStringTag||"@@toStringTag";function S(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{S({},"")}catch{S=function(e,r,s){return e[r]=s}}function $(t,e,r,s){var i=e&&e.prototype instanceof P?e:P,f=Object.create(i.prototype),y=new J(s||[]);return v(f,"_invoke",{value:ue(t,r,y)}),f}o.wrap=$;function q(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(s){return{type:"throw",arg:s}}}var U="suspendedStart",ce="suspendedYield",X="executing",R="completed",E={};function P(){}function j(){}function L(){}var B={};S(B,A,function(){return this});var K=Object.getPrototypeOf,I=K&&K(K(V([])));I&&I!==a&&u.call(I,A)&&(B=I);var O=L.prototype=P.prototype=Object.create(B);j.prototype=L,v(O,"constructor",{value:L,configurable:!0}),v(L,"constructor",{value:j,configurable:!0}),j.displayName=S(L,G,"GeneratorFunction");function x(t){["next","throw","return"].forEach(function(e){S(t,e,function(r){return this._invoke(e,r)})})}o.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===j||(e.displayName||e.name)==="GeneratorFunction":!1},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,L):(t.__proto__=L,S(t,G,"GeneratorFunction")),t.prototype=Object.create(O),t},o.awrap=function(t){return{__await:t}};function N(t,e){function r(f,y,m,b){var g=q(t[f],t,y);if(g.type==="throw")b(g.arg);else{var W=g.arg,C=W.value;return C&&typeof C=="object"&&u.call(C,"__await")?e.resolve(C.__await).then(function(_){r("next",_,m,b)},function(_){r("throw",_,m,b)}):e.resolve(C).then(function(_){W.value=_,m(W)},function(_){return r("throw",_,m,b)})}}var s;function i(f,y){function m(){return new e(function(b,g){r(f,y,b,g)})}return s=s?s.then(m,m):m()}v(this,"_invoke",{value:i})}x(N.prototype),S(N.prototype,se,function(){return this}),o.AsyncIterator=N,o.async=function(t,e,r,s,i){i===void 0&&(i=Promise);var f=new N($(t,e,r,s),i);return o.isGeneratorFunction(e)?f:f.next().then(function(y){return y.done?y.value:f.next()})};function ue(t,e,r){var s=U;return function(f,y){if(s===X)throw new Error("Generator is already running");if(s===R){if(f==="throw")throw y;return fe()}for(r.method=f,r.arg=y;;){var m=r.delegate;if(m){var b=z(m,r);if(b){if(b===E)continue;return b}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(s===U)throw s=R,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);s=X;var g=q(t,e,r);if(g.type==="normal"){if(s=r.done?R:ce,g.arg===E)continue;return{value:g.arg,done:r.done}}else g.type==="throw"&&(s=R,r.method="throw",r.arg=g.arg)}}}function z(t,e){var r=e.method,s=t.iterator[r];if(s===p)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=p,z(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),E;var i=q(s,t.iterator,e.arg);if(i.type==="throw")return e.method="throw",e.arg=i.arg,e.delegate=null,E;var f=i.arg;if(!f)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,E;if(f.done)e[t.resultName]=f.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=p);else return f;return e.delegate=null,E}x(O),S(O,G,"Generator"),S(O,A,function(){return this}),S(O,"toString",function(){return"[object Generator]"});function le(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function J(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(le,this),this.reset(!0)}o.keys=function(t){var e=Object(t),r=[];for(var s in e)r.push(s);return r.reverse(),function i(){for(;r.length;){var f=r.pop();if(f in e)return i.value=f,i.done=!1,i}return i.done=!0,i}};function V(t){if(t!=null){var e=t[A];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,s=function i(){for(;++r<t.length;)if(u.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=p,i.done=!0,i};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}o.values=V;function fe(){return{value:p,done:!0}}return J.prototype={constructor:J,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(D),!t)for(var e in this)e.charAt(0)==="t"&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=p)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(b,g){return f.type="throw",f.arg=t,e.next=b,g&&(e.method="next",e.arg=p),!!g}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],f=i.completion;if(i.tryLoc==="root")return r("end");if(i.tryLoc<=this.prev){var y=u.call(i,"catchLoc"),m=u.call(i,"finallyLoc");if(y&&m){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(y){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else if(m){if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&u.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&(t==="break"||t==="continue")&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var f=i?i.completion:{};return f.type=t,f.arg=e,i?(this.method="next",this.next=i.finallyLoc,E):this.complete(f)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),D(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if(s.type==="throw"){var i=s.arg;D(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:V(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=p),E}},o}(n.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}}(F)),F.exports}_e();function Oe(n){var c;return n instanceof ee&&typeof((c=n.response)==null?void 0:c.data)=="object"&&"error"in n.response.data}function Y(n){Oe(n)&&console.error(n)}function ke(){var n;return(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content")}function Z(){document.querySelectorAll(".flash-message").forEach(n=>{n.classList.add("hidden")})}async function ae(n,c){var o;try{const a=await M.post(n,JSON.stringify(c),{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ke()}});window.location.replace(a.data.redirect_path)}catch(a){if(a instanceof ee&&((o=a.response)==null?void 0:o.status)===422){const u=document.getElementById("security-key-error-message");u==null||u.classList.remove("hidden"),Y(a)}else console.error(a)}}async function Ce(n){try{const o=(await M.get("/settings/security_keys/options")).data;try{const u={credential:await we({publicKey:o}),nickname:n};await ae("/settings/security_keys",u)}catch(a){const u=document.getElementById("security-key-error-message");u==null||u.classList.remove("hidden"),console.error(a)}}catch(c){Y(c)}}async function Ae(){try{const c=(await M.get("sessions/security_key_options")).data;try{const a={user:{credential:await Se({publicKey:c})}};ae("sign_in",a)}catch(o){const a=document.getElementById("security-key-error-message");a==null||a.classList.remove("hidden"),console.error(o)}}catch(n){Y(n)}}de(()=>{if(!Le()){const o=document.getElementById("unsupported-browser-message");if(o){o.classList.remove("hidden");const a=document.querySelector("button.btn.js-webauthn");a&&(a.disabled=!0)}}const n=document.querySelector("form#new_webauthn_credential");n&&n.addEventListener("submit",o=>{if(o.preventDefault(),!(o.target instanceof HTMLFormElement))return;const a=o.target.querySelector('input[name="new_webauthn_credential[nickname]"]');a!=null&&a.value?Ce(a.value):a==null||a.focus()});const c=document.getElementById("webauthn-form");if(c){c.addEventListener("submit",v=>{v.preventDefault(),Ae()});const o=document.getElementById("otp-authentication-form"),a=document.getElementById("link-to-otp");a==null||a.addEventListener("click",()=>{c.classList.add("hidden"),o==null||o.classList.remove("hidden"),Z()});const u=document.getElementById("link-to-webauthn");u==null||u.addEventListener("click",()=>{o==null||o.classList.add("hidden"),c.classList.remove("hidden"),Z()})}}).catch(n=>{throw n});
//# sourceMappingURL=two_factor_authentication-Csbc81XG.js.map
