import{j as e}from"./client-BG6VvM0b.js";import{u as H,r as m,d as G,G as w}from"./index-ykyyQSL-.js";import{c as y}from"./index-guCj-HqV.js";import{a as W,d as Q,u as z,bn as K,bo as F,I as R,b6 as T,b7 as X}from"./useSelectableClick-DBo53LOf.js";import{H as J,S as Y,a as Z}from"./hashtags-DNhYE1a4.js";import{S as ee}from"./close-DPVxbBbs.js";import{C as S,d as ae}from"./initial_state-BP3UcUr4.js";import{d as se}from"./short_number--sxn3OKQ.js";import{M as t}from"./message-Bb0z64dP.js";const _=G({placeholder:{id:"search.placeholder",defaultMessage:"Search"},placeholderSignedIn:{id:"search.search_or_paste",defaultMessage:"Search or paste URL"}}),oe=i=>{switch(i.type){case"account":return`@${i.q}`;case"hashtag":return`#${i.q}`;default:return i.q}},N=()=>{var i,f;(f=(i=document.querySelector(".ui"))==null?void 0:i.parentElement)==null||f.focus()},fe=({singleColumn:i,initialValue:f})=>{const M=H(),$=W(a=>a.search.recent),{signedIn:g}=Q(),d=z(),u=se(),D=m.useRef(null),[B,h]=m.useState(f??""),E=B.length>0,[I,V]=m.useState(!1),[r,c]=m.useState(-1),[v,x]=m.useState([]);m.useEffect(()=>{h(f??""),x([])},[f]);const k=[];S&&k.push({key:"prompt-has",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"has:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:87,columnNumber:13},void 0)," ",e.jsxDEV(w,{type:"disjunction",value:["media","poll","embed"]},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:88,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:86,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("has:")}},{key:"prompt-is",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"is:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:103,columnNumber:13},void 0)," ",e.jsxDEV(w,{type:"disjunction",value:["reply","sensitive"]},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:104,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:102,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("is:")}},{key:"prompt-language",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"language:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:116,columnNumber:13},void 0)," ",e.jsxDEV(t,{id:"search_popout.language_code",defaultMessage:"ISO language code"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:117,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:115,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("language:")}},{key:"prompt-from",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"from:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:132,columnNumber:13},void 0)," ",e.jsxDEV(t,{id:"search_popout.user",defaultMessage:"user"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:133,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:131,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("from:")}},{key:"prompt-before",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"before:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:145,columnNumber:13},void 0)," ",e.jsxDEV(t,{id:"search_popout.specific_date",defaultMessage:"specific date"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:146,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:144,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("before:")}},{key:"prompt-during",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"during:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:161,columnNumber:13},void 0)," ",e.jsxDEV(t,{id:"search_popout.specific_date",defaultMessage:"specific date"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:162,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:160,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("during:")}},{key:"prompt-after",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"after:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:177,columnNumber:13},void 0)," ",e.jsxDEV(t,{id:"search_popout.specific_date",defaultMessage:"specific date"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:178,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:176,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("after:")}},{key:"prompt-in",label:e.jsxDEV(e.Fragment,{children:[e.jsxDEV("mark",{children:"in:"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:193,columnNumber:13},void 0)," ",e.jsxDEV(w,{type:"disjunction",value:["all","library","public"]},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:194,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:192,columnNumber:9},void 0),action:a=>{a.preventDefault(),p("in:")}});const q=$.map(a=>({key:`${a.type}/${a.q}`,label:oe(a),action:()=>{if(h(a.q),a.type==="account")u.push(`/@${a.q}`);else if(a.type==="hashtag")u.push(`/tags/${a.q}`);else{const s=new URLSearchParams({q:a.q});a.type&&s.set("type",a.type),u.push({pathname:"/search",search:s.toString()})}N()},forget:s=>{s.stopPropagation(),d(K(a))}})),l=E?v.concat(k):q.concat(v,k),p=a=>{h(s=>s===""?a:s.endsWith(" ")?`${s}${a}`:`${s} ${a}`)},j=m.useCallback((a,s)=>{d(F({q:a,type:s}));const o=new URLSearchParams({q:a});s&&o.set("type",s),u.push({pathname:"/search",search:o.toString()}),N()},[d,u]),U=m.useCallback(({target:{value:a}})=>{h(a);const s=a.trim(),o=[];s.length>0&&(s.startsWith("https://")&&!s.includes(" ")&&o.push({key:"open-url",label:e.jsxDEV(t,{id:"search.quick_action.open_url",defaultMessage:"Open URL in Mastodon"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:274,columnNumber:13},void 0),action:async()=>{const n=await d(T({url:s}));X(n)&&(n.payload.accounts[0]?u.push(`/@${n.payload.accounts[0].acct}`):n.payload.statuses[0]&&u.push(`/@${n.payload.statuses[0].account.acct}/${n.payload.statuses[0].id}`)),N()}}),(s.startsWith("#")&&s.length>1||s.match(J))&&o.push({key:"go-to-hashtag",label:e.jsxDEV(t,{id:"search.quick_action.go_to_hashtag",defaultMessage:"Go to hashtag {x}",values:{x:e.jsxDEV("mark",{children:["#",s.replace(/^#/,"")]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:308,columnNumber:28},void 0)}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:305,columnNumber:13},void 0),action:()=>{const n=s.replace(/^#/,"");u.push(`/tags/${n}`),d(F({q:n,type:"hashtag"})),N()}}),/^@?[a-z0-9_-]+(@[^\s]+)?$/i.exec(s)&&o.push({key:"go-to-account",label:e.jsxDEV(t,{id:"search.quick_action.go_to_account",defaultMessage:"Go to profile {x}",values:{x:e.jsxDEV("mark",{children:["@",s.replace(/^@/,"")]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:329,columnNumber:28},void 0)}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:326,columnNumber:13},void 0),action:()=>{const n=s.replace(/^@/,"");u.push(`/@${n}`),d(F({q:n,type:"account"})),N()}}),S&&g&&o.push({key:"status-search",label:e.jsxDEV(t,{id:"search.quick_action.status_search",defaultMessage:"Posts matching {x}",values:{x:e.jsxDEV("mark",{children:s},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:350,columnNumber:28},void 0)}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:347,columnNumber:13},void 0),action:()=>{j(s,"statuses")}}),o.push({key:"account-search",label:e.jsxDEV(t,{id:"search.quick_action.account_search",defaultMessage:"Profiles matching {x}",values:{x:e.jsxDEV("mark",{children:s},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:365,columnNumber:26},void 0)}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:362,columnNumber:11},void 0),action:()=>{j(s,"accounts")}})),x(o)},[d,u,g,h,x,j]),A=m.useCallback(()=>{h(""),x([]),c(-1)},[h,x,c]),L=m.useCallback(a=>{var s;switch(a.key){case"Escape":a.preventDefault(),N();break;case"ArrowDown":a.preventDefault(),l.length>0&&c(Math.min(r+1,l.length-1));break;case"ArrowUp":a.preventDefault(),l.length>0&&c(Math.max(r-1,-1));break;case"Enter":a.preventDefault(),r===-1?j(B):l.length>0&&((s=l[r])==null||s.action(a));break;case"Delete":if(r>-1&&l.length>0){const o=l[r];typeof(o==null?void 0:o.forget)=="function"&&(a.preventDefault(),o.forget(a))}break}},[l,B,r,c,j]),O=m.useCallback(()=>{if(V(!0),c(-1),D.current&&!i){const{left:a,right:s}=D.current.getBoundingClientRect();(a<0||s>(window.innerWidth||document.documentElement.clientWidth))&&D.current.scrollIntoView()}},[V,c,i]),P=m.useCallback(()=>{V(!1),c(-1)},[V,c]);return e.jsxDEV("form",{className:y("search",{active:I}),children:[e.jsxDEV("input",{ref:D,className:"search__input",type:"text",placeholder:M.formatMessage(g?_.placeholderSignedIn:_.placeholder),"aria-label":M.formatMessage(g?_.placeholderSignedIn:_.placeholder),value:B,onChange:U,onKeyDown:L,onFocus:O,onBlur:P},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:460,columnNumber:7},void 0),e.jsxDEV("button",{type:"button",className:"search__icon",onClick:A,children:[e.jsxDEV(R,{id:"search",icon:Y,className:E?"":"active"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:478,columnNumber:9},void 0),e.jsxDEV(R,{id:"times-circle",icon:Z,className:E?"active":"","aria-label":M.formatMessage(_.placeholder)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:483,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:477,columnNumber:7},void 0),e.jsxDEV("div",{className:"search__popout",children:[!E&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("h4",{children:e.jsxDEV(t,{id:"search_popout.recent",defaultMessage:"Recent searches"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:495,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:494,columnNumber:13},void 0),e.jsxDEV("div",{className:"search__popout__menu",children:q.length>0?q.map(({label:a,key:s,action:o,forget:b},C)=>e.jsxDEV("div",{tabIndex:0,role:"button",onMouseDown:o,className:y("search__popout__menu__item search__popout__menu__item--flex",{selected:r===C}),children:[e.jsxDEV("span",{children:a},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:514,columnNumber:21},void 0),e.jsxDEV("button",{className:"icon-button",onMouseDown:b,children:e.jsxDEV(R,{id:"times",icon:ee},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:516,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:515,columnNumber:21},void 0)]},s,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:504,columnNumber:13},void 0)):e.jsxDEV("div",{className:"search__popout__menu__message",children:e.jsxDEV(t,{id:"search.no_recent_searches",defaultMessage:"No recent searches"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:522,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:521,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:501,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:493,columnNumber:9},void 0),v.length>0&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("h4",{children:e.jsxDEV(t,{id:"search_popout.quick_actions",defaultMessage:"Quick actions"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:535,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:534,columnNumber:13},void 0),e.jsxDEV("div",{className:"search__popout__menu",children:v.map(({key:a,label:s,action:o},b)=>e.jsxDEV("button",{onMouseDown:o,className:y("search__popout__menu__item",{selected:r===b}),children:s},a,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:543,columnNumber:13},void 0))},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:541,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:533,columnNumber:9},void 0),e.jsxDEV("h4",{children:e.jsxDEV(t,{id:"search_popout.options",defaultMessage:"Search options"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:558,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:557,columnNumber:9},void 0),S&&g?e.jsxDEV("div",{className:"search__popout__menu",children:k.map(({key:a,label:s,action:o},b)=>e.jsxDEV("button",{onMouseDown:o,className:y("search__popout__menu__item",{selected:r===(v.length||$.length)+b}),children:s},a,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:567,columnNumber:11},void 0))},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:565,columnNumber:9},void 0):e.jsxDEV("div",{className:"search__popout__menu__message",children:S?e.jsxDEV(t,{id:"search_popout.full_text_search_logged_out_message",defaultMessage:"Only available when logged in."},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:583,columnNumber:11},void 0):e.jsxDEV(t,{id:"search_popout.full_text_search_disabled_message",defaultMessage:"Not available on {domain}.",values:{domain:ae}},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:588,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:581,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:491,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/features/compose/components/search.tsx",lineNumber:459,columnNumber:5},void 0)};export{fe as S};
//# sourceMappingURL=search-D6XPU9bJ.js.map
