{"version":3,"file":"dismissable_banner-gWE579A1.js","sources":["../../app/javascript/mastodon/components/dismissable_banner.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-call,\n                  @typescript-eslint/no-unsafe-return,\n                  @typescript-eslint/no-unsafe-assignment,\n                  @typescript-eslint/no-unsafe-member-access\n                  -- the settings store is not yet typed */\nimport type { PropsWithChildren } from 'react';\nimport { useCallback, useState, useEffect } from 'react';\n\nimport { defineMessages, useIntl } from 'react-intl';\n\nimport CloseIcon from '@/material-icons/400-24px/close.svg?react';\nimport { changeSetting } from 'mastodon/actions/settings';\nimport { bannerSettings } from 'mastodon/settings';\nimport { useAppSelector, useAppDispatch } from 'mastodon/store';\n\nimport { IconButton } from './icon_button';\n\nconst messages = defineMessages({\n  dismiss: { id: 'dismissable_banner.dismiss', defaultMessage: 'Dismiss' },\n});\n\ninterface Props {\n  id: string;\n}\n\nexport const DismissableBanner: React.FC<PropsWithChildren<Props>> = ({\n  id,\n  children,\n}) => {\n  const dismissed = useAppSelector((state) =>\n    state.settings.getIn(['dismissed_banners', id], false),\n  );\n  const dispatch = useAppDispatch();\n\n  const [visible, setVisible] = useState(!bannerSettings.get(id) && !dismissed);\n  const intl = useIntl();\n\n  const handleDismiss = useCallback(() => {\n    setVisible(false);\n    bannerSettings.set(id, true);\n    dispatch(changeSetting(['dismissed_banners', id], true));\n  }, [id, dispatch]);\n\n  useEffect(() => {\n    if (!visible && !dismissed) {\n      dispatch(changeSetting(['dismissed_banners', id], true));\n    }\n  }, [id, dispatch, visible, dismissed]);\n\n  if (!visible) {\n    return null;\n  }\n\n  return (\n    <div className='dismissable-banner'>\n      <div className='dismissable-banner__action'>\n        <IconButton\n          icon='times'\n          iconComponent={CloseIcon}\n          title={intl.formatMessage(messages.dismiss)}\n          onClick={handleDismiss}\n        />\n      </div>\n\n      <div className='dismissable-banner__message'>{children}</div>\n    </div>\n  );\n};\n"],"names":["messages","defineMessages","dismiss","id","defaultMessage","DismissableBanner","children","dismissed","useAppSelector","state","settings","getIn","dispatch","useAppDispatch","visible","setVisible","useState","bannerSettings","get","intl","useIntl","handleDismiss","useCallback","set","changeSetting","useEffect","jsxDEV","IconButton","CloseIcon","formatMessage","this"],"mappings":"0NAiBA,MAAMA,EAAWC,EAAe,CAC9BC,QAAS,CAAEC,gCAAkCC,yBAC/C,CAAC,EAMYC,EAAwDA,CAAC,CACpEF,GAAAA,EACAG,SAAAA,CACF,IAAM,CACJ,MAAMC,EAAYC,EAAgBC,GAChCA,EAAMC,SAASC,MAAM,CAAC,oBAAqBR,CAAE,EAAG,EAAK,CAAA,EAEjDS,EAAWC,EAAAA,EAEX,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,CAACC,EAAeC,IAAIf,CAAE,GAAK,CAACI,CAAS,EACtEY,EAAOC,EAAAA,EAEPC,EAAgBC,EAAAA,YAAY,IAAM,CACtCP,EAAW,EAAK,EAChBE,EAAeM,IAAIpB,EAAI,EAAI,EAC3BS,EAASY,EAAc,CAAC,oBAAqBrB,CAAE,EAAG,EAAI,CAAC,CAAA,EACtD,CAACA,EAAIS,CAAQ,CAAC,EAQjB,OANAa,EAAAA,UAAU,IAAM,CACV,CAACX,GAAW,CAACP,GACfK,EAASY,EAAc,CAAC,oBAAqBrB,CAAE,EAAG,EAAI,CAAC,CACzD,EACC,CAACA,EAAIS,EAAUE,EAASP,CAAS,CAAC,EAEhCO,EAKHY,EAAAA,OAAC,MAAA,CAAI,UAAU,qBACb,SAAA,CAAAA,EAAAA,OAAC,MAAA,CAAI,UAAU,6BACb,SAAAA,EAAAA,OAACC,EAAA,CACC,KAAK,QACL,cAAeC,EACf,MAAOT,EAAKU,cAAc7B,EAASE,OAAO,EAC1C,QAASmB,CAAAA,EAJX,OAAA,GAAA,CAAA,SAAA,mGAAA,WAAA,GAAA,aAAA,CAAA,EAAAS,MAAA,CAIyB,EAL3B,OAAA,GAAA,CAAA,SAAA,mGAAA,WAAA,GAAA,aAAA,CAAA,EAAAA,MAOA,EAEAJ,EAAAA,OAAC,MAAA,CAAI,UAAU,8BAA+BpB,SAAAA,CAAAA,EAA9C,OAAA,GAAA,CAAA,SAAA,mGAAA,WAAA,GAAA,aAAA,CAAA,EAAAwB,MAAuD,CAAA,CAAA,EAVzD,OAAA,GAAA,CAAA,SAAA,mGAAA,WAAA,GAAA,aAAA,CAAA,EAAAA,MAWA,EAfO,IAiBX"}