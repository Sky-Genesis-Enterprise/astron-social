var S=Object.defineProperty;var W=(d,l,e)=>l in d?S(d,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[l]=e;var i=(d,l,e)=>W(d,typeof l!="symbol"?l+"":l,e);import{j as a}from"./client-BG6VvM0b.js";import{r as B}from"./index-ykyyQSL-.js";import{c as v}from"./index-guCj-HqV.js";import{be as E,H as L,bY as P,b4 as D,bZ as T}from"./useSelectableClick-DBo53LOf.js";import{A as R}from"./alt_text_badge-C63PD6vv.js";import{y as _,l as $,z as w}from"./initial_state-BP3UcUr4.js";import{M as F}from"./message-Bb0z64dP.js";import"./short_number--sxn3OKQ.js";import"./numbers-CGZQWBYL.js";import"./api-uqk9CYtW.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./index-DHslUCy5.js";import"./load_locale-C-B7BkCQ.js";class y extends B.PureComponent{constructor(){super(...arguments);i(this,"state",{loaded:!1,error:!1});i(this,"handleMouseEnter",e=>{this.hoverToPlay()&&e.target.play()});i(this,"handleMouseLeave",e=>{this.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0)});i(this,"handleClick",e=>{const{index:o,onClick:c}=this.props;e.button===0&&!(e.ctrlKey||e.metaKey)&&(this.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0),e.preventDefault(),c(o)),e.stopPropagation()});i(this,"handleImageLoad",()=>{this.setState({loaded:!0})});i(this,"handleImageError",()=>{this.setState({error:!0})})}getAutoPlay(){return this.props.autoplay||$}hoverToPlay(){const{attachment:e}=this.props;return!this.getAutoPlay()&&["gifv","video"].includes(e.get("type"))}render(){const{attachment:e,lang:o,index:c,size:g,standalone:b,displayWidth:f,visible:m}=this.props;let n=[],h,r=50,u=100;g===1&&(r=100),(g===4||g===3&&c>0)&&(u=50);const t=e.getIn(["translation","description"])||e.get("description");if((t==null?void 0:t.length)>0&&n.push(a.jsxDEV(R,{description:t},"alt",!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:109,columnNumber:19},this)),e.get("type")==="unknown")return a.jsxDEV("div",{className:v("media-gallery__item",{standalone:b,"media-gallery__item--tall":u===100,"media-gallery__item--wide":r===100}),children:a.jsxDEV("a",{className:"media-gallery__item-thumbnail",href:e.get("remote_url")||e.get("url"),style:{cursor:"pointer"},title:t,lang:o,target:"_blank",rel:"noopener",children:a.jsxDEV(D,{hash:e.get("blurhash"),className:"media-gallery__preview",dummy:!w},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:116,columnNumber:13},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:115,columnNumber:11},this)},e.get("id"),!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:114,columnNumber:9},this);if(e.get("type")==="image"){const s=e.get("preview_url"),p=e.getIn(["meta","small","width"]),N=e.get("url"),j=e.getIn(["meta","original","width"]),x=typeof j=="number"&&typeof p=="number",V=x?`${N} ${j}w, ${s} ${p}w`:null,z=x&&f>0?`${f*(r/100)}px`:null,k=e.getIn(["meta","focus","x"])||0,M=e.getIn(["meta","focus","y"])||0,C=(k/2+.5)*100,I=(M/-2+.5)*100;h=a.jsxDEV("a",{className:"media-gallery__item-thumbnail",href:e.get("remote_url")||N,onClick:this.handleClick,target:"_blank",rel:"noopener",children:a.jsxDEV("img",{src:s,srcSet:V,sizes:z,alt:t,lang:o,style:{objectPosition:`${C}% ${I}%`},onLoad:this.handleImageLoad,onError:this.handleImageError},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:149,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:142,columnNumber:7},this)}else if(["gifv","video"].includes(e.get("type"))){const s=this.getAutoPlay(),p=e.getIn(["meta","original","duration"]);e.get("type")==="gifv"?n.push(a.jsxDEV("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:"GIF"},"gif",!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:166,columnNumber:21},this)):n.push(a.jsxDEV("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:T(Math.floor(p))},"video",!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:168,columnNumber:21},this)),h=a.jsxDEV("div",{className:v("media-gallery__gifv",{autoplay:s}),children:a.jsxDEV("video",{className:"media-gallery__item-gifv-thumbnail","aria-label":t,lang:o,role:"application",src:e.get("url"),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onLoadedData:this.handleImageLoad,autoPlay:s,playsInline:!0,loop:!0,muted:!0},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:173,columnNumber:11},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:172,columnNumber:7},this)}return a.jsxDEV("div",{className:v("media-gallery__item",{standalone:b,"media-gallery__item--error":this.state.error,"media-gallery__item--tall":u===100,"media-gallery__item--wide":r===100}),children:[a.jsxDEV(D,{hash:e.get("blurhash"),dummy:!w,className:v("media-gallery__preview",{"media-gallery__preview--hidden":m&&this.state.loaded})},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:194,columnNumber:9},this),m&&h,m&&n&&a.jsxDEV("div",{className:"media-gallery__item__badges",children:n},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:205,columnNumber:9},this)]},e.get("id"),!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:193,columnNumber:7},this)}}i(y,"defaultProps",{standalone:!1,index:0,size:1});class te extends B.PureComponent{constructor(){super(...arguments);i(this,"state",{visible:this.props.visible!==void 0?this.props.visible:_!=="hide_all"&&!this.props.sensitive||_==="show_all",width:this.props.defaultWidth});i(this,"handleResize",L(()=>{this.node&&this._setDimensions()},250,{trailing:!0}));i(this,"handleOpen",()=>{this.props.onToggleVisibility?this.props.onToggleVisibility():this.setState({visible:!this.state.visible})});i(this,"handleClick",e=>{this.props.onOpenMedia(this.props.media,e,this.props.lang)});i(this,"handleRef",e=>{this.node=e,this.node&&this._setDimensions()})}componentDidMount(){window.addEventListener("resize",this.handleResize,{passive:!0})}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}UNSAFE_componentWillReceiveProps(e){!E(e.media,this.props.media)&&e.visible===void 0?this.setState({visible:_!=="hide_all"&&!e.sensitive||_==="show_all"}):!E(e.visible,this.props.visible)&&e.visible!==void 0&&this.setState({visible:e.visible})}_setDimensions(){const e=this.node.offsetWidth;this.props.cacheWidth&&this.props.cacheWidth(e),this.setState({width:e})}isFullSizeEligible(){const{media:e}=this.props;return e.size===1&&e.getIn([0,"meta","small","aspect"])}render(){const{media:e,lang:o,sensitive:c,defaultWidth:g,autoplay:b,matchedFilters:f}=this.props,{visible:m}=this.state,n=this.state.width||g;let h;const r={};this.isFullSizeEligible()?r.aspectRatio=`${this.props.media.getIn([0,"meta","small","aspect"])}`:r.aspectRatio="3 / 2";const u=e.size,t=e.every(s=>s.get("type")==="unknown");return this.isFullSizeEligible()?h=a.jsxDEV(y,{standalone:!0,autoplay:b,onClick:this.handleClick,attachment:e.get(0),lang:o,displayWidth:n,visible:m},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:318,columnNumber:18},this):h=e.map((s,p)=>a.jsxDEV(y,{autoplay:b,onClick:this.handleClick,attachment:s,index:p,lang:o,size:u,displayWidth:n,visible:m||t},s.get("id"),!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:320,columnNumber:47},this)),a.jsxDEV("div",{className:`media-gallery media-gallery--layout-${u}`,style:r,ref:this.handleRef,children:[h,(!m||t)&&a.jsxDEV(P,{uncached:t,sensitive:c,onClick:this.handleOpen,matchedFilters:f},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:327,columnNumber:36},this),m&&!t&&a.jsxDEV("div",{className:"media-gallery__actions",children:a.jsxDEV("button",{className:"media-gallery__actions__pill",onClick:this.handleOpen,children:a.jsxDEV(F,{id:"media_gallery.hide",defaultMessage:"Hide"},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:331,columnNumber:88},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:331,columnNumber:13},this)},void 0,!1,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:330,columnNumber:9},this)]},void 0,!0,{fileName:"/home/liam-esia/Bureau/github/mastodon/app/javascript/mastodon/components/media_gallery.jsx",lineNumber:324,columnNumber:7},this)}}export{te as default};
//# sourceMappingURL=media_gallery-D8AVjLNK.js.map
