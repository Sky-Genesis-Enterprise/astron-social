import{j as e}from"./client-wT6vtYO_.js";import{u as G,r as o,d as W,G as $}from"./index-BdTwX--g.js";import{c as w}from"./index-DizoKcfL.js";import{a as Q,d as z,u as K,bn as T,bo as C,I,b6 as X,b7 as J}from"./useSelectableClick-DeaJbL2_.js";import{H as Y,S as Z,a as V}from"./hashtags-DlzQcrtL.js";import{S as ee}from"./close-BsPe8EbX.js";import{C as N,d as se}from"./initial_state-BP3UcUr4.js";import{d as ae}from"./short_number-WomMu2iV.js";import{M as c}from"./message-UFwkQlnu.js";const y=W({placeholder:{id:"search.placeholder",defaultMessage:"Search"},placeholderSignedIn:{id:"search.search_or_paste",defaultMessage:"Search or paste URL"}}),te=r=>{switch(r.type){case"account":return`@${r.q}`;case"hashtag":return`#${r.q}`;default:return r.q}},_=()=>{var r,f;(f=(r=document.querySelector(".ui"))==null?void 0:r.parentElement)==null||f.focus()},fe=({singleColumn:r,initialValue:f})=>{const F=G(),B=Q(s=>s.search.recent),{signedIn:x}=z(),h=K(),l=ae(),v=o.useRef(null),[S,m]=o.useState(f??""),M=S.length>0,[U,q]=o.useState(!1),[i,u]=o.useState(-1),[j,b]=o.useState([]);o.useEffect(()=>{m(f??""),b([])},[f]);const D=[];N&&D.push({key:"prompt-has",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"has:"})," ",e.jsx($,{type:"disjunction",value:["media","poll","embed"]})]}),action:s=>{s.preventDefault(),p("has:")}},{key:"prompt-is",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"is:"})," ",e.jsx($,{type:"disjunction",value:["reply","sensitive"]})]}),action:s=>{s.preventDefault(),p("is:")}},{key:"prompt-language",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"language:"})," ",e.jsx(c,{id:"search_popout.language_code",defaultMessage:"ISO language code"})]}),action:s=>{s.preventDefault(),p("language:")}},{key:"prompt-from",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"from:"})," ",e.jsx(c,{id:"search_popout.user",defaultMessage:"user"})]}),action:s=>{s.preventDefault(),p("from:")}},{key:"prompt-before",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"before:"})," ",e.jsx(c,{id:"search_popout.specific_date",defaultMessage:"specific date"})]}),action:s=>{s.preventDefault(),p("before:")}},{key:"prompt-during",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"during:"})," ",e.jsx(c,{id:"search_popout.specific_date",defaultMessage:"specific date"})]}),action:s=>{s.preventDefault(),p("during:")}},{key:"prompt-after",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"after:"})," ",e.jsx(c,{id:"search_popout.specific_date",defaultMessage:"specific date"})]}),action:s=>{s.preventDefault(),p("after:")}},{key:"prompt-in",label:e.jsxs(e.Fragment,{children:[e.jsx("mark",{children:"in:"})," ",e.jsx($,{type:"disjunction",value:["all","library","public"]})]}),action:s=>{s.preventDefault(),p("in:")}});const R=B.map(s=>({key:`${s.type}/${s.q}`,label:te(s),action:()=>{if(m(s.q),s.type==="account")l.push(`/@${s.q}`);else if(s.type==="hashtag")l.push(`/tags/${s.q}`);else{const a=new URLSearchParams({q:s.q});s.type&&a.set("type",s.type),l.push({pathname:"/search",search:a.toString()})}_()},forget:a=>{a.stopPropagation(),h(T(s))}})),d=M?j.concat(D):R.concat(j,D),p=s=>{m(a=>a===""?s:a.endsWith(" ")?`${a}${s}`:`${a} ${s}`)},k=o.useCallback((s,a)=>{h(C({q:s,type:a}));const t=new URLSearchParams({q:s});a&&t.set("type",a),l.push({pathname:"/search",search:t.toString()}),_()},[h,l]),A=o.useCallback(({target:{value:s}})=>{m(s);const a=s.trim(),t=[];a.length>0&&(a.startsWith("https://")&&!a.includes(" ")&&t.push({key:"open-url",label:e.jsx(c,{id:"search.quick_action.open_url",defaultMessage:"Open URL in Mastodon"}),action:async()=>{const n=await h(X({url:a}));J(n)&&(n.payload.accounts[0]?l.push(`/@${n.payload.accounts[0].acct}`):n.payload.statuses[0]&&l.push(`/@${n.payload.statuses[0].account.acct}/${n.payload.statuses[0].id}`)),_()}}),(a.startsWith("#")&&a.length>1||a.match(Y))&&t.push({key:"go-to-hashtag",label:e.jsx(c,{id:"search.quick_action.go_to_hashtag",defaultMessage:"Go to hashtag {x}",values:{x:e.jsxs("mark",{children:["#",a.replace(/^#/,"")]})}}),action:()=>{const n=a.replace(/^#/,"");l.push(`/tags/${n}`),h(C({q:n,type:"hashtag"})),_()}}),/^@?[a-z0-9_-]+(@[^\s]+)?$/i.exec(a)&&t.push({key:"go-to-account",label:e.jsx(c,{id:"search.quick_action.go_to_account",defaultMessage:"Go to profile {x}",values:{x:e.jsxs("mark",{children:["@",a.replace(/^@/,"")]})}}),action:()=>{const n=a.replace(/^@/,"");l.push(`/@${n}`),h(C({q:n,type:"account"})),_()}}),N&&x&&t.push({key:"status-search",label:e.jsx(c,{id:"search.quick_action.status_search",defaultMessage:"Posts matching {x}",values:{x:e.jsx("mark",{children:a})}}),action:()=>{k(a,"statuses")}}),t.push({key:"account-search",label:e.jsx(c,{id:"search.quick_action.account_search",defaultMessage:"Profiles matching {x}",values:{x:e.jsx("mark",{children:a})}}),action:()=>{k(a,"accounts")}})),b(t)},[h,l,x,m,b,k]),L=o.useCallback(()=>{m(""),b([]),u(-1)},[m,b,u]),O=o.useCallback(s=>{var a;switch(s.key){case"Escape":s.preventDefault(),_();break;case"ArrowDown":s.preventDefault(),d.length>0&&u(Math.min(i+1,d.length-1));break;case"ArrowUp":s.preventDefault(),d.length>0&&u(Math.max(i-1,-1));break;case"Enter":s.preventDefault(),i===-1?k(S):d.length>0&&((a=d[i])==null||a.action(s));break;case"Delete":if(i>-1&&d.length>0){const t=d[i];typeof(t==null?void 0:t.forget)=="function"&&(s.preventDefault(),t.forget(s))}break}},[d,S,i,u,k]),P=o.useCallback(()=>{if(q(!0),u(-1),v.current&&!r){const{left:s,right:a}=v.current.getBoundingClientRect();(s<0||a>(window.innerWidth||document.documentElement.clientWidth))&&v.current.scrollIntoView()}},[q,u,r]),H=o.useCallback(()=>{q(!1),u(-1)},[q,u]);return e.jsxs("form",{className:w("search",{active:U}),children:[e.jsx("input",{ref:v,className:"search__input",type:"text",placeholder:F.formatMessage(x?y.placeholderSignedIn:y.placeholder),"aria-label":F.formatMessage(x?y.placeholderSignedIn:y.placeholder),value:S,onChange:A,onKeyDown:O,onFocus:P,onBlur:H}),e.jsxs("button",{type:"button",className:"search__icon",onClick:L,children:[e.jsx(I,{id:"search",icon:Z,className:M?"":"active"}),e.jsx(I,{id:"times-circle",icon:V,className:M?"active":"","aria-label":F.formatMessage(y.placeholder)})]}),e.jsxs("div",{className:"search__popout",children:[!M&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:e.jsx(c,{id:"search_popout.recent",defaultMessage:"Recent searches"})}),e.jsx("div",{className:"search__popout__menu",children:R.length>0?R.map(({label:s,key:a,action:t,forget:g},E)=>e.jsxs("div",{tabIndex:0,role:"button",onMouseDown:t,className:w("search__popout__menu__item search__popout__menu__item--flex",{selected:i===E}),children:[e.jsx("span",{children:s}),e.jsx("button",{className:"icon-button",onMouseDown:g,children:e.jsx(I,{id:"times",icon:ee})})]},a)):e.jsx("div",{className:"search__popout__menu__message",children:e.jsx(c,{id:"search.no_recent_searches",defaultMessage:"No recent searches"})})})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:e.jsx(c,{id:"search_popout.quick_actions",defaultMessage:"Quick actions"})}),e.jsx("div",{className:"search__popout__menu",children:j.map(({key:s,label:a,action:t},g)=>e.jsx("button",{onMouseDown:t,className:w("search__popout__menu__item",{selected:i===g}),children:a},s))})]}),e.jsx("h4",{children:e.jsx(c,{id:"search_popout.options",defaultMessage:"Search options"})}),N&&x?e.jsx("div",{className:"search__popout__menu",children:D.map(({key:s,label:a,action:t},g)=>e.jsx("button",{onMouseDown:t,className:w("search__popout__menu__item",{selected:i===(j.length||B.length)+g}),children:a},s))}):e.jsx("div",{className:"search__popout__menu__message",children:N?e.jsx(c,{id:"search_popout.full_text_search_logged_out_message",defaultMessage:"Only available when logged in."}):e.jsx(c,{id:"search_popout.full_text_search_disabled_message",defaultMessage:"Not available on {domain}.",values:{domain:se}})})]})]})};export{fe as S};
//# sourceMappingURL=search-BPrZ-C9C.js.map
