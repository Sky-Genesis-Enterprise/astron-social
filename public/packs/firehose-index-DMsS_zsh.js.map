{"version":3,"file":"firehose-index-DMsS_zsh.js","sources":["../../app/javascript/mastodon/features/firehose/index.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport { useRef, useCallback, useEffect } from 'react';\n\nimport { useIntl, defineMessages, FormattedMessage } from 'react-intl';\n\nimport { Helmet } from 'react-helmet';\nimport { NavLink } from 'react-router-dom';\n\nimport { useIdentity } from '@/mastodon/identity_context';\nimport PublicIcon from '@/material-icons/400-24px/public.svg?react';\nimport { addColumn } from 'mastodon/actions/columns';\nimport { changeSetting } from 'mastodon/actions/settings';\nimport { connectPublicStream, connectCommunityStream } from 'mastodon/actions/streaming';\nimport { expandPublicTimeline, expandCommunityTimeline } from 'mastodon/actions/timelines';\nimport { DismissableBanner } from 'mastodon/components/dismissable_banner';\nimport { domain } from 'mastodon/initial_state';\nimport { useAppDispatch, useAppSelector } from 'mastodon/store';\n\nimport Column from '../../components/column';\nimport ColumnHeader from '../../components/column_header';\nimport SettingToggle from '../notifications/components/setting_toggle';\nimport StatusListContainer from '../ui/containers/status_list_container';\n\nconst messages = defineMessages({\n  title: { id: 'column.firehose', defaultMessage: 'Live feeds' },\n});\n\nconst ColumnSettings = () => {\n  const dispatch = useAppDispatch();\n  const settings = useAppSelector((state) => state.getIn(['settings', 'firehose']));\n  const onChange = useCallback(\n    (key, checked) => dispatch(changeSetting(['firehose', ...key], checked)),\n    [dispatch],\n  );\n\n  return (\n    <div className='column-settings'>\n      <section>\n        <div className='column-settings__row'>\n          <SettingToggle\n            settings={settings}\n            settingPath={['onlyMedia']}\n            onChange={onChange}\n            label={<FormattedMessage id='community.column_settings.media_only' defaultMessage='Media only' />}\n          />\n        </div>\n      </section>\n    </div>\n  );\n};\n\nconst Firehose = ({ feedType, multiColumn }) => {\n  const dispatch = useAppDispatch();\n  const intl = useIntl();\n  const { signedIn } = useIdentity();\n  const columnRef = useRef(null);\n\n  const onlyMedia = useAppSelector((state) => state.getIn(['settings', 'firehose', 'onlyMedia'], false));\n  const hasUnread = useAppSelector((state) => state.getIn(['timelines', `${feedType}${onlyMedia ? ':media' : ''}`, 'unread'], 0) > 0);\n\n  const handlePin = useCallback(\n    () => {\n      switch(feedType) {\n      case 'community':\n        dispatch(addColumn('COMMUNITY', { other: { onlyMedia } }));\n        break;\n      case 'public':\n        dispatch(addColumn('PUBLIC', { other: { onlyMedia } }));\n        break;\n      case 'public:remote':\n        dispatch(addColumn('REMOTE', { other: { onlyMedia, onlyRemote: true } }));\n        break;\n      }\n    },\n    [dispatch, onlyMedia, feedType],\n  );\n\n  const handleLoadMore = useCallback(\n    (maxId) => {\n      switch(feedType) {\n      case 'community':\n        dispatch(expandCommunityTimeline({ maxId, onlyMedia }));\n        break;\n      case 'public':\n        dispatch(expandPublicTimeline({ maxId, onlyMedia }));\n        break;\n      case 'public:remote':\n        dispatch(expandPublicTimeline({ maxId, onlyMedia, onlyRemote: true }));\n        break;\n      }\n    },\n    [dispatch, onlyMedia, feedType],\n  );\n\n  const handleHeaderClick = useCallback(() => columnRef.current?.scrollTop(), []);\n\n  useEffect(() => {\n    let disconnect;\n\n    switch(feedType) {\n    case 'community':\n      dispatch(expandCommunityTimeline({ onlyMedia }));\n      if (signedIn) {\n        disconnect = dispatch(connectCommunityStream({ onlyMedia }));\n      }\n      break;\n    case 'public':\n      dispatch(expandPublicTimeline({ onlyMedia }));\n      if (signedIn) {\n        disconnect = dispatch(connectPublicStream({ onlyMedia }));\n      }\n      break;\n    case 'public:remote':\n      dispatch(expandPublicTimeline({ onlyMedia, onlyRemote: true }));\n      if (signedIn) {\n        disconnect = dispatch(connectPublicStream({ onlyMedia, onlyRemote: true }));\n      }\n      break;\n    }\n\n    return () => disconnect?.();\n  }, [dispatch, signedIn, feedType, onlyMedia]);\n\n  const prependBanner = feedType === 'community' ? (\n    <DismissableBanner id='community_timeline'>\n      <FormattedMessage\n        id='dismissable_banner.community_timeline'\n        defaultMessage='These are the most recent public posts from people whose accounts are hosted by {domain}.'\n        values={{ domain }}\n      />\n    </DismissableBanner>\n  ) : (\n    <DismissableBanner id='public_timeline'>\n      <FormattedMessage\n        id='dismissable_banner.public_timeline'\n        defaultMessage='These are the most recent public posts from people on the fediverse that people on {domain} follow.'\n        values={{ domain }}\n      />\n    </DismissableBanner>\n  );\n\n  const emptyMessage = feedType === 'community' ? (\n    <FormattedMessage\n      id='empty_column.community'\n      defaultMessage='The local timeline is empty. Write something publicly to get the ball rolling!'\n    />\n  ) : (\n    <FormattedMessage\n      id='empty_column.public'\n      defaultMessage='There is nothing here! Write something publicly, or manually follow users from other servers to fill it up'\n    />\n  );\n\n  return (\n    <Column bindToDocument={!multiColumn} ref={columnRef} label={intl.formatMessage(messages.title)}>\n      <ColumnHeader\n        icon='globe'\n        iconComponent={PublicIcon}\n        active={hasUnread}\n        title={intl.formatMessage(messages.title)}\n        onPin={handlePin}\n        onClick={handleHeaderClick}\n        multiColumn={multiColumn}\n      >\n        <ColumnSettings />\n      </ColumnHeader>\n\n      <div className='account__section-headline'>\n        <NavLink exact to='/public/local'>\n          <FormattedMessage tagName='div' id='firehose.local' defaultMessage='This server' />\n        </NavLink>\n\n        <NavLink exact to='/public/remote'>\n          <FormattedMessage tagName='div' id='firehose.remote' defaultMessage='Other servers' />\n        </NavLink>\n\n        <NavLink exact to='/public'>\n          <FormattedMessage tagName='div' id='firehose.all' defaultMessage='All' />\n        </NavLink>\n      </div>\n\n      <StatusListContainer\n        prepend={prependBanner}\n        timelineId={`${feedType}${onlyMedia ? ':media' : ''}`}\n        onLoadMore={handleLoadMore}\n        trackScroll\n        scrollKey='firehose'\n        emptyMessage={emptyMessage}\n        bindToDocument={!multiColumn}\n      />\n\n      <Helmet>\n        <title>{intl.formatMessage(messages.title)}</title>\n        <meta name='robots' content='noindex' />\n      </Helmet>\n    </Column>\n  );\n};\n\nFirehose.propTypes = {\n  multiColumn: PropTypes.bool,\n  feedType: PropTypes.string,\n};\n\nexport default Firehose;\n"],"names":["messages","defineMessages","title","id","defaultMessage","ColumnSettings","dispatch","useAppDispatch","settings","useAppSelector","state","getIn","onChange","useCallback","key","checked","changeSetting","jsx","SettingToggle","FormattedMessage","Firehose","feedType","multiColumn","intl","useIntl","signedIn","useIdentity","columnRef","useRef","onlyMedia","hasUnread","handlePin","addColumn","other","onlyRemote","handleLoadMore","maxId","expandCommunityTimeline","expandPublicTimeline","handleHeaderClick","current","scrollTop","useEffect","disconnect","connectCommunityStream","connectPublicStream","prependBanner","DismissableBanner","domain","emptyMessage","jsxs","Column","formatMessage","ColumnHeader","PublicIcon","NavLink","StatusListContainer","Helmet"],"mappings":"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"}