{"version":3,"file":"compare_history_modal-CW5nOdPV.js","sources":["../../app/javascript/mastodon/features/ui/components/compare_history_modal.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport { FormattedMessage } from 'react-intl';\n\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport { connect } from 'react-redux';\n\nimport escapeTextContentForBrowser from 'escape-html';\n\nimport CloseIcon from '@/material-icons/400-24px/close.svg?react';\nimport { closeModal } from 'mastodon/actions/modal';\nimport { IconButton } from 'mastodon/components/icon_button';\nimport InlineAccount from 'mastodon/components/inline_account';\nimport MediaAttachments from 'mastodon/components/media_attachments';\nimport { RelativeTimestamp } from 'mastodon/components/relative_timestamp';\nimport emojify from 'mastodon/features/emoji/emoji';\n\nconst mapStateToProps = (state, { statusId }) => ({\n  language: state.getIn(['statuses', statusId, 'language']),\n  versions: state.getIn(['history', statusId, 'items']),\n});\n\nconst mapDispatchToProps = dispatch => ({\n\n  onClose() {\n    dispatch(closeModal({\n      modalType: undefined,\n      ignoreFocus: false,\n    }));\n  },\n\n});\n\nclass CompareHistoryModal extends PureComponent {\n\n  static propTypes = {\n    onClose: PropTypes.func.isRequired,\n    index: PropTypes.number.isRequired,\n    statusId: PropTypes.string.isRequired,\n    language: PropTypes.string.isRequired,\n    versions: ImmutablePropTypes.list.isRequired,\n  };\n\n  render () {\n    const { index, versions, language, onClose } = this.props;\n    const currentVersion = versions.get(index);\n\n    const emojiMap = currentVersion.get('emojis').reduce((obj, emoji) => {\n      obj[`:${emoji.get('shortcode')}:`] = emoji.toJS();\n      return obj;\n    }, {});\n\n    const content = { __html: emojify(currentVersion.get('content'), emojiMap) };\n    const spoilerContent = { __html: emojify(escapeTextContentForBrowser(currentVersion.get('spoiler_text')), emojiMap) };\n\n    const formattedDate = <RelativeTimestamp timestamp={currentVersion.get('created_at')} short={false} />;\n    const formattedName = <InlineAccount accountId={currentVersion.get('account')} />;\n\n    const label = currentVersion.get('original') ? (\n      <FormattedMessage id='status.history.created' defaultMessage='{name} created {date}' values={{ name: formattedName, date: formattedDate }} />\n    ) : (\n      <FormattedMessage id='status.history.edited' defaultMessage='{name} edited {date}' values={{ name: formattedName, date: formattedDate }} />\n    );\n\n    return (\n      <div className='modal-root__modal compare-history-modal'>\n        <div className='report-modal__target'>\n          <IconButton className='report-modal__close' icon='times' iconComponent={CloseIcon} onClick={onClose} size={20} />\n          {label}\n        </div>\n\n        <div className='compare-history-modal__container'>\n          <div className='status__content'>\n            {currentVersion.get('spoiler_text').length > 0 && (\n              <>\n                <div className='translate' dangerouslySetInnerHTML={spoilerContent} lang={language} />\n                <hr />\n              </>\n            )}\n\n            <div className='status__content__text status__content__text--visible translate' dangerouslySetInnerHTML={content} lang={language} />\n\n            {!!currentVersion.get('poll') && (\n              <div className='poll'>\n                <ul>\n                  {currentVersion.getIn(['poll', 'options']).map(option => (\n                    <li key={option.get('title')}>\n                      <span className='poll__input disabled' />\n\n                      <span\n                        className='poll__option__text translate'\n                        dangerouslySetInnerHTML={{ __html: emojify(escapeTextContentForBrowser(option.get('title')), emojiMap) }}\n                        lang={language}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            <MediaAttachments status={currentVersion} lang={language} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CompareHistoryModal);\n"],"names":["mapStateToProps","state","statusId","language","getIn","versions","mapDispatchToProps","dispatch","onClose","closeModal","modalType","undefined","ignoreFocus","CompareHistoryModal","PureComponent","render","index","props","currentVersion","get","emojiMap","reduce","obj","emoji","toJS","content","__html","emojify","spoilerContent","escapeTextContentForBrowser","formattedDate","RelativeTimestamp","formattedName","jsx","InlineAccount","label","FormattedMessage","name","date","jsxs","IconButton","CloseIcon","length","Fragment","map","option","MediaAttachments","compare_history_modal","connect"],"mappings":"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"}