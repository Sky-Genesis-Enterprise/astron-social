{"version":3,"file":"profile-gfKtu6Mr.js","sources":["../../app/javascript/material-icons/400-24px/add_photo_alternate.svg?react","../../app/javascript/mastodon/features/onboarding/profile.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgAddPhotoAlternate = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", height: 24, viewBox: \"0 -960 960 960\", width: 24, ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M480-480ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h320v80H200v560h560v-320h80v320q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Zm440-320v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80Z\" }));\nexport default SvgAddPhotoAlternate;\n","import { useState, useMemo, useCallback, createRef } from 'react';\n\nimport { useIntl, defineMessages, FormattedMessage } from 'react-intl';\n\nimport classNames from 'classnames';\nimport { Helmet } from 'react-helmet';\nimport { useHistory } from 'react-router-dom';\n\nimport Toggle from 'react-toggle';\n\nimport AddPhotoAlternateIcon from '@/material-icons/400-24px/add_photo_alternate.svg?react';\nimport EditIcon from '@/material-icons/400-24px/edit.svg?react';\nimport PersonIcon from '@/material-icons/400-24px/person.svg?react';\nimport { updateAccount } from 'mastodon/actions/accounts';\nimport { closeOnboarding } from 'mastodon/actions/onboarding';\nimport { Button } from 'mastodon/components/button';\nimport { Column } from 'mastodon/components/column';\nimport { ColumnHeader } from 'mastodon/components/column_header';\nimport { Icon } from 'mastodon/components/icon';\nimport { LoadingIndicator } from 'mastodon/components/loading_indicator';\nimport { me } from 'mastodon/initial_state';\nimport { useAppSelector, useAppDispatch } from 'mastodon/store';\nimport { unescapeHTML } from 'mastodon/utils/html';\n\nconst messages = defineMessages({\n  title: {\n    id: 'onboarding.profile.title',\n    defaultMessage: 'Profile setup',\n  },\n  uploadHeader: {\n    id: 'onboarding.profile.upload_header',\n    defaultMessage: 'Upload profile header',\n  },\n  uploadAvatar: {\n    id: 'onboarding.profile.upload_avatar',\n    defaultMessage: 'Upload profile picture',\n  },\n});\n\nconst nullIfMissing = (path: string) =>\n  path.endsWith('missing.png') ? null : path;\n\ninterface ApiAccountErrors {\n  display_name?: unknown;\n  note?: unknown;\n  avatar?: unknown;\n  header?: unknown;\n}\n\nexport const Profile: React.FC<{\n  multiColumn?: boolean;\n}> = ({ multiColumn }) => {\n  const account = useAppSelector((state) =>\n    me ? state.accounts.get(me) : undefined,\n  );\n  const [displayName, setDisplayName] = useState(account?.display_name ?? '');\n  const [note, setNote] = useState(\n    account ? (unescapeHTML(account.note) ?? '') : '',\n  );\n  const [avatar, setAvatar] = useState<File>();\n  const [header, setHeader] = useState<File>();\n  const [discoverable, setDiscoverable] = useState(\n    account?.discoverable ?? true,\n  );\n  const [isSaving, setIsSaving] = useState(false);\n  const [errors, setErrors] = useState<ApiAccountErrors>();\n  const avatarFileRef = createRef<HTMLInputElement>();\n  const headerFileRef = createRef<HTMLInputElement>();\n  const dispatch = useAppDispatch();\n  const intl = useIntl();\n  const history = useHistory();\n\n  const handleDisplayNameChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setDisplayName(e.target.value);\n    },\n    [setDisplayName],\n  );\n\n  const handleNoteChange = useCallback(\n    (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      setNote(e.target.value);\n    },\n    [setNote],\n  );\n\n  const handleDiscoverableChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setDiscoverable(e.target.checked);\n    },\n    [setDiscoverable],\n  );\n\n  const handleAvatarChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setAvatar(e.target.files?.[0]);\n    },\n    [setAvatar],\n  );\n\n  const handleHeaderChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setHeader(e.target.files?.[0]);\n    },\n    [setHeader],\n  );\n\n  const avatarPreview = useMemo(\n    () =>\n      avatar\n        ? URL.createObjectURL(avatar)\n        : nullIfMissing(account?.avatar ?? 'missing.png'),\n    [avatar, account],\n  );\n  const headerPreview = useMemo(\n    () =>\n      header\n        ? URL.createObjectURL(header)\n        : nullIfMissing(account?.header ?? 'missing.png'),\n    [header, account],\n  );\n\n  const handleSubmit = useCallback(() => {\n    setIsSaving(true);\n\n    dispatch(\n      updateAccount({\n        displayName,\n        note,\n        avatar,\n        header,\n        discoverable,\n        indexable: discoverable,\n      }),\n    )\n      .then(() => {\n        history.push('/start/follows');\n        dispatch(closeOnboarding());\n        return '';\n      })\n      // eslint-disable-next-line @typescript-eslint/use-unknown-in-catch-callback-variable\n      .catch((err) => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        if (err.response) {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n          const { details }: { details: ApiAccountErrors } = err.response.data;\n          setErrors(details);\n        }\n\n        setIsSaving(false);\n      });\n  }, [dispatch, displayName, note, avatar, header, discoverable, history]);\n\n  return (\n    <Column\n      bindToDocument={!multiColumn}\n      label={intl.formatMessage(messages.title)}\n    >\n      <ColumnHeader\n        title={intl.formatMessage(messages.title)}\n        icon='person'\n        iconComponent={PersonIcon}\n        multiColumn={multiColumn}\n      />\n\n      <div className='scrollable scrollable--flex'>\n        <div className='simple_form app-form'>\n          <div className='onboarding__profile'>\n            <label\n              className={classNames('app-form__header-input', {\n                selected: !!headerPreview,\n                invalid: !!errors?.header,\n              })}\n              title={intl.formatMessage(messages.uploadHeader)}\n            >\n              <input\n                type='file'\n                hidden\n                ref={headerFileRef}\n                accept='image/*'\n                onChange={handleHeaderChange}\n              />\n\n              {headerPreview && <img src={headerPreview} alt='' />}\n\n              <Icon\n                id=''\n                icon={headerPreview ? EditIcon : AddPhotoAlternateIcon}\n              />\n            </label>\n\n            <label\n              className={classNames('app-form__avatar-input', {\n                selected: !!avatarPreview,\n                invalid: !!errors?.avatar,\n              })}\n              title={intl.formatMessage(messages.uploadAvatar)}\n            >\n              <input\n                type='file'\n                hidden\n                ref={avatarFileRef}\n                accept='image/*'\n                onChange={handleAvatarChange}\n              />\n\n              {avatarPreview && <img src={avatarPreview} alt='' />}\n\n              <Icon\n                id=''\n                icon={avatarPreview ? EditIcon : AddPhotoAlternateIcon}\n              />\n            </label>\n          </div>\n\n          <div className='fields-group'>\n            <div\n              className={classNames('input with_block_label', {\n                field_with_errors: !!errors?.display_name,\n              })}\n            >\n              <label htmlFor='display_name'>\n                <FormattedMessage\n                  id='onboarding.profile.display_name'\n                  defaultMessage='Display name'\n                />\n              </label>\n              <span className='hint'>\n                <FormattedMessage\n                  id='onboarding.profile.display_name_hint'\n                  defaultMessage='Your full name or your fun name…'\n                />\n              </span>\n              <div className='label_input'>\n                <input\n                  id='display_name'\n                  type='text'\n                  value={displayName}\n                  onChange={handleDisplayNameChange}\n                  maxLength={30}\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className='fields-group'>\n            <div\n              className={classNames('input with_block_label', {\n                field_with_errors: !!errors?.note,\n              })}\n            >\n              <label htmlFor='note'>\n                <FormattedMessage\n                  id='onboarding.profile.note'\n                  defaultMessage='Bio'\n                />\n              </label>\n              <span className='hint'>\n                <FormattedMessage\n                  id='onboarding.profile.note_hint'\n                  defaultMessage='You can @mention other people or #hashtags…'\n                />\n              </span>\n              <div className='label_input'>\n                <textarea\n                  id='note'\n                  value={note}\n                  onChange={handleNoteChange}\n                  maxLength={500}\n                />\n              </div>\n            </div>\n          </div>\n\n          <label className='app-form__toggle'>\n            <div className='app-form__toggle__label'>\n              <strong>\n                <FormattedMessage\n                  id='onboarding.profile.discoverable'\n                  defaultMessage='Make my profile discoverable'\n                />\n              </strong>{' '}\n              <span className='recommended'>\n                <FormattedMessage\n                  id='recommended'\n                  defaultMessage='Recommended'\n                />\n              </span>\n              <span className='hint'>\n                <FormattedMessage\n                  id='onboarding.profile.discoverable_hint'\n                  defaultMessage='When you opt in to discoverability on Mastodon, your posts may appear in search results and trending, and your profile may be suggested to people with similar interests to you.'\n                />\n              </span>\n            </div>\n\n            <div className='app-form__toggle__toggle'>\n              <div>\n                <Toggle\n                  checked={discoverable}\n                  onChange={handleDiscoverableChange}\n                />\n              </div>\n            </div>\n          </label>\n        </div>\n\n        <div className='spacer' />\n\n        <div className='column-footer'>\n          <Button block onClick={handleSubmit} disabled={isSaving}>\n            {isSaving ? (\n              <LoadingIndicator />\n            ) : (\n              <FormattedMessage\n                id='onboarding.profile.save_and_continue'\n                defaultMessage='Save and continue'\n              />\n            )}\n          </Button>\n        </div>\n      </div>\n\n      <Helmet>\n        <title>{intl.formatMessage(messages.title)}</title>\n        <meta name='robots' content='noindex' />\n      </Helmet>\n    </Column>\n  );\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default Profile;\n"],"names":["SvgAddPhotoAlternate","props","React.createElement","messages","defineMessages","title","id","defaultMessage","uploadHeader","uploadAvatar","nullIfMissing","path","endsWith","Profile","multiColumn","account","useAppSelector","state","me","accounts","get","undefined","displayName","setDisplayName","useState","display_name","note","setNote","unescapeHTML","avatar","setAvatar","header","setHeader","discoverable","setDiscoverable","isSaving","setIsSaving","errors","setErrors","avatarFileRef","createRef","headerFileRef","dispatch","useAppDispatch","intl","useIntl","history","useHistory","handleDisplayNameChange","useCallback","e","target","value","handleNoteChange","handleDiscoverableChange","checked","handleAvatarChange","files","handleHeaderChange","avatarPreview","useMemo","URL","createObjectURL","headerPreview","handleSubmit","updateAccount","indexable","then","push","closeOnboarding","catch","err","response","details","data","jsxs","Column","formatMessage","jsx","ColumnHeader","PersonIcon","classNames","selected","invalid","Icon","EditIcon","AddPhotoAlternateIcon","field_with_errors","FormattedMessage","Toggle","Button","LoadingIndicator","Helmet"],"mappings":"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"}