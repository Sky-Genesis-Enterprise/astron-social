import{j as t}from"./client-wT6vtYO_.js";import{u as w,r as i,d as T}from"./index-BdTwX--g.js";import{c as y}from"./index-DizoKcfL.js";import{bh as P,bi as D,bj as F,bk as O,a as A,d as I,u as E,o as H,bl as V,bm as L,g as $,I as q,S as G,i as K}from"./useSelectableClick-DeaJbL2_.js";import{c as z,b as B}from"./api-B2m7efUy.js";import{R as J,e as W}from"./index-CAH5FfLP.js";import{M as _}from"./message-UFwkQlnu.js";const Y=o=>B(`v1/polls/${o}`),Q=(o,l)=>z(`v1/polls/${o}/votes`,{choices:l}),R=D("poll/importFetched",(o,{dispatch:l,getState:c})=>{const{poll:s}=o;l(F({polls:[O(s,c().polls[s.id])]}))}),U=P("poll/vote",({pollId:o,choices:l})=>Q(o,l),async(o,{dispatch:l,discardLoadData:c})=>(await l(R({poll:o})),c)),X=P("poll/fetch",({pollId:o})=>Y(o),async(o,{dispatch:l})=>{await l(R({poll:o}))}),N=T({closed:{id:"poll.closed",defaultMessage:"Closed"},voted:{id:"poll.voted",defaultMessage:"You voted for this answer"},votes:{id:"poll.votes",defaultMessage:"{votes, plural, one {# vote} other {# votes}}"}}),ie=({pollId:o,disabled:l,status:c})=>{const s=A(e=>e.polls[o]),n=I(),a=w(),r=E(),[d,m]=i.useState(!1),[h,v]=i.useState({}),f=i.useMemo(()=>{if(!s)return!1;const e=s.expires_at;return s.expired||new Date(e).getTime()<Date.now()},[s]),g=i.useMemo(()=>s?f?a.formatMessage(N.closed):t.jsx(J,{timestamp:s.expires_at,futureDate:!0}):null,[f,a,s]),b=i.useMemo(()=>s?s.voters_count?t.jsx(_,{id:"poll.total_people",defaultMessage:"{count, plural, one {# person} other {# people}}",values:{count:s.voters_count}}):t.jsx(_,{id:"poll.total_votes",defaultMessage:"{count, plural, one {# vote} other {# votes}}",values:{count:s.votes_count}}):null,[s]),x=l||Object.values(h).every(e=>!e),k=i.useCallback(()=>{x||(n.signedIn?r(U({pollId:o,choices:Object.keys(h)})):r(H({modalType:"INTERACTION",modalProps:{type:"vote",accountId:c.getIn(["account","id"]),url:c.get("uri")}})))},[x,r,n,o,h,c]),M=i.useCallback(()=>{m(!0)},[]),C=i.useCallback(()=>{l||r(X({pollId:o}))},[l,r,o]),j=i.useCallback(e=>{s&&(s.multiple?v(u=>({...u,[e]:!u[e]})):v({[e]:!0}))},[s]);if(!s)return null;const p=s.voted||d||f;return t.jsxs("div",{className:"poll",children:[t.jsx("ul",{children:s.options.map((e,u)=>t.jsx(Z,{index:u,poll:s,option:e,showResults:p,active:!!h[u],onChange:j},e.title||u))}),t.jsxs("div",{className:"poll__footer",children:[!p&&t.jsx("button",{className:"button button-secondary",disabled:x,onClick:k,children:t.jsx(_,{id:"poll.vote",defaultMessage:"Vote"})}),!p&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"poll__link",onClick:M,children:t.jsx(_,{id:"poll.reveal",defaultMessage:"See results"})})," ","·"," "]}),p&&!l&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"poll__link",onClick:C,children:t.jsx(_,{id:"poll.refresh",defaultMessage:"Refresh"})})," ","·"," "]}),b,s.expires_at&&t.jsxs(t.Fragment,{children:[" · ",g]})]})]})},Z=o=>{var j,p;const{active:l,lang:c,disabled:s,poll:n,option:a,index:r,showResults:d,onChange:m}=o,h=a.voted||((j=n.own_votes)==null?void 0:j.includes(r)),v=((p=a.translation)==null?void 0:p.title)??a.title,f=w(),g=i.useMemo(()=>{const e=n.voters_count??n.votes_count;return e===0?0:a.votes_count/e*100},[a,n]),b=i.useMemo(()=>n.options.filter(e=>e.title!==a.title).every(e=>a.votes_count>=e.votes_count),[n,a]),x=i.useMemo(()=>{var u;let e=((u=a.translation)==null?void 0:u.titleHtml)??a.titleHtml;if(!e){const S=V(n.emojis);e=W(L(v),S)}return e},[a,n,v]),k=i.useCallback(()=>{m(r)},[r,m]),M=i.useCallback(e=>{(e.key==="Enter"||e.key===" ")&&(m(r),e.stopPropagation(),e.preventDefault())},[r,m]),C=$({from:{width:"0%"},to:{width:`${g}%`}});return t.jsxs("li",{children:[t.jsxs("label",{className:y("poll__option",{selectable:!d}),children:[t.jsx("input",{name:"vote-options",type:n.multiple?"checkbox":"radio",value:r,checked:l,onChange:k,disabled:s}),!d&&t.jsx("span",{className:y("poll__input",{checkbox:n.multiple,active:l}),tabIndex:0,role:n.multiple?"checkbox":"radio",onKeyDown:M,"aria-checked":l,"aria-label":v,lang:c,"data-index":r}),d&&t.jsxs("span",{className:"poll__number",title:f.formatMessage(N.votes,{votes:a.votes_count}),children:[Math.round(g),"%"]}),t.jsx("span",{className:"poll__option__text translate",lang:c,dangerouslySetInnerHTML:{__html:x}}),!!h&&t.jsx("span",{className:"poll__voted",children:t.jsx(q,{id:"check",icon:G,className:"poll__voted__mark",title:f.formatMessage(N.voted)})})]}),d&&t.jsx(K.span,{className:y("poll__chart",{leading:b}),style:C})]})};export{ie as P};
//# sourceMappingURL=poll-CjurB963.js.map
