{"version":3,"file":"policy_controls-dBLdekz7.js","sources":["../../app/javascript/material-icons/400-24px/arrow_drop_down.svg?react","../../app/javascript/mastodon/features/notifications/components/select_with_label.tsx","../../app/javascript/mastodon/features/notifications/components/policy_controls.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgArrowDropDown = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", height: 24, viewBox: \"0 -960 960 960\", width: 24, ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M480-360 280-560h400L480-360Z\" }));\nexport default SvgArrowDropDown;\n","import type { PropsWithChildren } from 'react';\nimport { useCallback, useState, useRef } from 'react';\n\nimport classNames from 'classnames';\n\nimport type { Placement, State as PopperState } from '@popperjs/core';\nimport Overlay from 'react-overlays/Overlay';\n\nimport ArrowDropDownIcon from '@/material-icons/400-24px/arrow_drop_down.svg?react';\nimport type { SelectItem } from 'mastodon/components/dropdown_selector';\nimport { DropdownSelector } from 'mastodon/components/dropdown_selector';\nimport { Icon } from 'mastodon/components/icon';\n\ninterface DropdownProps {\n  value: string;\n  options: SelectItem[];\n  disabled?: boolean;\n  onChange: (value: string) => void;\n  placement?: Placement;\n}\n\nconst Dropdown: React.FC<DropdownProps> = ({\n  value,\n  options,\n  disabled,\n  onChange,\n  placement: initialPlacement = 'bottom-end',\n}) => {\n  const activeElementRef = useRef<Element | null>(null);\n  const containerRef = useRef(null);\n  const [isOpen, setOpen] = useState<boolean>(false);\n  const [placement, setPlacement] = useState<Placement>(initialPlacement);\n\n  const handleToggle = useCallback(() => {\n    if (\n      isOpen &&\n      activeElementRef.current &&\n      activeElementRef.current instanceof HTMLElement\n    ) {\n      activeElementRef.current.focus({ preventScroll: true });\n    }\n\n    setOpen(!isOpen);\n  }, [isOpen, setOpen]);\n\n  const handleMouseDown = useCallback(() => {\n    if (!isOpen) activeElementRef.current = document.activeElement;\n  }, [isOpen]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      switch (e.key) {\n        case ' ':\n        case 'Enter':\n          if (!isOpen) activeElementRef.current = document.activeElement;\n          break;\n      }\n    },\n    [isOpen],\n  );\n\n  const handleClose = useCallback(() => {\n    if (\n      isOpen &&\n      activeElementRef.current &&\n      activeElementRef.current instanceof HTMLElement\n    )\n      activeElementRef.current.focus({ preventScroll: true });\n    setOpen(false);\n  }, [isOpen]);\n\n  const handleOverlayEnter = useCallback(\n    (state: Partial<PopperState>) => {\n      if (state.placement) setPlacement(state.placement);\n    },\n    [setPlacement],\n  );\n\n  const valueOption = options.find((item) => item.value === value);\n\n  return (\n    <div ref={containerRef}>\n      <button\n        type='button'\n        onClick={handleToggle}\n        onMouseDown={handleMouseDown}\n        onKeyDown={handleKeyDown}\n        disabled={disabled}\n        className={classNames('dropdown-button', { active: isOpen })}\n      >\n        <span className='dropdown-button__label'>{valueOption?.text}</span>\n        <Icon id='down' icon={ArrowDropDownIcon} />\n      </button>\n\n      <Overlay\n        show={isOpen}\n        offset={[5, 5]}\n        placement={placement}\n        flip\n        target={containerRef}\n        popperConfig={{ strategy: 'fixed', onFirstUpdate: handleOverlayEnter }}\n      >\n        {({ props, placement }) => (\n          <div {...props}>\n            <div\n              className={`dropdown-animation privacy-dropdown__dropdown ${placement}`}\n            >\n              <DropdownSelector\n                items={options}\n                value={value}\n                onClose={handleClose}\n                onChange={onChange}\n                classNamePrefix='privacy-dropdown'\n              />\n            </div>\n          </div>\n        )}\n      </Overlay>\n    </div>\n  );\n};\n\ninterface Props {\n  value: string;\n  options: SelectItem[];\n  disabled?: boolean;\n  onChange: (value: string) => void;\n}\n\nexport const SelectWithLabel: React.FC<PropsWithChildren<Props>> = ({\n  value,\n  options,\n  disabled,\n  children,\n  onChange,\n}) => {\n  return (\n    <label className='app-form__toggle'>\n      <div className='app-form__toggle__label'>{children}</div>\n\n      <div className='app-form__toggle__toggle'>\n        <div>\n          <Dropdown\n            value={value}\n            onChange={onChange}\n            disabled={disabled}\n            options={options}\n          />\n        </div>\n      </div>\n    </label>\n  );\n};\n","import { useCallback } from 'react';\n\nimport { useIntl, defineMessages, FormattedMessage } from 'react-intl';\n\nimport { openModal } from 'mastodon/actions/modal';\nimport { updateNotificationsPolicy } from 'mastodon/actions/notification_policies';\nimport type { AppDispatch } from 'mastodon/store';\nimport { useAppSelector, useAppDispatch } from 'mastodon/store';\n\nimport { SelectWithLabel } from './select_with_label';\n\nconst messages = defineMessages({\n  accept: { id: 'notifications.policy.accept', defaultMessage: 'Accept' },\n  accept_hint: {\n    id: 'notifications.policy.accept_hint',\n    defaultMessage: 'Show in notifications',\n  },\n  filter: { id: 'notifications.policy.filter', defaultMessage: 'Filter' },\n  filter_hint: {\n    id: 'notifications.policy.filter_hint',\n    defaultMessage: 'Send to filtered notifications inbox',\n  },\n  drop: { id: 'notifications.policy.drop', defaultMessage: 'Ignore' },\n  drop_hint: {\n    id: 'notifications.policy.drop_hint',\n    defaultMessage: 'Send to the void, never to be seen again',\n  },\n});\n\n// TODO: change the following when we change the API\nconst changeFilter = (\n  dispatch: AppDispatch,\n  filterType: string,\n  value: string,\n) => {\n  if (value === 'drop') {\n    dispatch(\n      openModal({\n        modalType: 'IGNORE_NOTIFICATIONS',\n        modalProps: { filterType },\n      }),\n    );\n  } else {\n    void dispatch(updateNotificationsPolicy({ [filterType]: value }));\n  }\n};\n\nexport const PolicyControls: React.FC = () => {\n  const intl = useIntl();\n  const dispatch = useAppDispatch();\n\n  const notificationPolicy = useAppSelector(\n    (state) => state.notificationPolicy,\n  );\n\n  const handleFilterNotFollowing = useCallback(\n    (value: string) => {\n      changeFilter(dispatch, 'for_not_following', value);\n    },\n    [dispatch],\n  );\n\n  const handleFilterNotFollowers = useCallback(\n    (value: string) => {\n      changeFilter(dispatch, 'for_not_followers', value);\n    },\n    [dispatch],\n  );\n\n  const handleFilterNewAccounts = useCallback(\n    (value: string) => {\n      changeFilter(dispatch, 'for_new_accounts', value);\n    },\n    [dispatch],\n  );\n\n  const handleFilterPrivateMentions = useCallback(\n    (value: string) => {\n      changeFilter(dispatch, 'for_private_mentions', value);\n    },\n    [dispatch],\n  );\n\n  const handleFilterLimitedAccounts = useCallback(\n    (value: string) => {\n      changeFilter(dispatch, 'for_limited_accounts', value);\n    },\n    [dispatch],\n  );\n\n  if (!notificationPolicy) return null;\n\n  const options = [\n    {\n      value: 'accept',\n      text: intl.formatMessage(messages.accept),\n      meta: intl.formatMessage(messages.accept_hint),\n    },\n    {\n      value: 'filter',\n      text: intl.formatMessage(messages.filter),\n      meta: intl.formatMessage(messages.filter_hint),\n    },\n    {\n      value: 'drop',\n      text: intl.formatMessage(messages.drop),\n      meta: intl.formatMessage(messages.drop_hint),\n    },\n  ];\n\n  return (\n    <section>\n      <h3>\n        <FormattedMessage\n          id='notifications.policy.title'\n          defaultMessage='Manage notifications fromâ€¦'\n        />\n      </h3>\n\n      <div className='column-settings__row'>\n        <SelectWithLabel\n          value={notificationPolicy.for_not_following}\n          onChange={handleFilterNotFollowing}\n          options={options}\n        >\n          <strong>\n            <FormattedMessage\n              id='notifications.policy.filter_not_following_title'\n              defaultMessage=\"People you don't follow\"\n            />\n          </strong>\n          <span className='hint'>\n            <FormattedMessage\n              id='notifications.policy.filter_not_following_hint'\n              defaultMessage='Until you manually approve them'\n            />\n          </span>\n        </SelectWithLabel>\n\n        <SelectWithLabel\n          value={notificationPolicy.for_not_followers}\n          onChange={handleFilterNotFollowers}\n          options={options}\n        >\n          <strong>\n            <FormattedMessage\n              id='notifications.policy.filter_not_followers_title'\n              defaultMessage='People not following you'\n            />\n          </strong>\n          <span className='hint'>\n            <FormattedMessage\n              id='notifications.policy.filter_not_followers_hint'\n              defaultMessage='Including people who have been following you fewer than {days, plural, one {one day} other {# days}}'\n              values={{ days: 3 }}\n            />\n          </span>\n        </SelectWithLabel>\n\n        <SelectWithLabel\n          value={notificationPolicy.for_new_accounts}\n          onChange={handleFilterNewAccounts}\n          options={options}\n        >\n          <strong>\n            <FormattedMessage\n              id='notifications.policy.filter_new_accounts_title'\n              defaultMessage='New accounts'\n            />\n          </strong>\n          <span className='hint'>\n            <FormattedMessage\n              id='notifications.policy.filter_new_accounts.hint'\n              defaultMessage='Created within the past {days, plural, one {one day} other {# days}}'\n              values={{ days: 30 }}\n            />\n          </span>\n        </SelectWithLabel>\n\n        <SelectWithLabel\n          value={notificationPolicy.for_private_mentions}\n          onChange={handleFilterPrivateMentions}\n          options={options}\n        >\n          <strong>\n            <FormattedMessage\n              id='notifications.policy.filter_private_mentions_title'\n              defaultMessage='Unsolicited private mentions'\n            />\n          </strong>\n          <span className='hint'>\n            <FormattedMessage\n              id='notifications.policy.filter_private_mentions_hint'\n              defaultMessage=\"Filtered unless it's in reply to your own mention or if you follow the sender\"\n            />\n          </span>\n        </SelectWithLabel>\n\n        <SelectWithLabel\n          value={notificationPolicy.for_limited_accounts}\n          onChange={handleFilterLimitedAccounts}\n          options={options}\n        >\n          <strong>\n            <FormattedMessage\n              id='notifications.policy.filter_limited_accounts_title'\n              defaultMessage='Moderated accounts'\n            />\n          </strong>\n          <span className='hint'>\n            <FormattedMessage\n              id='notifications.policy.filter_limited_accounts_hint'\n              defaultMessage='Limited by server moderators'\n            />\n          </span>\n        </SelectWithLabel>\n      </div>\n    </section>\n  );\n};\n"],"names":["SvgArrowDropDown","props","React.createElement","Dropdown","value","options","disabled","onChange","placement","initialPlacement","activeElementRef","useRef","containerRef","isOpen","setOpen","useState","setPlacement","handleToggle","useCallback","current","HTMLElement","focus","preventScroll","handleMouseDown","document","activeElement","handleKeyDown","e","key","handleClose","handleOverlayEnter","state","valueOption","find","item","jsxs","classNames","active","jsx","text","Icon","ArrowDropDownIcon","Overlay","strategy","onFirstUpdate","DropdownSelector","SelectWithLabel","children","messages","defineMessages","accept","id","defaultMessage","accept_hint","filter","filter_hint","drop","drop_hint","changeFilter","dispatch","filterType","openModal","modalType","modalProps","updateNotificationsPolicy","PolicyControls","intl","useIntl","useAppDispatch","notificationPolicy","useAppSelector","handleFilterNotFollowing","handleFilterNotFollowers","handleFilterNewAccounts","handleFilterPrivateMentions","handleFilterLimitedAccounts","formatMessage","meta","FormattedMessage","for_not_following","for_not_followers","days","for_new_accounts","for_private_mentions","for_limited_accounts"],"mappings":"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"}