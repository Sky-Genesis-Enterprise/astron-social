var ye=Object.defineProperty;var Ne=(t,s,a)=>s in t?ye(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var N=(t,s,a)=>Ne(t,typeof s!="symbol"?s+"":s,a);import{j as e,_ as z}from"./client-wT6vtYO_.js";import{u as h,r as l,d as x}from"./index-BdTwX--g.js";import{c as k}from"./index-DizoKcfL.js";import{a as v,u as y,a4 as we,j as D,a5 as Te,a6 as ke,I as K,O as Ie,a7 as Ee,a8 as Ae,a9 as Re,g as Se,aa as X,i as Q,V as re,c as de,ab as J,ac as Le,ad as Pe,ae as Fe,af as Oe,ag as De,ah as Be,ai as Ue,o as ce,aj as $e,b as He,y as qe,z as ee,ak as te}from"./useSelectableClick-DeaJbL2_.js";import{H as Ve}from"./Helmet-ZVWnGmbg.js";import{G as Ge,g as me,F as ue,Z as Ye,a as We,M as Ke,b as Ze}from"./media_modal-WOAjqFh6.js";import{i as ze}from"./react-textarea-autosize.browser.esm-GiEI5riT.js";import{d as Xe,a as Qe,P as Je}from"./compose_form_container-CfVtoFBv.js";import{B as I}from"./index-BZWHsOPk.js";import{L as ge}from"./loading_indicator-7xMB1U6D.js";import{S as $}from"./skeleton-D9NbTYr9.js";import{W as et,X as tt,Y as st,Z as at,_ as ot,$ as nt,a0 as it,a1 as lt,a2 as rt,a3 as dt,a4 as ct,a5 as mt,a6 as ut,a7 as gt,a8 as ft,a9 as pt,aa as ht}from"./content_warning-DZ8mar1O.js";import{e as se}from"./initial_state-BP3UcUr4.js";import{b as _t}from"./index-CAH5FfLP.js";import{M as p}from"./message-UFwkQlnu.js";import{L as xt,d as Mt,P as T}from"./short_number-WomMu2iV.js";import{E as Ct}from"./embedded_status-CRZOb2jI.js";import{a as vt}from"./api-B2m7efUy.js";import{S as bt}from"./close-BsPe8EbX.js";import{G as jt}from"./gif-BtN1axMk.js";const H=(t,s,a)=>typeof s=="object"?t.formatMessage(s,a):s,yt=({alert:{key:t,title:s,message:a,values:o,action:n,onClick:i},dismissAfter:r})=>{const d=y(),c=h(),[m,g]=l.useState(!1);return l.useEffect(()=>{const u=setTimeout(()=>{g(!0)},1);return()=>{clearTimeout(u)}},[]),l.useEffect(()=>{const u=setTimeout(()=>{g(!1),setTimeout(()=>{d(we({key:t}))},500)},r);return()=>{clearTimeout(u)}},[d,g,t,r]),e.jsx("div",{className:k("notification-bar",{"notification-bar-active":m}),children:e.jsxs("div",{className:"notification-bar-wrapper",children:[s&&e.jsx("span",{className:"notification-bar-title",children:H(c,s,o)}),e.jsx("span",{className:"notification-bar-message",children:H(c,a,o)}),n&&e.jsx("button",{className:"notification-bar-action",onClick:i,children:H(c,n,o)})]})})},ks=()=>{const t=v(s=>s.alerts);return t.length===0?null:e.jsx("div",{className:"notification-list",children:t.map((s,a)=>e.jsx(yt,{alert:s,dismissAfter:5e3+a*1e3},s.key))})},Nt="BUNDLE_FETCH_REQUEST",wt="BUNDLE_FETCH_SUCCESS",Tt="BUNDLE_FETCH_FAIL";function kt(t){return{type:Nt,skipLoading:t}}function It(t){return{type:wt,skipLoading:t}}function Et(t,s){return{type:Tt,error:t,skipLoading:s}}const At=t=>({onFetch(){t(kt())},onFetchSuccess(){t(It())},onFetchFail(s){t(Et(s))}}),Rt=D(null,At)(et),St=(t,s)=>({loading:t.get("loadingBar")[s.scope||"default"]}),Is=D(St)(Te.WrappedComponent),Lt=t=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...t},l.createElement("path",{d:"M424-320q0-81 14.5-116.5T500-514q41-36 62.5-62.5T584-637q0-41-27.5-68T480-732q-51 0-77.5 31T365-638l-103-44q21-64 77-111t141-47q105 0 161.5 58.5T698-641q0 50-21.5 85.5T609-475q-49 47-59.5 71.5T539-320H424Zm56 240q-33 0-56.5-23.5T400-160q0-33 23.5-56.5T480-240q33 0 56.5 23.5T560-160q0 33-23.5 56.5T480-80Z"})),Pt=x({help:{id:"info_button.label",defaultMessage:"Help"}}),Ft=()=>{const t=h(),[s,a]=l.useState(!1),o=l.useRef(null),n=l.useId(),i=l.useCallback(()=>{a(!s)},[s,a]),[r,d]=ke(i);return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:k("help-button",{active:s}),ref:o,onClick:i,"aria-expanded":s,"aria-controls":n,"aria-label":t.formatMessage(Pt.help),children:e.jsx(K,{id:"",icon:Lt})}),e.jsx(Ie,{show:s,rootClose:!0,placement:"top",onHide:i,offset:[5,5],target:o,children:({props:c})=>e.jsx("div",{...c,className:"dialog-modal__popout prose dropdown-animation",role:"region",id:n,onMouseDown:r,onMouseUp:d,children:e.jsx(p,{id:"info_button.what_is_alt_text",defaultMessage:`<h1>What is alt text?</h1>

            <p>Alt text provides image descriptions for people with vision impairments, low-bandwidth connections, or those seeking extra context.</p>

            <p>You can improve accessibility and understanding for everyone by writing clear, concise, and objective alt text.</p>

            <ul>
              <li>Capture important elements</li>
              <li>Summarize text in images</li>
              <li>Use regular sentence structure</li>
              <li>Avoid redundant information</li>
              <li>Focus on trends and key findings in complex visuals (like diagrams or maps)</li>
            </ul>`,values:{h1:m=>e.jsx("h1",{children:m}),p:m=>e.jsx("p",{children:m}),ul:m=>e.jsx("ul",{children:m}),li:m=>e.jsx("li",{children:m})}})})})]})},F=x({placeholderVisual:{id:"alt_text_modal.describe_for_people_with_visual_impairments",defaultMessage:"Describe this for people with visual impairments…"},placeholderHearing:{id:"alt_text_modal.describe_for_people_with_hearing_impairments",defaultMessage:"Describe this for people with hearing impairments…"},discardMessage:{id:"confirmations.discard_edit_media.message",defaultMessage:"You have unsaved changes to the media description or preview, discard them anyway?"},discardConfirm:{id:"confirmations.discard_edit_media.confirm",defaultMessage:"Discard"}}),ae=1500,Ot=({children:t,onSelectFile:s,mimeTypes:a})=>{const o=l.useRef(null),n=l.useCallback(()=>{var r;(r=o.current)==null||r.click()},[]),i=l.useCallback(r=>{var c;const d=(c=r.target.files)==null?void 0:c[0];d&&s(d)},[s]);return e.jsxs("label",{children:[e.jsx(I,{onClick:n,children:t}),e.jsx("input",{id:"upload-modal__thumbnail",ref:o,type:"file",accept:a,onChange:i,style:{display:"none"}})]})},Dt=({mediaId:t,position:s,onPositionChange:a})=>{const o=l.useRef(!1),n=l.useRef(null),[i,r]=s,d=Se({to:{left:`${i*100}%`,top:`${r*100}%`},immediate:o.current}),c=v(M=>M.compose.get("media_attachments").find(C=>C.get("id")===t)),m=v(M=>se?M.accounts.get(se):void 0),[g,u]=l.useState(!1),j=l.useCallback(M=>{n.current=M},[]),_=l.useCallback(M=>{if(M.button!==0)return;const C=A=>{const{x:R,y:L}=X(n.current,A);o.current=!0,a([R,L])},w=()=>{u(!1),o.current=!1,document.removeEventListener("mouseup",w),document.removeEventListener("mousemove",C)},{x:B,y:E}=X(n.current,M.nativeEvent);u(!0),a([B,E]),document.addEventListener("mouseup",w),document.addEventListener("mousemove",C)},[u,a]);return c?c.get("type")==="image"?e.jsxs("div",{className:k("focal-point",{dragging:g}),children:[e.jsx("img",{ref:j,draggable:!1,src:c.get("url"),alt:"",role:"presentation",onMouseDown:_}),e.jsx(Q.div,{className:"focal-point__reticle",style:d})]}):c.get("type")==="gifv"?e.jsxs("div",{className:k("focal-point",{dragging:g}),children:[e.jsx(Ge,{ref:j,src:c.get("url"),alt:"",onMouseDown:_}),e.jsx(Q.div,{className:"focal-point__reticle",style:d})]}):c.get("type")==="video"?e.jsx(re,{preview:c.get("preview_url"),frameRate:c.getIn(["meta","original","frame_rate"]),aspectRatio:`${c.getIn(["meta","original","width"])} / ${c.getIn(["meta","original","height"])}`,blurhash:c.get("blurhash"),src:c.get("url"),detailed:!0,editable:!0}):c.get("type")==="audio"?e.jsx(de,{src:c.get("url"),poster:c.get("preview_url")??(m==null?void 0:m.avatar_static),duration:c.getIn(["meta","original","duration"],0),backgroundColor:c.getIn(["meta","colors","background"]),foregroundColor:c.getIn(["meta","colors","foreground"]),accentColor:c.getIn(["meta","colors","accent"]),editable:!0}):null:null},fe=l.forwardRef(({mediaId:t,previousDescription:s,previousPosition:a,onClose:o},n)=>{const i=h(),r=y(),d=v(f=>f.compose.get("media_attachments").find(U=>U.get("id")===t)),c=v(f=>f.compose.get("lang")),m=(d==null?void 0:d.getIn(["meta","focus","x"],0))??0,g=(d==null?void 0:d.getIn(["meta","focus","y"],0))??0,[u,j]=l.useState(s??(d==null?void 0:d.get("description"))??""),[_,M]=l.useState(a??[m/2+.5,g/-2+.5]),[C,w]=l.useState(!1),[B,E]=l.useState(!1),A=l.useRef(!!(s||a)),R=d==null?void 0:d.get("type"),L=Xe.length(u)<=ae,he=l.useCallback(f=>{j(f.target.value),A.current=!0},[j]),_e=l.useCallback(f=>{r(Ee(t,f))},[r,t]),xe=l.useCallback(f=>{M(f),A.current=!0},[M]),P=l.useCallback(()=>{E(!0),r(Ae({id:t,description:u,focus:`${((_[0]-.5)*2).toFixed(2)},${((_[1]-.5)*-2).toFixed(2)}`})).then(()=>(E(!1),A.current=!1,o(),"")).catch(f=>{E(!1),r(Re(f))})},[r,E,t,o,_,u]),Me=l.useCallback(f=>{(f.ctrlKey||f.metaKey)&&f.key==="Enter"&&(f.preventDefault(),L&&P())},[P,L]),Ce=l.useCallback(()=>{w(!0),tt().then(async({createWorker:f})=>{const[U,ve]=await Promise.all([z(()=>import("./worker.min-CsIQe9T3.js"),[]),z(()=>import("./tesseract-core.wasm-B2697XUV.js"),[])]),Z=await f("eng",1,{workerPath:U.default,corePath:ve.default,langPath:`${_t}/ocr/lang-data`,cacheMethod:"write"}),be=URL.createObjectURL(d==null?void 0:d.get("file")),je=await Z.recognize(be);return j(je.data.text),w(!1),await Z.terminate(),""}).catch(()=>{w(!1)})},[j,w,d]);return l.useImperativeHandle(n,()=>({getCloseConfirmationMessage:()=>A.current?{message:i.formatMessage(F.discardMessage),confirm:i.formatMessage(F.discardConfirm),props:{previousDescription:u,previousPosition:_}}:null}),[i,u,_]),e.jsxs("div",{className:"modal-root__modal dialog-modal",children:[e.jsxs("div",{className:"dialog-modal__header",children:[e.jsx(I,{onClick:P,disabled:!L,children:B?e.jsx(ge,{}):e.jsx(p,{id:"alt_text_modal.done",defaultMessage:"Done"})}),e.jsx("span",{className:"dialog-modal__header__title",children:e.jsx(p,{id:"alt_text_modal.add_alt_text",defaultMessage:"Add alt text"})}),e.jsx(I,{secondary:!0,onClick:o,children:e.jsx(p,{id:"alt_text_modal.cancel",defaultMessage:"Cancel"})})]}),e.jsxs("div",{className:"dialog-modal__content",children:[e.jsxs("div",{className:"dialog-modal__content__preview",children:[e.jsx(Dt,{mediaId:t,position:_,onPositionChange:xe}),(R==="audio"||R==="video")&&e.jsx(Ot,{onSelectFile:_e,mimeTypes:"image/jpeg,image/png,image/gif,image/heic,image/heif,image/webp,image/avif",children:e.jsx(p,{id:"alt_text_modal.change_thumbnail",defaultMessage:"Change thumbnail"})})]}),e.jsx("form",{className:"dialog-modal__content__form simple_form",onSubmit:P,children:e.jsxs("div",{className:"input",children:[e.jsxs("div",{className:"label_input",children:[e.jsx(ze,{id:"description",value:C?" ":u,onChange:he,onKeyUp:Me,lang:c,placeholder:i.formatMessage(R==="audio"?F.placeholderHearing:F.placeholderVisual),minRows:3,disabled:C}),C&&e.jsxs("div",{className:"label_input__loading-indicator",children:[e.jsx($,{width:"100%"}),e.jsx($,{width:"100%"}),e.jsx($,{width:"61%"})]})]}),e.jsxs("div",{className:"input__toolbar",children:[e.jsx(Qe,{max:ae,text:C?"":u}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"link-button",onClick:Ce,disabled:R!=="image"||C,children:e.jsx(p,{id:"alt_text_modal.add_text_from_image",defaultMessage:"Add text from image"})}),e.jsx(Ft,{})]})]})})]})]})});fe.displayName="AltTextModal";const Bt=({actions:t,onClick:s})=>e.jsx("div",{className:"modal-root__modal actions-modal",children:e.jsx("ul",{children:t.map((a,o)=>{if(a===null)return e.jsx("li",{className:"dropdown-menu__separator"},`sep-${o}`);const{text:n,dangerous:i}=a;let r;return st(a)?r=e.jsx("button",{onClick:s,"data-index":o,children:n}):at(a)?r=e.jsx("a",{href:a.href,target:a.target??"_target","data-method":a.method,rel:"noopener",onClick:s,"data-index":o,children:n}):r=e.jsx(xt,{to:a.to,onClick:s,"data-index":o,children:n}),e.jsx("li",{className:k({"dropdown-menu__item--dangerous":i}),children:r},`${n}-${o}`)})})}),Ut=({media:t,statusId:s,options:a,onClose:o,onChangeBackgroundColor:n})=>{const i=v(g=>g.statuses.get(s)),r=i==null?void 0:i.get("account"),d=v(g=>{var u;return r?(u=g.accounts.get(r))==null?void 0:u.avatar_static:void 0});l.useEffect(()=>{const g=me(t.get("blurhash"));return n(g??{r:255,g:255,b:255}),()=>{n(null)}},[t,n]);const c=(i==null?void 0:i.getIn(["translation","language"]))??(i==null?void 0:i.get("language")),m=t.getIn(["translation","description"])??t.get("description");return e.jsxs("div",{className:"modal-root__modal audio-modal",children:[e.jsx("div",{className:"audio-modal__container",children:e.jsx(de,{src:t.get("url"),alt:m,lang:c,poster:t.get("preview_url")??d,duration:t.getIn(["meta","original","duration"],0),backgroundColor:t.getIn(["meta","colors","background"]),foregroundColor:t.getIn(["meta","colors","foreground"]),accentColor:t.getIn(["meta","colors","accent"]),startPlaying:a.autoPlay})}),e.jsx("div",{className:"media-modal__overlay",children:i&&e.jsx(ue,{statusId:i.get("id"),withOpenButton:!0,onClose:o})})]})},oe=x({cancel_reblog:{id:"status.cancel_reblog_private",defaultMessage:"Unboost"},reblog:{id:"status.reblog",defaultMessage:"Boost"}}),$t=({status:t,onReblog:s,onClose:a})=>{const o=h(),n=v(_=>_.compose.get("default_privacy")),i=t.get("id"),r=t.get("visibility"),[d,c]=l.useState(r==="private"?"private":n),m=l.useCallback(_=>{c(_)},[]),g=l.useCallback(()=>{s(t,d),a()},[a,s,t,d]),u=l.useCallback(()=>{a()},[a]),j=l.useCallback(()=>document.getElementsByClassName("modal-root__container")[0],[]);return e.jsxs("div",{className:"modal-root__modal safety-action-modal",children:[e.jsxs("div",{className:"safety-action-modal__top",children:[e.jsxs("div",{className:"safety-action-modal__header",children:[e.jsx("div",{className:"safety-action-modal__header__icon",children:e.jsx(K,{icon:J,id:"retweet"})}),e.jsxs("div",{children:[e.jsx("h1",{children:t.get("reblogged")?e.jsx(p,{id:"boost_modal.undo_reblog",defaultMessage:"Unboost post?"}):e.jsx(p,{id:"boost_modal.reblog",defaultMessage:"Boost post?"})}),e.jsx("div",{children:e.jsx(p,{id:"boost_modal.combo",defaultMessage:"You can press {combo} to skip this next time",values:{combo:e.jsxs("span",{className:"hotkey-combination",children:[e.jsx("kbd",{children:"Shift"}),"+",e.jsx(K,{id:"retweet",icon:J})]})}})})]})]}),e.jsx("div",{className:"safety-action-modal__status",children:e.jsx(Ct,{statusId:i})})]}),e.jsx("div",{className:k("safety-action-modal__bottom"),children:e.jsxs("div",{className:"safety-action-modal__actions",children:[!t.get("reblogged")&&e.jsx(Je,{noDirect:!0,value:d,container:j,onChange:m,disabled:r==="private"}),e.jsx("div",{className:"spacer"}),e.jsx("button",{onClick:u,className:"link-button",children:e.jsx(p,{id:"confirmation_modal.cancel",defaultMessage:"Cancel"})}),e.jsx(I,{onClick:g,text:o.formatMessage(t.get("reblogged")?oe.cancel_reblog:oe.reblog),autoFocus:!0})]})})]})},b=({title:t,message:s,confirm:a,onClose:o,onConfirm:n,secondary:i,onSecondary:r,closeWhenConfirm:d=!0})=>{const c=l.useCallback(()=>{d&&o(),n()},[o,n,d]),m=l.useCallback(()=>{o(),r==null||r()},[o,r]),g=l.useCallback(()=>{o()},[o]);return e.jsxs("div",{className:"modal-root__modal safety-action-modal",children:[e.jsx("div",{className:"safety-action-modal__top",children:e.jsxs("div",{className:"safety-action-modal__confirmation",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:s})]})}),e.jsx("div",{className:"safety-action-modal__bottom",children:e.jsxs("div",{className:"safety-action-modal__actions",children:[e.jsx("button",{onClick:g,className:"link-button",children:e.jsx(p,{id:"confirmation_modal.cancel",defaultMessage:"Cancel"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spacer"}),e.jsx("button",{onClick:m,className:"link-button",children:i})]}),e.jsx(I,{onClick:c,autoFocus:!0,children:a})]})})]})},S=x({deleteAndRedraftTitle:{id:"confirmations.redraft.title",defaultMessage:"Delete & redraft post?"},deleteAndRedraftMessage:{id:"confirmations.redraft.message",defaultMessage:"Are you sure you want to delete this status and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned."},deleteAndRedraftConfirm:{id:"confirmations.redraft.confirm",defaultMessage:"Delete & redraft"},deleteTitle:{id:"confirmations.delete.title",defaultMessage:"Delete post?"},deleteMessage:{id:"confirmations.delete.message",defaultMessage:"Are you sure you want to delete this status?"},deleteConfirm:{id:"confirmations.delete.confirm",defaultMessage:"Delete"}}),Ht=({statusId:t,withRedraft:s,onClose:a})=>{const o=h(),n=y(),i=l.useCallback(()=>{n(Le(t,s))},[n,t,s]);return e.jsx(b,{title:o.formatMessage(s?S.deleteAndRedraftTitle:S.deleteTitle),message:o.formatMessage(s?S.deleteAndRedraftMessage:S.deleteMessage),confirm:o.formatMessage(s?S.deleteAndRedraftConfirm:S.deleteConfirm),onConfirm:i,onClose:a})},q=x({deleteListTitle:{id:"confirmations.delete_list.title",defaultMessage:"Delete list?"},deleteListMessage:{id:"confirmations.delete_list.message",defaultMessage:"Are you sure you want to permanently delete this list?"},deleteListConfirm:{id:"confirmations.delete_list.confirm",defaultMessage:"Delete"}}),qt=({listId:t,columnId:s,onClose:a})=>{const o=h(),n=y(),i=Mt(),r=l.useCallback(()=>{n(Pe(t)),s?n(Fe(s)):i.push("/lists")},[n,i,s,t]);return e.jsx(b,{title:o.formatMessage(q.deleteListTitle),message:o.formatMessage(q.deleteListMessage),confirm:o.formatMessage(q.deleteListConfirm),onConfirm:r,onClose:a})},V=x({replyTitle:{id:"confirmations.reply.title",defaultMessage:"Overwrite post?"},replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"}}),Vt=({status:t,onClose:s})=>{const a=h(),o=y(),n=l.useCallback(()=>{o(Oe(t))},[o,t]);return e.jsx(b,{title:a.formatMessage(V.replyTitle),message:a.formatMessage(V.replyMessage),confirm:a.formatMessage(V.replyConfirm),onConfirm:n,onClose:s})},G=x({editTitle:{id:"confirmations.edit.title",defaultMessage:"Overwrite post?"},editConfirm:{id:"confirmations.edit.confirm",defaultMessage:"Edit"},editMessage:{id:"confirmations.edit.message",defaultMessage:"Editing now will overwrite the message you are currently composing. Are you sure you want to proceed?"}}),Gt=({statusId:t,onClose:s})=>{const a=h(),o=y(),n=l.useCallback(()=>{o(De(t))},[o,t]);return e.jsx(b,{title:a.formatMessage(G.editTitle),message:a.formatMessage(G.editMessage),confirm:a.formatMessage(G.editConfirm),onConfirm:n,onClose:s})},ne=x({unfollowTitle:{id:"confirmations.unfollow.title",defaultMessage:"Unfollow user?"},unfollowConfirm:{id:"confirmations.unfollow.confirm",defaultMessage:"Unfollow"}}),Yt=({account:t,onClose:s})=>{const a=h(),o=y(),n=l.useCallback(()=>{o(Be(t.id))},[o,t.id]);return e.jsx(b,{title:a.formatMessage(ne.unfollowTitle),message:e.jsx(p,{id:"confirmations.unfollow.message",defaultMessage:"Are you sure you want to unfollow {name}?",values:{name:e.jsxs("strong",{children:["@",t.acct]})}}),confirm:a.formatMessage(ne.unfollowConfirm),onConfirm:n,onClose:s})},Y=x({clearTitle:{id:"notifications.clear_title",defaultMessage:"Clear notifications?"},clearMessage:{id:"notifications.clear_confirmation",defaultMessage:"Are you sure you want to permanently clear all your notifications?"},clearConfirm:{id:"notifications.clear",defaultMessage:"Clear notifications"}}),Wt=({onClose:t})=>{const s=h(),a=y(),o=l.useCallback(()=>{a(Ue())},[a]);return e.jsx(b,{title:s.formatMessage(Y.clearTitle),message:s.formatMessage(Y.clearMessage),confirm:s.formatMessage(Y.clearConfirm),onConfirm:o,onClose:t})};async function Kt(){try{const t=await vt(!1).delete("/auth/sign_out",{headers:{Accept:"application/json"},withCredentials:!0});t.status===200&&t.data.redirect_to?window.location.href=t.data.redirect_to:console.error("Failed to log out, got an unexpected non-redirect response from the server",t)}catch(t){console.error("Failed to log out, response was an error",t)}}const W=x({logoutTitle:{id:"confirmations.logout.title",defaultMessage:"Log out?"},logoutMessage:{id:"confirmations.logout.message",defaultMessage:"Are you sure you want to log out?"},logoutConfirm:{id:"confirmations.logout.confirm",defaultMessage:"Log out"}}),Zt=({onClose:t})=>{const s=h(),a=l.useCallback(()=>{Kt()},[]);return e.jsx(b,{title:s.formatMessage(W.logoutTitle),message:s.formatMessage(W.logoutMessage),confirm:s.formatMessage(W.logoutConfirm),onConfirm:a,onClose:t})},ie=x({title:{id:"confirmations.follow_to_list.title",defaultMessage:"Follow user?"},confirm:{id:"confirmations.follow_to_list.confirm",defaultMessage:"Follow and add to list"}}),zt=({accountId:t,onConfirm:s,onClose:a})=>{const o=h(),n=v(i=>i.accounts.get(t));return e.jsx(b,{title:o.formatMessage(ie.title),message:e.jsx(p,{id:"confirmations.follow_to_list.message",defaultMessage:"You need to be following {name} to add them to a list.",values:{name:e.jsxs("strong",{children:["@",n==null?void 0:n.acct]})}}),confirm:o.formatMessage(ie.confirm),onConfirm:s,onClose:a})},O=x({title:{id:"confirmations.missing_alt_text.title",defaultMessage:"Add alt text?"},confirm:{id:"confirmations.missing_alt_text.confirm",defaultMessage:"Add alt text"},message:{id:"confirmations.missing_alt_text.message",defaultMessage:"Your post contains media without alt text. Adding descriptions helps make your content accessible to more people."},secondary:{id:"confirmations.missing_alt_text.secondary",defaultMessage:"Post anyway"}}),Xt=({onClose:t})=>{const s=h(),a=y(),o=v(r=>{var d;return(d=r.compose.get("media_attachments").find(c=>["image","gifv"].includes(c.get("type"))&&(c.get("description")??"").length===0))==null?void 0:d.get("id")}),n=l.useCallback(()=>{a(ce({modalType:"FOCAL_POINT",modalProps:{mediaId:o}}))},[a,o]),i=l.useCallback(()=>{a($e())},[a]);return e.jsx(b,{title:s.formatMessage(O.title),message:s.formatMessage(O.message),confirm:s.formatMessage(O.confirm),secondary:s.formatMessage(O.secondary),onConfirm:n,onSecondary:i,onClose:t})},Qt=x({close:{id:"lightbox.close",defaultMessage:"Close"}}),Jt=({src:t,alt:s,onClose:a})=>{const o=h(),[n,i]=l.useState(!1),r=l.useCallback(()=>{i(c=>!c)},[i]),d=k("media-modal__navigation",{"media-modal__navigation--hidden":n});return e.jsxs("div",{className:"modal-root__modal media-modal",children:[e.jsx("div",{className:"media-modal__closer",role:"presentation",onClick:a,children:e.jsx(Ye,{src:t,width:400,height:400,alt:s,onClick:r})}),e.jsx("div",{className:d,children:e.jsx("div",{className:"media-modal__buttons",children:e.jsx(He,{className:"media-modal__close",title:o.formatMessage(Qt.close),icon:"times",iconComponent:bt,onClick:a})})})]})},le=({loading:t,onClose:s,onRetry:a})=>{const o=l.useCallback(()=>{s(void 0,!1)},[s]),n=l.useCallback(()=>{a&&a()},[a]);return e.jsx("div",{className:"modal-root__modal modal-placeholder","aria-busy":t,children:t?e.jsx(ge,{}):e.jsxs("div",{className:"modal-placeholder__error",children:[e.jsx(jt,{src:"/oops.gif",staticSrc:"/oops.png",className:"modal-placeholder__error__image"}),e.jsxs("div",{className:"modal-placeholder__error__message",children:[e.jsx("p",{children:e.jsx(p,{id:"bundle_modal_error.message",defaultMessage:"Something went wrong while loading this screen."})}),e.jsxs("div",{className:"modal-placeholder__error__message__actions",children:[e.jsx(I,{onClick:n,children:e.jsx(p,{id:"bundle_modal_error.retry",defaultMessage:"Try again"})}),e.jsx(I,{onClick:o,className:"button button-tertiary",children:e.jsx(p,{id:"bundle_modal_error.close",defaultMessage:"Close"})})]})]})]})})},es=(t,{statusId:s})=>({status:t.getIn(["statuses",s])});class pe extends qe{componentDidMount(){const{media:s,onChangeBackgroundColor:a}=this.props,o=me(s.get("blurhash"));o&&a(o)}componentWillUnmount(){this.props.onChangeBackgroundColor(null)}render(){const{media:s,status:a,onClose:o}=this.props,n=this.props.options||{},i=a.getIn(["translation","language"])||a.get("language"),r=s.getIn(["translation","description"])||s.get("description");return e.jsxs("div",{className:"modal-root__modal video-modal",children:[e.jsx("div",{className:"video-modal__container",children:e.jsx(re,{preview:s.get("preview_url"),frameRate:s.getIn(["meta","original","frame_rate"]),aspectRatio:`${s.getIn(["meta","original","width"])} / ${s.getIn(["meta","original","height"])}`,blurhash:s.get("blurhash"),src:s.get("url"),startTime:n.startTime,startPlaying:n.autoPlay,startVolume:n.defaultVolume,onCloseVideo:o,autoFocus:!0,detailed:!0,alt:r,lang:i})}),e.jsx("div",{className:"media-modal__overlay",children:a&&e.jsx(ue,{statusId:a.get("id"),withOpenButton:!0,onClose:o})})]})}}N(pe,"propTypes",{media:ee.map.isRequired,statusId:T.string,status:ee.map,options:T.shape({startTime:T.number,autoPlay:T.bool,defaultVolume:T.number}),onClose:T.func.isRequired,onChangeBackgroundColor:T.func.isRequired});const ts=D(es,null,null,{forwardRef:!0})(pe),ss={MEDIA:()=>Promise.resolve({default:Ze}),VIDEO:()=>Promise.resolve({default:ts}),AUDIO:()=>Promise.resolve({default:Ut}),IMAGE:()=>Promise.resolve({default:Jt}),BOOST:()=>Promise.resolve({default:$t}),CONFIRM:()=>Promise.resolve({default:b}),CONFIRM_DELETE_STATUS:()=>Promise.resolve({default:Ht}),CONFIRM_DELETE_LIST:()=>Promise.resolve({default:qt}),CONFIRM_REPLY:()=>Promise.resolve({default:Vt}),CONFIRM_EDIT_STATUS:()=>Promise.resolve({default:Gt}),CONFIRM_UNFOLLOW:()=>Promise.resolve({default:Yt}),CONFIRM_CLEAR_NOTIFICATIONS:()=>Promise.resolve({default:Wt}),CONFIRM_LOG_OUT:()=>Promise.resolve({default:Zt}),CONFIRM_FOLLOW_TO_LIST:()=>Promise.resolve({default:zt}),CONFIRM_MISSING_ALT_TEXT:()=>Promise.resolve({default:Xt}),MUTE:ht,BLOCK:pt,DOMAIN_BLOCK:ft,REPORT:gt,ACTIONS:()=>Promise.resolve({default:Bt}),EMBED:ut,FOCAL_POINT:()=>Promise.resolve({default:fe}),LIST_ADDER:mt,COMPARE_HISTORY:ct,FILTER:dt,SUBSCRIBED_LANGUAGES:rt,INTERACTION:lt,CLOSED_REGISTRATIONS:it,IGNORE_NOTIFICATIONS:nt,ANNUAL_REPORT:ot};class as extends l.PureComponent{constructor(){super(...arguments);N(this,"state",{backgroundColor:null});N(this,"setBackgroundColor",a=>{this.setState({backgroundColor:a})});N(this,"renderLoading",()=>{const{onClose:a}=this.props;return e.jsx(le,{loading:!0,onClose:a})});N(this,"renderError",a=>{const{onClose:o}=this.props;return e.jsx(le,{...a,onClose:o})});N(this,"handleClose",(a=!1)=>{var i,r;const{onClose:o}=this.props,n=(r=(i=this._modal)==null?void 0:i.getCloseConfirmationMessage)==null?void 0:r.call(i);o(n,a)});N(this,"setModalRef",a=>{this._modal=a})}getSnapshotBeforeUpdate(){return{visible:!!this.props.type}}componentDidUpdate(a,o,{visible:n}){n?(document.body.classList.add("with-modals--active"),document.documentElement.style.marginRight=`${We()}px`):(document.body.classList.remove("with-modals--active"),document.documentElement.style.marginRight="0")}render(){const{type:a,props:o,ignoreFocus:n}=this.props,{backgroundColor:i}=this.state,r=!!a;return e.jsx(Ke,{backgroundColor:i,onClose:this.handleClose,ignoreFocus:n,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(Rt,{fetchComponent:ss[a],loading:this.renderLoading,error:this.renderError,renderDelay:200,children:d=>e.jsx(d,{...o,onChangeBackgroundColor:this.setBackgroundColor,onClose:this.handleClose,ref:this.setModalRef})}),e.jsx(Ve,{children:e.jsx("meta",{name:"robots",content:"noindex"})})]})})}}const os={},ns=t=>({ignoreFocus:t.getIn(["modal","ignoreFocus"]),type:t.getIn(["modal","stack",0,"modalType"],null),props:t.getIn(["modal","stack",0,"modalProps"],os)}),is=t=>({onClose(s,a=!1){t(s?ce({previousModalProps:s.props,modalType:"CONFIRM",modalProps:{message:s.message,confirm:s.confirm,onConfirm:()=>t(te({modalType:void 0,ignoreFocus:{ignoreFocus:a}}))}}):te({modalType:void 0,ignoreFocus:{ignoreFocus:a}}))}}),Es=D(ns,is)(as);export{ks as A,Rt as B,Is as L,Es as M};
//# sourceMappingURL=modal_container-BVBmHnZD.js.map
