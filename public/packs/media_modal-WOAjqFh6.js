var ce=Object.defineProperty;var he=(t,i,e)=>i in t?ce(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var w=(t,i,e)=>he(t,typeof i!="symbol"?i+"":i,e);import{j as f}from"./client-wT6vtYO_.js";import{u as fe,r as p,d as ie,i as ge}from"./index-BdTwX--g.js";import{d as me,e as ve,P as S}from"./short_number-WomMu2iV.js";import{d as pe,u as be,a as K,o as B,af as _e,a$ as ye,b0 as xe,b as A,aT as Y,v as Ie,w as Ee,b1 as we,aU as Ne,aV as Me,aW as Ce,ab as ke,aX as Re,aY as Se,aZ as Te,b2 as Ae,g as He,h as Le,b3 as De,b4 as je,i as Oe,y as ze,z as Pe,I as Q,aQ as Be,V as Ve}from"./useSelectableClick-DeaJbL2_.js";import{c as Z}from"./index-DizoKcfL.js";import{R as Ze}from"./index-Dy8WPmut.js";import{S as Fe}from"./chevron_left-CnYIoVsW.js";import{S as We}from"./close-BsPe8EbX.js";import{e as Ue,A as $e}from"./initial_state-BP3UcUr4.js";import{c as Ke,d as qe,p as Ge}from"./use-gesture-react.esm-PiBFdzIE.js";import{L as Xe}from"./loading_indicator-7xMB1U6D.js";const T=ie({reply:{id:"status.reply",defaultMessage:"Reply"},replyAll:{id:"status.replyAll",defaultMessage:"Reply to thread"},reblog:{id:"status.reblog",defaultMessage:"Boost"},reblog_private:{id:"status.reblog_private",defaultMessage:"Boost with original visibility"},cancel_reblog_private:{id:"status.cancel_reblog_private",defaultMessage:"Unboost"},cannot_reblog:{id:"status.cannot_reblog",defaultMessage:"This post cannot be boosted"},favourite:{id:"status.favourite",defaultMessage:"Favorite"},removeFavourite:{id:"status.remove_favourite",defaultMessage:"Remove from favorites"},open:{id:"status.open",defaultMessage:"Expand this status"}}),Ye=({statusId:t,withOpenButton:i,onClose:e})=>{const{signedIn:o}=pe(),l=fe(),r=me(),d=be(),a=K(M=>M.statuses.get(t)),b=a==null?void 0:a.get("account"),y=K(M=>b?M.accounts.get(b):void 0),C=K(M=>M.compose.get("text").trim().length!==0),m=p.useCallback(()=>{a&&(o?(e(!0),d(C?B({modalType:"CONFIRM_REPLY",modalProps:{status:a}}):_e(a))):d(B({modalType:"INTERACTION",modalProps:{type:"reply",accountId:a.getIn(["account","id"]),url:a.get("uri")}})))},[d,a,o,C,e]),s=p.useCallback(()=>{a&&d(o?ye(a.get("id")):B({modalType:"INTERACTION",modalProps:{type:"favourite",accountId:a.getIn(["account","id"]),url:a.get("uri")}}))},[d,a,o]),n=p.useCallback(M=>{a&&d(o?xe(a.get("id"),M.shiftKey):B({modalType:"INTERACTION",modalProps:{type:"reblog",accountId:a.getIn(["account","id"]),url:a.get("uri")}}))},[d,a,o]),h=p.useCallback(M=>{M.button!==0||!a||(e(),r.push(`/@${y==null?void 0:y.acct}/${a.get("id")}`))},[r,a,y,e]);if(!a)return null;const u=["public","unlisted"].includes(a.get("visibility")),g=a.getIn(["account","id"])===Ue&&a.get("visibility")==="private";let _,v,x;a.get("in_reply_to_id",null)===null?(_="reply",v=Y,x=l.formatMessage(T.reply)):(_="reply-all",v=Ne,x=l.formatMessage(T.replyAll));let N,c;a.get("reblogged")?(N=l.formatMessage(T.cancel_reblog_private),c=u?Me:Ce):u?(N=l.formatMessage(T.reblog),c=ke):g?(N=l.formatMessage(T.reblog_private),c=Re):(N=l.formatMessage(T.cannot_reblog),c=Se);const I=l.formatMessage(a.get("favourited")?T.removeFavourite:T.favourite);return f.jsxs("div",{className:"picture-in-picture__footer",children:[f.jsx(A,{className:"status__action-bar-button",title:x,icon:a.get("in_reply_to_account_id")===a.getIn(["account","id"])?"reply":_,iconComponent:a.get("in_reply_to_account_id")===a.getIn(["account","id"])?Y:v,onClick:m,counter:a.get("replies_count")}),f.jsx(A,{className:Z("status__action-bar-button",{reblogPrivate:g}),disabled:!u&&!g,active:a.get("reblogged"),title:N,icon:"retweet",iconComponent:c,onClick:n,counter:a.get("reblogs_count")}),f.jsx(A,{className:"status__action-bar-button star-icon",animate:!0,active:a.get("favourited"),title:I,icon:"star",iconComponent:a.get("favourited")?Ie:Ee,onClick:s,counter:a.get("favourites_count")}),i&&f.jsx(A,{className:"status__action-bar-button",title:l.formatMessage(T.open),icon:"external-link",iconComponent:we,onClick:h,href:`/@${y==null?void 0:y.acct}/${a.get("id")}`})]})};var J={},ee;function Qe(){if(ee)return J;ee=1;var t=function(){function e(o,l){for(var r=0;r<l.length;r++){var d=l[r];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}return function(o,l,r){return l&&e(o.prototype,l),r&&e(o,r),o}}();function i(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}return function(){if(typeof window>"u"||typeof Element>"u")return;var e=Array.prototype.slice,o=Element.prototype.matches||Element.prototype.msMatchesSelector,l=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","details","summary","iframe","object","embed","video","[contenteditable]"].join(","),r=function(){function m(s,n){i(this,m),this._inertManager=n,this._rootElement=s,this._managedNodes=new Set,this._rootElement.hasAttribute("aria-hidden")?this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"):this._savedAriaHidden=null,this._rootElement.setAttribute("aria-hidden","true"),this._makeSubtreeUnfocusable(this._rootElement),this._observer=new MutationObserver(this._onMutation.bind(this)),this._observer.observe(this._rootElement,{attributes:!0,childList:!0,subtree:!0})}return t(m,[{key:"destructor",value:function(){this._observer.disconnect(),this._rootElement&&(this._savedAriaHidden!==null?this._rootElement.setAttribute("aria-hidden",this._savedAriaHidden):this._rootElement.removeAttribute("aria-hidden")),this._managedNodes.forEach(function(n){this._unmanageNode(n.node)},this),this._observer=null,this._rootElement=null,this._managedNodes=null,this._inertManager=null}},{key:"_makeSubtreeUnfocusable",value:function(n){var h=this;b(n,function(v){return h._visitNode(v)});var u=document.activeElement;if(!document.body.contains(n)){for(var g=n,_=void 0;g;){if(g.nodeType===Node.DOCUMENT_FRAGMENT_NODE){_=g;break}g=g.parentNode}_&&(u=_.activeElement)}n.contains(u)&&(u.blur(),u===document.activeElement&&document.body.focus())}},{key:"_visitNode",value:function(n){if(n.nodeType===Node.ELEMENT_NODE){var h=n;h!==this._rootElement&&h.hasAttribute("inert")&&this._adoptInertRoot(h),(o.call(h,l)||h.hasAttribute("tabindex"))&&this._manageNode(h)}}},{key:"_manageNode",value:function(n){var h=this._inertManager.register(n,this);this._managedNodes.add(h)}},{key:"_unmanageNode",value:function(n){var h=this._inertManager.deregister(n,this);h&&this._managedNodes.delete(h)}},{key:"_unmanageSubtree",value:function(n){var h=this;b(n,function(u){return h._unmanageNode(u)})}},{key:"_adoptInertRoot",value:function(n){var h=this._inertManager.getInertRoot(n);h||(this._inertManager.setInert(n,!0),h=this._inertManager.getInertRoot(n)),h.managedNodes.forEach(function(u){this._manageNode(u.node)},this)}},{key:"_onMutation",value:function(n,h){n.forEach(function(u){var g=u.target;if(u.type==="childList")e.call(u.addedNodes).forEach(function(v){this._makeSubtreeUnfocusable(v)},this),e.call(u.removedNodes).forEach(function(v){this._unmanageSubtree(v)},this);else if(u.type==="attributes"){if(u.attributeName==="tabindex")this._manageNode(g);else if(g!==this._rootElement&&u.attributeName==="inert"&&g.hasAttribute("inert")){this._adoptInertRoot(g);var _=this._inertManager.getInertRoot(g);this._managedNodes.forEach(function(v){g.contains(v.node)&&_._manageNode(v.node)})}}},this)}},{key:"managedNodes",get:function(){return new Set(this._managedNodes)}},{key:"hasSavedAriaHidden",get:function(){return this._savedAriaHidden!==null}},{key:"savedAriaHidden",set:function(n){this._savedAriaHidden=n},get:function(){return this._savedAriaHidden}}]),m}(),d=function(){function m(s,n){i(this,m),this._node=s,this._overrodeFocusMethod=!1,this._inertRoots=new Set([n]),this._savedTabIndex=null,this._destroyed=!1,this.ensureUntabbable()}return t(m,[{key:"destructor",value:function(){if(this._throwIfDestroyed(),this._node&&this._node.nodeType===Node.ELEMENT_NODE){var n=this._node;this._savedTabIndex!==null?n.setAttribute("tabindex",this._savedTabIndex):n.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete n.focus}this._node=null,this._inertRoots=null,this._destroyed=!0}},{key:"_throwIfDestroyed",value:function(){if(this.destroyed)throw new Error("Trying to access destroyed InertNode")}},{key:"ensureUntabbable",value:function(){if(this.node.nodeType===Node.ELEMENT_NODE){var n=this.node;if(o.call(n,l)){if(n.tabIndex===-1&&this.hasSavedTabIndex)return;n.hasAttribute("tabindex")&&(this._savedTabIndex=n.tabIndex),n.setAttribute("tabindex","-1"),n.nodeType===Node.ELEMENT_NODE&&(n.focus=function(){},this._overrodeFocusMethod=!0)}else n.hasAttribute("tabindex")&&(this._savedTabIndex=n.tabIndex,n.removeAttribute("tabindex"))}}},{key:"addInertRoot",value:function(n){this._throwIfDestroyed(),this._inertRoots.add(n)}},{key:"removeInertRoot",value:function(n){this._throwIfDestroyed(),this._inertRoots.delete(n),this._inertRoots.size===0&&this.destructor()}},{key:"destroyed",get:function(){return this._destroyed}},{key:"hasSavedTabIndex",get:function(){return this._savedTabIndex!==null}},{key:"node",get:function(){return this._throwIfDestroyed(),this._node}},{key:"savedTabIndex",set:function(n){this._throwIfDestroyed(),this._savedTabIndex=n},get:function(){return this._throwIfDestroyed(),this._savedTabIndex}}]),m}(),a=function(){function m(s){if(i(this,m),!s)throw new Error("Missing required argument; InertManager needs to wrap a document.");this._document=s,this._managedNodes=new Map,this._inertRoots=new Map,this._observer=new MutationObserver(this._watchForInert.bind(this)),y(s.head||s.body||s.documentElement),s.readyState==="loading"?s.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}return t(m,[{key:"setInert",value:function(n,h){if(h){if(this._inertRoots.has(n))return;var u=new r(n,this);if(n.setAttribute("inert",""),this._inertRoots.set(n,u),!this._document.body.contains(n))for(var g=n.parentNode;g;)g.nodeType===11&&y(g),g=g.parentNode}else{if(!this._inertRoots.has(n))return;var _=this._inertRoots.get(n);_.destructor(),this._inertRoots.delete(n),n.removeAttribute("inert")}}},{key:"getInertRoot",value:function(n){return this._inertRoots.get(n)}},{key:"register",value:function(n,h){var u=this._managedNodes.get(n);return u!==void 0?u.addInertRoot(h):u=new d(n,h),this._managedNodes.set(n,u),u}},{key:"deregister",value:function(n,h){var u=this._managedNodes.get(n);return u?(u.removeInertRoot(h),u.destroyed&&this._managedNodes.delete(n),u):null}},{key:"_onDocumentLoaded",value:function(){var n=e.call(this._document.querySelectorAll("[inert]"));n.forEach(function(h){this.setInert(h,!0)},this),this._observer.observe(this._document.body||this._document.documentElement,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function(n,h){var u=this;n.forEach(function(g){switch(g.type){case"childList":e.call(g.addedNodes).forEach(function(x){if(x.nodeType===Node.ELEMENT_NODE){var N=e.call(x.querySelectorAll("[inert]"));o.call(x,"[inert]")&&N.unshift(x),N.forEach(function(c){this.setInert(c,!0)},u)}},u);break;case"attributes":if(g.attributeName!=="inert")return;var _=g.target,v=_.hasAttribute("inert");u.setInert(_,v);break}},this)}}]),m}();function b(m,s,n){if(m.nodeType==Node.ELEMENT_NODE){var h=m;s&&s(h);var u=h.shadowRoot;if(u){b(u,s);return}if(h.localName=="content"){for(var g=h,_=g.getDistributedNodes?g.getDistributedNodes():[],v=0;v<_.length;v++)b(_[v],s);return}if(h.localName=="slot"){for(var x=h,N=x.assignedNodes?x.assignedNodes({flatten:!0}):[],c=0;c<N.length;c++)b(N[c],s);return}}for(var I=m.firstChild;I!=null;)b(I,s),I=I.nextSibling}function y(m){if(!m.querySelector("style#inert-style, link#inert-style")){var s=document.createElement("style");s.setAttribute("id","inert-style"),s.textContent=`
[inert] {
  pointer-events: none;
  cursor: default;
}

[inert], [inert] * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
`,m.appendChild(s)}}if(!HTMLElement.prototype.hasOwnProperty("inert")){var C=new a(document);Object.defineProperty(HTMLElement.prototype,"inert",{enumerable:!0,get:function(){return this.hasAttribute("inert")},set:function(s){C.setInert(this,s)}})}}(),J}Qe();function Je(t,i,e){return{r:255*e(t.r/255,i.r/255),g:255*e(t.g/255,i.g/255),b:255*e(t.b/255,i.b/255)}}function et(t,i){return t*i}function V(t,i,e){return Math.min(Math.max(t||0,i),e)}function q(t){return{r:V(t.r,0,255),g:V(t.g,0,255),b:V(t.b,0,255),a:V(t.a,0,1)}}function te(t){return{r:255*t.r,g:255*t.g,b:255*t.b,a:t.a}}function tt(t){return{r:t.r/255,g:t.g/255,b:t.b/255,a:t.a}}function ne(t,i){i===void 0&&(i=0);var e=Math.pow(10,i);return{r:Math.round(t.r*e)/e,g:Math.round(t.g*e)/e,b:Math.round(t.b*e)/e,a:t.a}}function G(t,i,e,o,l,r){return(1-i/e)*o+i/e*Math.round((1-t)*l+t*r)}function nt(t,i,e,o,l){l===void 0&&(l={unitInput:!1,unitOutput:!1,roundOutput:!0}),l.unitInput&&(t=te(t),i=te(i)),t=q(t);var r=(i=q(i)).a+t.a-i.a*t.a,d=e(t,i,o),a=q({r:G(t.a,i.a,r,t.r,i.r,d.r),g:G(t.a,i.a,r,t.g,i.g,d.g),b:G(t.a,i.a,r,t.b,i.b,d.b),a:r});return a=l.unitOutput?tt(a):l.roundOutput?ne(a):function(b){return ne(b,9)}(a),a}function it(t,i){return nt(t,i,Je,et)}class ot extends p.PureComponent{constructor(){super(...arguments);w(this,"activeElement",this.props.children?document.activeElement:null);w(this,"handleKeyUp",e=>{(e.key==="Escape"||e.key==="Esc"||e.keyCode===27)&&this.props.children&&this.props.onClose()});w(this,"handleKeyDown",e=>{if(e.key==="Tab"){const o=Array.from(this.node.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(d=>window.getComputedStyle(d).display!=="none"),l=o.indexOf(e.target);let r;e.shiftKey?r=o[l-1]||o[o.length-1]:r=o[l+1]||o[0],r&&(r.focus(),e.stopPropagation(),e.preventDefault())}});w(this,"getSiblings",()=>Array(...this.node.parentElement.childNodes).filter(e=>e!==this.node));w(this,"setRef",e=>{this.node=e})}componentDidMount(){window.addEventListener("keyup",this.handleKeyUp,!1),window.addEventListener("keydown",this.handleKeyDown,!1),this.history=this.props.history||ve()}UNSAFE_componentWillReceiveProps(e){e.children&&!this.props.children&&(this.activeElement=document.activeElement,this.getSiblings().forEach(o=>o.setAttribute("inert",!0)))}componentDidUpdate(e){!this.props.children&&e.children&&(this.getSiblings().forEach(o=>o.removeAttribute("inert")),Promise.resolve().then(()=>{this.props.ignoreFocus||this.activeElement.focus({preventScroll:!0}),this.activeElement=null}).catch(console.error),this._handleModalClose()),this.props.children&&!e.children&&this._handleModalOpen(),this.props.children&&this._ensureHistoryBuffer()}componentWillUnmount(){window.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("keydown",this.handleKeyDown)}_handleModalOpen(){this._modalHistoryKey=Date.now(),this.unlistenHistory=this.history.listen((e,o)=>{o==="POP"&&this.props.onClose()})}_handleModalClose(){this.unlistenHistory&&this.unlistenHistory();const{state:e}=this.history.location;e&&e.mastodonModalKey===this._modalHistoryKey&&this.history.goBack()}_ensureHistoryBuffer(){const{pathname:e,search:o,hash:l,state:r}=this.history.location;(!r||r.mastodonModalKey!==this._modalHistoryKey)&&this.history.push({pathname:e,search:o,hash:l},{...r,mastodonModalKey:this._modalHistoryKey})}render(){const{children:e,onClose:o}=this.props,l=!!e;if(!l)return f.jsx("div",{className:"modal-root",ref:this.setRef,style:{opacity:0}});let r=null;if(this.props.backgroundColor&&typeof this.props.backgroundColor=="string")r=this.props.backgroundColor;else if(this.props.backgroundColor){const d=it({...this.props.backgroundColor,a:1},{r:0,g:0,b:0,a:.7});r=`rgb(${d.r}, ${d.g}, ${d.b})`}return f.jsx("div",{className:"modal-root",ref:this.setRef,children:f.jsxs("div",{style:{pointerEvents:l?"auto":"none"},children:[f.jsx("div",{role:"presentation",className:"modal-root__overlay",onClick:o,style:{backgroundColor:r}}),f.jsx("div",{role:"dialog",className:"modal-root__container",children:e})]})})}}const St=Te(ot),oe=p.forwardRef(({src:t,alt:i,lang:e,width:o,height:l,onClick:r,onMouseDown:d,onTouchStart:a},b)=>{const[y,C]=p.useState(!0),m=p.useCallback(()=>{C(!1)},[C]),s=p.useCallback(n=>{n.stopPropagation(),r==null||r(n)},[r]);return f.jsxs("div",{className:"gifv",children:[y&&f.jsx("canvas",{role:"button",tabIndex:0,"aria-label":i,title:i,lang:e,onClick:s}),f.jsx("video",{ref:b,src:t,role:"button",tabIndex:0,"aria-label":i,title:i,lang:e,width:o,height:l,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,onClick:s,onLoadedData:m,onMouseDown:d,onTouchStart:a})]})});oe.displayName="GIFV";let X=null;const st=()=>{const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const i=document.createElement("div");t.appendChild(i);const e=t.offsetWidth-i.offsetWidth;return t.remove(),e},Tt=()=>{if(X!==null)return X;const t=Ae(window.innerWidth)?0:st();return X=t,t},at=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],rt=t=>{let i=0,e;for(const o of t)e=at.indexOf(o),i=i*83+e;return i},lt=t=>({r:Math.max(0,t>>16),g:Math.max(0,t>>8&255),b:Math.max(0,t&255)}),dt=t=>t?lt(rt(t.slice(2,6))):null,j=1,ut=4,ct=250,ht=(t,i,e,o)=>{const{clientWidth:l,clientHeight:r}=t,{offsetWidth:d,offsetHeight:a}=i,y=(e/o<l/r?"width":"height")==="width"?Math.min(l,e)/d:Math.min(r,o)/a;return{containerWidth:l,containerHeight:r,imageWidth:d,imageHeight:a,initialScale:y}},ft=Ke([qe,Ge]),gt=(t,i)=>{if(!t||i===j)return{left:-1/0,right:1/0,top:-1/0,bottom:1/0};const{containerWidth:e,containerHeight:o,imageWidth:l,imageHeight:r}=t;return{left:-Math.max(l*i-e,0)/2,right:Math.max(l*i-e,0)/2,top:-Math.max(r*i-o,0)/2,bottom:Math.max(r*i-o,0)/2}},mt=({alt:t="",lang:i="",src:e,width:o,height:l,onClick:r,onDoubleClick:d,onClose:a,onZoomChange:b,zoomedIn:y,blurhash:C})=>{p.useEffect(()=>{const E=k=>{k.preventDefault()};return document.addEventListener("gesturestart",E),document.addEventListener("gesturechange",E),document.addEventListener("gestureend",E),()=>{document.removeEventListener("gesturestart",E),document.removeEventListener("gesturechange",E),document.removeEventListener("gestureend",E)}},[]);const[m,s]=p.useState(!1),[n,h]=p.useState(!1),[u,g]=p.useState(!1),_=p.useRef(null),v=p.useRef(null),x=p.useRef(),N=p.useRef(null),[c,I]=He(()=>({x:0,y:0,scale:1,onRest:{scale({value:E}){b&&b(E!==j)}}}));ft({onDrag({pinching:E,cancel:k,active:L,last:z,offset:[W,R],velocity:[,U],direction:[,P],tap:$}){if($){x.current?(clearTimeout(x.current),x.current=null,d==null||d()):x.current=setTimeout(()=>{r==null||r(),x.current=null},ct);return}if(!y){if(z){(U>.5&&P!==0||Math.abs(R)>150)&&(a==null||a()),I.start({y:0,config:Le.wobbly});return}else if(P!==0){I.start({y:R,immediate:!0});return}k();return}if(E){k();return}s(!!L),I.start({x:W,y:R})},onPinch({origin:[E,k],first:L,movement:[z],offset:[W],memo:R}){if(!v.current)return;if(L){const{width:$,height:ae,x:re,y:le}=v.current.getBoundingClientRect(),de=E-(re+$/2),ue=k-(le+ae/2);R=[c.x.get(),c.y.get(),de,ue]}const U=R[0]-(z-1)*R[2],P=R[1]-(z-1)*R[3];return I.start({scale:W,x:U,y:P}),R}},{target:v,drag:{from:()=>[c.x.get(),c.y.get()],filterTaps:!0,bounds:()=>gt(N.current,c.scale.get()),rubberband:!0},pinch:{scaleBounds:{min:j,max:ut},rubberband:!0}}),p.useEffect(()=>{!n||!_.current||!v.current||(N.current=ht(_.current,v.current,o,l),y?c.scale.get()===j&&I.start({scale:N.current.initialScale,x:0,y:0}):I.start({scale:j,x:0,y:0}))},[I,c.scale,y,o,l,n]);const M=p.useCallback(E=>{E.preventDefault(),E.stopPropagation()},[]),O=p.useCallback(()=>{h(!0)},[h]),H=p.useCallback(()=>{g(!0)},[g]),F=De([c.scale,c.x,c.y],(E,k,L)=>`matrix(${E}, 0, 0, ${E}, ${k}, ${L})`);return f.jsxs("div",{className:Z("zoomable-image",{"zoomable-image--zoomed-in":y,"zoomable-image--error":u,"zoomable-image--dragging":m}),ref:_,children:[!n&&C&&f.jsx("div",{className:"zoomable-image__preview",style:{aspectRatio:`${o}/${l}`,height:`min(${l}px, 100%)`},children:f.jsx(je,{hash:C})}),f.jsx(Oe.img,{style:{transform:F},role:"presentation",ref:v,alt:t,title:t,lang:i,src:e,width:o,height:l,draggable:!1,onLoad:O,onError:H,onClickCapture:M}),!n&&!u&&f.jsx(Xe,{})]})},vt=t=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...t},p.createElement("path",{d:"M800-600v-120H680v-80h120q33 0 56.5 23.5T880-720v120h-80Zm-720 0v-120q0-33 23.5-56.5T160-800h120v80H160v120H80Zm600 440v-80h120v-120h80v120q0 33-23.5 56.5T800-160H680Zm-520 0q-33 0-56.5-23.5T80-240v-120h80v120h120v80H160Zm80-160v-320h480v320H240Zm80-80h320v-160H320v160Zm0 0v-160 160Z"})),pt=t=>p.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},p.createElement("path",{d:"M3.1002 20.2C2.46686 20.2 1.9252 19.9833 1.4752 19.55C1.04186 19.1 0.825195 18.5583 0.825195 17.925V6.07499C0.825195 5.44165 1.04186 4.90832 1.4752 4.47499C1.9252 4.02499 2.46686 3.79999 3.1002 3.79999H20.9002C21.5335 3.79999 22.0669 4.02499 22.5002 4.47499C22.9502 4.90832 23.1752 5.44165 23.1752 6.07499V17.925C23.1752 18.5583 22.9502 19.1 22.5002 19.55C22.0669 19.9833 21.5335 20.2 20.9002 20.2H3.1002ZM3.1002 17.925H20.9002V6.07499H3.1002V17.925Z",fill:"black"}),p.createElement("path",{d:"M8.12522 16V9.85782H6.25043V8H10V16H8.12522ZM11.1461 16V14.1422H13.0209V16H11.1461ZM15.1252 16V9.85782H13.2313V8H17V16H15.1252ZM11.1461 12.8578V11H13.0209V12.8578H11.1461Z",fill:"black"})),D=ie({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"},zoomIn:{id:"lightbox.zoom_in",defaultMessage:"Zoom to actual size"},zoomOut:{id:"lightbox.zoom_out",defaultMessage:"Zoom to fit"}});class se extends ze{constructor(){super(...arguments);w(this,"state",{index:null,navigationHidden:!1,zoomedIn:!1});w(this,"handleZoomClick",()=>{this.setState(e=>({zoomedIn:!e.zoomedIn}))});w(this,"handleZoomChange",e=>{this.setState({zoomedIn:e})});w(this,"handleSwipe",e=>{this.setState({index:e%this.props.media.size,zoomedIn:!1})});w(this,"handleTransitionEnd",()=>{this.setState({zoomedIn:!1})});w(this,"handleNextClick",()=>{this.setState({index:(this.getIndex()+1)%this.props.media.size,zoomedIn:!1})});w(this,"handlePrevClick",()=>{this.setState({index:(this.props.media.size+this.getIndex()-1)%this.props.media.size,zoomedIn:!1})});w(this,"handleChangeIndex",e=>{const o=Number(e.currentTarget.getAttribute("data-index"));this.setState({index:o%this.props.media.size,zoomedIn:!1})});w(this,"handleKeyDown",e=>{switch(e.key){case"ArrowLeft":this.handlePrevClick(),e.preventDefault(),e.stopPropagation();break;case"ArrowRight":this.handleNextClick(),e.preventDefault(),e.stopPropagation();break}});w(this,"handleToggleNavigation",()=>{this.setState(e=>({navigationHidden:!e.navigationHidden}))});w(this,"setRef",e=>{this.setState({viewportWidth:e==null?void 0:e.clientWidth,viewportHeight:e==null?void 0:e.clientHeight})})}componentDidMount(){window.addEventListener("keydown",this.handleKeyDown,!1),this._sendBackgroundColor()}componentDidUpdate(e,o){o.index!==this.state.index&&this._sendBackgroundColor()}_sendBackgroundColor(){const{media:e,onChangeBackgroundColor:o}=this.props,l=this.getIndex(),r=e.getIn([l,"blurhash"]);if(r){const d=dt(r);o(d)}}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown),this.props.onChangeBackgroundColor(null)}getIndex(){return this.state.index!==null?this.state.index:this.props.index}render(){const{media:e,statusId:o,lang:l,intl:r,onClose:d}=this.props,{navigationHidden:a,zoomedIn:b,viewportWidth:y,viewportHeight:C}=this.state,m=this.getIndex(),s=e.size>1&&f.jsx("button",{tabIndex:0,className:"media-modal__nav media-modal__nav--prev",onClick:this.handlePrevClick,"aria-label":r.formatMessage(D.previous),children:f.jsx(Q,{id:"chevron-left",icon:Fe})}),n=e.size>1&&f.jsx("button",{tabIndex:0,className:"media-modal__nav  media-modal__nav--next",onClick:this.handleNextClick,"aria-label":r.formatMessage(D.next),children:f.jsx(Q,{id:"chevron-right",icon:Be})}),h=e.map((c,I)=>{const M=c.getIn(["meta","original","width"])||null,O=c.getIn(["meta","original","height"])||null,H=c.getIn(["translation","description"])||c.get("description");if(c.get("type")==="image")return f.jsx(mt,{src:c.get("url"),blurhash:c.get("blurhash"),width:M,height:O,alt:H,lang:l,onClick:this.handleToggleNavigation,onDoubleClick:this.handleZoomClick,onClose:d,onZoomChange:this.handleZoomChange,zoomedIn:b&&I===m},c.get("url"));if(c.get("type")==="video"){const{currentTime:F,autoPlay:E,volume:k}=this.props;return f.jsx(Ve,{preview:c.get("preview_url"),blurhash:c.get("blurhash"),src:c.get("url"),width:c.get("width"),height:c.get("height"),frameRate:c.getIn(["meta","original","frame_rate"]),aspectRatio:`${c.getIn(["meta","original","width"])} / ${c.getIn(["meta","original","height"])}`,startTime:F||0,startPlaying:E||!1,startVolume:k||1,onCloseVideo:d,detailed:!0,alt:H,lang:l},c.get("url"))}else if(c.get("type")==="gifv")return f.jsx(oe,{src:c.get("url"),width:M,height:O,alt:H,lang:l,onClick:this.toggleNavigation},c.get("url"));return null}).toArray(),u={width:"100%",height:"100%"},g={alignItems:"center"},_=Z("media-modal__navigation",{"media-modal__navigation--hidden":a});let v;e.size>1&&(v=e.map((c,I)=>f.jsx("button",{className:Z("media-modal__page-dot",{active:I===m}),"data-index":I,onClick:this.handleChangeIndex,children:I+1},I)));const x=e.get(m),N=x.get("type")==="image"&&(x.getIn(["meta","original","width"])>y||x.getIn(["meta","original","height"])>C);return f.jsxs("div",{className:"modal-root__modal media-modal",ref:this.setRef,children:[f.jsx("div",{className:"media-modal__closer",role:"presentation",onClick:d,children:f.jsx(Ze,{style:u,containerStyle:g,onChangeIndex:this.handleSwipe,onTransitionEnd:this.handleTransitionEnd,index:m,disabled:$e||b,children:h})}),f.jsxs("div",{className:_,children:[f.jsxs("div",{className:"media-modal__buttons",children:[N&&f.jsx(A,{title:r.formatMessage(b?D.zoomOut:D.zoomIn),iconComponent:b?vt:pt,onClick:this.handleZoomClick}),f.jsx(A,{title:r.formatMessage(D.close),icon:"times",iconComponent:We,onClick:d})]}),s,n,f.jsxs("div",{className:"media-modal__overlay",children:[v&&f.jsx("ul",{className:"media-modal__pagination",children:v}),o&&f.jsx(Ye,{statusId:o,withOpenButton:!0,onClose:d})]})]})]})}}w(se,"propTypes",{media:Pe.list.isRequired,statusId:S.string,lang:S.string,index:S.number.isRequired,onClose:S.func.isRequired,intl:S.object.isRequired,onChangeBackgroundColor:S.func.isRequired,currentTime:S.number,autoPlay:S.bool,volume:S.number});const At=ge(se);export{Ye as F,oe as G,St as M,mt as Z,Tt as a,At as b,dt as g};
//# sourceMappingURL=media_modal-WOAjqFh6.js.map
