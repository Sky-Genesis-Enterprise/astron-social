var K=Object.defineProperty;var O=(s,n,a)=>n in s?K(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a;var S=(s,n,a)=>O(s,typeof n!="symbol"?n+"":n,a);import{j as e}from"./client-wT6vtYO_.js";import{r as l,u as q,d as D}from"./index-BdTwX--g.js";import{H as J}from"./Helmet-ZVWnGmbg.js";import{y as Q,z as X,I as R,A as ee,bs as T,bt as b,an as te,d2 as L,o as se,af as ae,d3 as oe,c0 as ne,c1 as ie,a3 as re,b as le,aT as ce,H as de,d4 as A,ae as me,cF as ue,cG as pe,d5 as he,d6 as fe}from"./useSelectableClick-DeaJbL2_.js";import{b as ge,S as ve,d as xe}from"./content_warning-DZ8mar1O.js";import{e as _e}from"./streaming-BaFGIdWo.js";import{C as Me}from"./column-B4vwzadM.js";import{C as je}from"./column_header-FN7GyEAs.js";import{S as Ce}from"./scrollable_list-lNykmhKA.js";import{c as $}from"./index-DizoKcfL.js";import{P as be,d as ke,L as ye}from"./short_number-WomMu2iV.js";import{i as Se}from"./index.es-B0ZBMj49.js";import{M as k}from"./message-UFwkQlnu.js";import{l as I}from"./initial_state-BP3UcUr4.js";import{R as we}from"./index-CAH5FfLP.js";import{S as Ie}from"./status_content-CaIN8-0B.js";import{m as Te}from"./index-OwtqmxAM.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./load_locale-tOpKhmcM.js";import"./skeleton-D9NbTYr9.js";import"./scroll-BygYx8ga.js";import"./add-D8GR9P00.js";import"./chevron_left-CnYIoVsW.js";import"./close-BsPe8EbX.js";import"./scroll_container-Bq73vRM7.js";import"./react-router-scroll-4.es-CU7ja20b.js";import"./interopRequireDefault-CdiRfGvq.js";import"./schedule_idle_task-Co3Ydhdu.js";import"./load_more-qGthrhsi.js";import"./loading_indicator-7xMB1U6D.js";import"./numbers-CGZQWBYL.js";import"./poll-CjurB963.js";const E=s=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...s},l.createElement("path",{d:"M440-280H280q-83 0-141.5-58.5T80-480q0-83 58.5-141.5T280-680h160v80H280q-50 0-85 35t-35 85q0 50 35 85t85 35h160v80ZM320-440v-80h320v80H320Zm200 160v-80h160q50 0 85-35t35-85q0-50-35-85t-85-35H520v-80h160q83 0 141.5 58.5T880-480q0 83-58.5 141.5T680-280H520Z"})),He=s=>s.split("/").pop().split("#")[0].split("?")[0];class z extends Q{render(){const{media:n,compact:a}=this.props;return e.jsxs("div",{className:$("attachment-list",{compact:a}),children:[!a&&e.jsx("div",{className:"attachment-list__icon",children:e.jsx(R,{id:"link",icon:E})}),e.jsx("ul",{className:"attachment-list__list",children:n.map(t=>{const o=t.get("remote_url")||t.get("url");return e.jsx("li",{children:e.jsxs("a",{href:o,target:"_blank",rel:"noopener",children:[a&&e.jsx(R,{id:"link",icon:E}),a&&" ",o?He(o):e.jsx(k,{id:"attachments_list.unprocessed",defaultMessage:"(unprocessed)"})]})},t.get("id"))})})]})}}S(z,"propTypes",{media:X.list.isRequired,compact:be.bool});class U extends l.PureComponent{renderItem(n,a,t){const{animate:o}=this.props;let u=50,f=100,p="auto",d="auto",i="auto",h="auto";a===1&&(u=100),(a===4||a===3&&t>0)&&(f=50),a===2?t===0?h="1px":d="1px":a===3?(t===0?h="1px":t>0&&(d="1px"),t===1?i="1px":t>1&&(p="1px")):a===4&&((t===0||t===2)&&(h="1px"),(t===1||t===3)&&(d="1px"),t<2?i="1px":p="1px");const r={left:d,top:p,right:h,bottom:i,width:`${u}%`,height:`${f}%`};return e.jsx("div",{style:r,children:e.jsx(ee,{account:n,animate:o})},n.get("id"))}render(){const{accounts:n,size:a}=this.props;return e.jsxs("div",{className:"account__avatar-composite",style:{width:`${a}px`,height:`${a}px`},children:[n.take(4).map((t,o)=>this.renderItem(t,Math.min(n.size,4),o)),n.size>4&&e.jsxs("span",{className:"account__avatar-composite__label",children:["+",n.size-4]})]})}}S(U,"defaultProps",{animate:I});const _=D({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"}}),Ne=te(s=>s.get("accounts"),(s,n)=>n,(s,n)=>n.map(a=>s.get(a))),Re=Te(),Le=({conversation:s,scrollKey:n,onMoveUp:a,onMoveDown:t})=>{const o=s.get("id"),u=s.get("unread"),f=s.get("last_status"),p=s.get("accounts"),d=q(),i=T(),h=ke(),r=b(m=>Re(m,{id:f})),M=b(m=>Ne(m,p)),c=l.useCallback(({currentTarget:m})=>{if(I)return;const g=m.querySelectorAll(".custom-emoji");for(var x=0;x<g.length;x++){let C=g[x];C.src=C.getAttribute("data-original")}},[]),j=l.useCallback(({currentTarget:m})=>{if(I)return;const g=m.querySelectorAll(".custom-emoji");for(var x=0;x<g.length;x++){let C=g[x];C.src=C.getAttribute("data-static")}},[]),v=l.useCallback(()=>{u&&i(L(o)),h.push(`/@${r.getIn(["account","acct"])}/${r.get("id")}`)},[i,h,u,o,r]),F=l.useCallback(()=>{i(L(o))},[i,o]),H=l.useCallback(()=>{i((m,g)=>{g().getIn(["compose","text"]).trim().length!==0?i(se({modalType:"CONFIRM_REPLY",modalProps:{status:r}})):i(ae(r))})},[i,r]),G=l.useCallback(()=>{i(oe(o))},[i,o]),V=l.useCallback(()=>{a(o)},[o,a]),W=l.useCallback(()=>{t(o)},[o,t]),Z=l.useCallback(()=>{r.get("muted")?i(ne(r.get("id"))):i(ie(r.get("id")))},[i,r]),N=l.useCallback(()=>{i(re(r.get("id")))},[i,r]);if(!r)return null;const y=[{text:d.formatMessage(_.open),action:v},null,{text:d.formatMessage(r.get("muted")?_.unmuteConversation:_.muteConversation),action:Z}];u&&(y.push({text:d.formatMessage(_.markAsRead),action:F}),y.push(null)),y.push({text:d.formatMessage(_.delete),action:G});const B=M.map(m=>e.jsx(ye,{to:`/@${m.get("acct")}`,"data-hover-card-account":m.get("id"),children:e.jsx("bdi",{children:e.jsx("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:m.get("display_name_html")}})})},m.get("id"))).reduce((m,g)=>[m,", ",g]),Y={reply:H,open:v,moveUp:V,moveDown:W,toggleHidden:N};return e.jsx(Se.HotKeys,{handlers:Y,children:e.jsxs("div",{className:$("conversation focusable muted",{unread:u}),tabIndex:0,children:[e.jsx("div",{className:"conversation__avatar",onClick:v,role:"presentation",children:e.jsx(U,{accounts:M,size:48})}),e.jsxs("div",{className:"conversation__content",children:[e.jsxs("div",{className:"conversation__content__info",children:[e.jsxs("div",{className:"conversation__content__relative-time",children:[u&&e.jsx("span",{className:"conversation__unread"})," ",e.jsx(we,{timestamp:r.get("created_at")})]}),e.jsx("div",{className:"conversation__content__names",onMouseEnter:c,onMouseLeave:j,children:e.jsx(k,{id:"conversation.with",defaultMessage:"With {names}",values:{names:e.jsx("span",{children:B})}})})]}),e.jsx(Ie,{status:r,onClick:v,expanded:!r.get("hidden"),onExpandedToggle:N,collapsible:!0}),r.get("media_attachments").size>0&&e.jsx(z,{compact:!0,media:r.get("media_attachments")}),e.jsxs("div",{className:"status__action-bar",children:[e.jsx(le,{className:"status__action-bar-button",title:d.formatMessage(_.reply),icon:"reply",iconComponent:ce,onClick:H}),e.jsx("div",{className:"status__action-bar-dropdown",children:e.jsx(ge,{scrollKey:n,status:r,items:y,icon:"ellipsis-h",iconComponent:ve,size:18,direction:"right",title:d.formatMessage(_.more)})})]})]})]})})},P=(s,n,a)=>{const t=s.querySelector(`article:nth-of-type(${n+1}) .focusable`);t&&(a&&s.scrollTop>t.offsetTop?t.scrollIntoView(!0):!a&&s.scrollTop+s.clientHeight<t.offsetTop+t.offsetHeight&&t.scrollIntoView(!1),t.focus())},Ee=({scrollKey:s,...n})=>{var M;const a=l.useRef(),t=b(c=>c.getIn(["conversations","items"])),o=b(c=>c.getIn(["conversations","isLoading"],!0)),u=b(c=>c.getIn(["conversations","hasMore"],!1)),f=T(),p=(M=t.last())==null?void 0:M.get("last_status"),d=l.useCallback(c=>{const j=t.findIndex(v=>v.get("id")===c)-1;P(a.current.node,j,!0)},[a,t]),i=l.useCallback(c=>{const j=t.findIndex(v=>v.get("id")===c)+1;P(a.current.node,j,!1)},[a,t]),h=l.useMemo(()=>de(c=>{f(A({maxId:c}))},300,{leading:!0}),[f]),r=l.useCallback(()=>{p&&h(p)},[h,p]);return e.jsx(Ce,{...n,scrollKey:s,isLoading:o,showLoading:o&&t.isEmpty(),hasMore:u,onLoadMore:r,ref:a,children:t.map(c=>e.jsx(Le,{conversation:c,onMoveUp:d,onMoveDown:i,scrollKey:s},c.get("id")))})},w=D({title:{id:"column.direct",defaultMessage:"Private mentions"}}),gt=({columnId:s,multiColumn:n})=>{const a=l.useRef(),t=q(),o=T(),u=!!s,f=l.useCallback(()=>{o(s?me(s):ue("DIRECT",{}))},[o,s]),p=l.useCallback(i=>{o(pe(s,i))},[o,s]),d=l.useCallback(()=>{a.current.scrollTop()},[a]);return l.useEffect(()=>{o(he()),o(A());const i=o(_e());return()=>{o(fe()),i()}},[o]),e.jsxs(Me,{bindToDocument:!n,ref:a,label:t.formatMessage(w.title),children:[e.jsx(je,{icon:"at",iconComponent:xe,title:t.formatMessage(w.title),onPin:f,onMove:p,onClick:d,pinned:u,multiColumn:n}),e.jsx(Ee,{trackScroll:!u,scrollKey:`direct_timeline-${s}`,emptyMessage:e.jsx(k,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."}),bindToDocument:!n,prepend:e.jsx("div",{className:"follow_requests-unlocked_explanation",children:e.jsxs("span",{children:[e.jsx(k,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",e.jsx("a",{href:"/terms",target:"_blank",children:e.jsx(k,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})})]})}),alwaysPrepend:!0}),e.jsxs(J,{children:[e.jsx("title",{children:t.formatMessage(w.title)}),e.jsx("meta",{name:"robots",content:"noindex"})]})]})};export{gt as default};
//# sourceMappingURL=direct_timeline-index-BFQaekXD.js.map
