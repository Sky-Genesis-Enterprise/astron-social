var q=Object.defineProperty;var U=(e,s,t)=>s in e?q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var C=(e,s,t)=>U(e,typeof s!="symbol"?s+"":s,t);import{j as n}from"./client-wT6vtYO_.js";import{r as L}from"./index-BdTwX--g.js";import{c as w}from"./index-DizoKcfL.js";import{a as Z,A as P,be as W,b4 as G,I as M,bf as X,b1 as $}from"./useSelectableClick-DeaJbL2_.js";import{L as J}from"./short_number-WomMu2iV.js";import{M as k}from"./message-UFwkQlnu.js";import{R as K}from"./index-CAH5FfLP.js";import{z as Q}from"./initial_state-BP3UcUr4.js";const Y="data:image/svg+xml,%3csvg%20width='65'%20height='65'%20viewBox='0%200%2061%2065'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M60.7539%2014.3904C59.8143%207.40642%2053.7273%201.90257%2046.5117%200.836066C45.2943%200.655854%2040.6819%200%2029.9973%200H29.9175C19.2299%200%2016.937%200.655854%2015.7196%200.836066C8.70488%201.87302%202.29885%206.81852%200.744617%2013.8852C-0.00294988%2017.3654%20-0.0827298%2021.2237%200.0561464%2024.7629C0.254119%2029.8384%200.292531%2034.905%200.753482%2039.9598C1.07215%2043.3175%201.62806%2046.6484%202.41704%2049.9276C3.89445%2055.9839%209.87499%2061.0239%2015.7344%2063.0801C22.0077%2065.2244%2028.7542%2065.5804%2035.2184%2064.1082C35.9295%2063.9428%2036.6318%2063.7508%2037.3252%2063.5321C38.8971%2063.0329%2040.738%2062.4745%2042.0913%2061.4937C42.1099%2061.4799%2042.1251%2061.4621%2042.1358%2061.4417C42.1466%2061.4212%2042.1526%2061.3986%2042.1534%2061.3755V56.4773C42.153%2056.4557%2042.1479%2056.4345%2042.1383%2056.4151C42.1287%2056.3958%2042.1149%2056.3788%2042.0979%2056.3655C42.0809%2056.3522%2042.0611%2056.3429%2042.04%2056.3382C42.019%2056.3335%2041.9971%2056.3336%2041.9761%2056.3384C37.8345%2057.3276%2033.5905%2057.8234%2029.3324%2057.8156C22.0045%2057.8156%2020.0336%2054.3384%2019.4693%2052.8908C19.0156%2051.6397%2018.7275%2050.3346%2018.6124%2049.0088C18.6112%2048.9866%2018.6153%2048.9643%2018.6243%2048.9439C18.6333%2048.9236%2018.647%2048.9056%2018.6643%2048.8915C18.6816%2048.8774%2018.7019%2048.8675%2018.7237%2048.8628C18.7455%2048.858%2018.7681%2048.8585%2018.7897%2048.8641C22.8622%2049.8465%2027.037%2050.3423%2031.2265%2050.3412C32.234%2050.3412%2033.2387%2050.3412%2034.2463%2050.3146C38.4598%2050.1964%2042.9009%2049.9808%2047.0465%2049.1713C47.1499%2049.1506%2047.2534%2049.1329%2047.342%2049.1063C53.881%2047.8507%2060.1038%2043.9097%2060.7362%2033.9301C60.7598%2033.5372%2060.8189%2029.8148%2060.8189%2029.4071C60.8218%2028.0215%2061.2651%2019.5781%2060.7539%2014.3904Z'%20fill='url(%23paint0_linear_89_8)'/%3e%3cpath%20d='M50.3943%2022.237V39.5876H43.5185V22.7481C43.5185%2019.2029%2042.0411%2017.3949%2039.036%2017.3949C35.7325%2017.3949%2034.0778%2019.5338%2034.0778%2023.7585V32.9759H27.2434V23.7585C27.2434%2019.5338%2025.5857%2017.3949%2022.2822%2017.3949C19.2949%2017.3949%2017.8027%2019.2029%2017.8027%2022.7481V39.5876H10.9298V22.237C10.9298%2018.6918%2011.835%2015.8754%2013.6453%2013.7877C15.5128%2011.7049%2017.9623%2010.6355%2021.0028%2010.6355C24.522%2010.6355%2027.1813%2011.9885%2028.9542%2014.6917L30.665%2017.5633L32.3788%2014.6917C34.1517%2011.9885%2036.811%2010.6355%2040.3243%2010.6355C43.3619%2010.6355%2045.8114%2011.7049%2047.6847%2013.7877C49.4931%2015.8734%2050.3963%2018.6899%2050.3943%2022.237Z'%20fill='white'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_89_8'%20x1='30.5'%20y1='0'%20x2='30.5'%20y2='65'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%236364FF'/%3e%3cstop%20offset='1'%20stop-color='%23563ACC'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Le=()=>n.jsxs("svg",{viewBox:"0 0 261 66",className:"logo logo--wordmark",role:"img",children:[n.jsx("title",{children:"Mastodon"}),n.jsx("use",{xlinkHref:"#logo-symbol-wordmark"})]}),ee=()=>n.jsxs("svg",{viewBox:"0 0 79 79",className:"logo logo--icon",role:"img",children:[n.jsx("title",{children:"Mastodon"}),n.jsx("use",{xlinkHref:"#logo-symbol-icon"})]}),Se=()=>n.jsx("img",{src:Y,alt:"Mastodon",className:"logo logo--icon"}),_=2147483647,p=36,S=1,j=26,te=38,se=700,R=72,B=128,H="-",ne=/^xn--/,oe=/[^\0-\x7F]/,ae=/[\x2E\u3002\uFF0E\uFF61]/g,ie={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=p-S,f=Math.floor,I=String.fromCharCode;function v(e){throw new RangeError(ie[e])}function re(e,s){const t=[];let o=e.length;for(;o--;)t[o]=s(e[o]);return t}function T(e,s){const t=e.split("@");let o="";t.length>1&&(o=t[0]+"@",e=t[1]),e=e.replace(ae,".");const a=e.split("."),r=re(a,s).join(".");return o+r}function D(e){const s=[];let t=0;const o=e.length;for(;t<o;){const a=e.charCodeAt(t++);if(a>=55296&&a<=56319&&t<o){const r=e.charCodeAt(t++);(r&64512)==56320?s.push(((a&1023)<<10)+(r&1023)+65536):(s.push(a),t--)}else s.push(a)}return s}const le=e=>String.fromCodePoint(...e),ce=function(e){return e>=48&&e<58?26+(e-48):e>=65&&e<91?e-65:e>=97&&e<123?e-97:p},A=function(e,s){return e+22+75*(e<26)-((s!=0)<<5)},V=function(e,s,t){let o=0;for(e=t?f(e/se):e>>1,e+=f(e/s);e>N*j>>1;o+=p)e=f(e/N);return f(o+(N+1)*e/(e+te))},z=function(e){const s=[],t=e.length;let o=0,a=B,r=R,h=e.lastIndexOf(H);h<0&&(h=0);for(let i=0;i<h;++i)e.charCodeAt(i)>=128&&v("not-basic"),s.push(e.charCodeAt(i));for(let i=h>0?h+1:0;i<t;){const l=o;for(let d=1,u=p;;u+=p){i>=t&&v("invalid-input");const c=ce(e.charCodeAt(i++));c>=p&&v("invalid-input"),c>f((_-o)/d)&&v("overflow"),o+=c*d;const g=u<=r?S:u>=r+j?j:u-r;if(c<g)break;const x=p-g;d>f(_/x)&&v("overflow"),d*=x}const m=s.length+1;r=V(o-l,m,l==0),f(o/m)>_-a&&v("overflow"),a+=f(o/m),o%=m,s.splice(o++,0,a)}return String.fromCodePoint(...s)},O=function(e){const s=[];e=D(e);const t=e.length;let o=B,a=0,r=R;for(const l of e)l<128&&s.push(I(l));const h=s.length;let i=h;for(h&&s.push(H);i<t;){let l=_;for(const d of e)d>=o&&d<l&&(l=d);const m=i+1;l-o>f((_-a)/m)&&v("overflow"),a+=(l-o)*m,o=l;for(const d of e)if(d<o&&++a>_&&v("overflow"),d===o){let u=a;for(let c=p;;c+=p){const g=c<=r?S:c>=r+j?j:c-r;if(u<g)break;const x=u-g,b=p-g;s.push(I(A(g+x%b,0))),u=f(x/b)}s.push(I(A(u,0))),r=V(a,m,i===h),a=0,++i}++a,++o}return s.join("")},de=function(e){return T(e,function(s){return ne.test(s)?z(s.slice(4).toLowerCase()):s})},ue=function(e){return T(e,function(s){return oe.test(s)?"xn--"+O(s):s})},he={version:"2.3.1",ucs2:{decode:D,encode:le},decode:z,encode:O,toASCII:ue,toUnicode:de},me=e=>L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...e},L.createElement("path",{d:"M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520h200L520-800v200Z"})),ge=({accountId:e})=>{const s=Z(t=>t.getIn(["accounts",e]));return s?n.jsxs(J,{to:`/@${s.get("acct")}`,className:"story__details__shared__author-link","data-hover-card-account":e,children:[n.jsx(P,{account:s,size:16}),n.jsx("bdi",{dangerouslySetInnerHTML:{__html:s.get("display_name_html")}})]}):null},pe=({accountId:e})=>n.jsx(k,{id:"link_preview.more_from_author",defaultMessage:"More from {name}",values:{name:n.jsx(ge,{accountId:e})},children:s=>n.jsxs("div",{className:"more-from-author",children:[n.jsx(ee,{}),s]})}),E="xn--",fe=e=>e.split(".").map(s=>s.indexOf(E)===0?he.decode(s.slice(E.length)):s).join("."),xe=e=>{const s=document.createElement("a");return s.href=e,s.hostname},ve=new DOMParser,Ce=e=>{const s=ve.parseFromString(e,"text/html").documentElement,t=s.querySelector("iframe");return t?(t.src.indexOf("?")!==-1?t.src+="&":t.src+="?",t.src+="autoplay=1&auto_play=1",s.querySelector("body").innerHTML):e};class Fe extends L.PureComponent{constructor(){super(...arguments);C(this,"state",{previewLoaded:!1,embedded:!1,revealed:!this.props.sensitive});C(this,"handleEmbedClick",()=>{this.setState({embedded:!0})});C(this,"handleExternalLinkClick",t=>{t.stopPropagation()});C(this,"setRef",t=>{this.node=t});C(this,"handleImageLoad",()=>{this.setState({previewLoaded:!0})});C(this,"handleReveal",t=>{t.preventDefault(),t.stopPropagation(),this.setState({revealed:!0})})}UNSAFE_componentWillReceiveProps(t){W(this.props.card,t.card)||this.setState({embedded:!1,previewLoaded:!1}),this.props.sensitive!==t.sensitive&&this.setState({revealed:!t.sensitive})}componentDidMount(){window.addEventListener("resize",this.handleResize,{passive:!0})}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}renderVideo(){const{card:t}=this.props,o={__html:Ce(t.get("html"))};return n.jsx("div",{ref:this.setRef,className:"status-card__image status-card-video",dangerouslySetInnerHTML:o,style:{aspectRatio:"16 / 9"}})}render(){var F;const{card:t}=this.props,{embedded:o,revealed:a}=this.state;if(t===null)return null;const r=t.get("provider_name").length===0?fe(xe(t.get("url"))):t.get("provider_name"),h=t.get("type")==="video",i=t.get("language")||"",l=((F=t.get("image"))==null?void 0:F.length)>0&&t.get("width")>t.get("height")||h,m=!!t.getIn(["authors",0,"accountId"]),d=n.jsxs("div",{className:"status-card__content",dir:"auto",children:[n.jsxs("span",{className:"status-card__host",children:[n.jsx("span",{lang:i,children:r}),t.get("published_at")&&n.jsxs(n.Fragment,{children:[" Â· ",n.jsx(K,{timestamp:t.get("published_at")})]})]}),n.jsx("strong",{className:"status-card__title",title:t.get("title"),lang:i,children:t.get("title")}),!m&&(t.get("author_name").length>0?n.jsx("span",{className:"status-card__author",children:n.jsx(k,{id:"link_preview.author",defaultMessage:"By {name}",values:{name:n.jsx("strong",{children:t.get("author_name")})}})}):n.jsx("span",{className:"status-card__description",lang:i,children:t.get("description")}))]}),u={visibility:a?null:"hidden"};l&&t.get("type")==="video"?u.aspectRatio="16 / 9":l?u.aspectRatio="1.91 / 1":u.aspectRatio=1;let c,g=n.jsx(G,{className:w("status-card__image-preview",{"status-card__image-preview--hidden":a&&this.state.previewLoaded}),hash:t.get("blurhash"),dummy:!Q});const x=t.get("image_description"),b=n.jsx("img",{src:t.get("image"),alt:x,title:x,lang:i,style:u,onLoad:this.handleImageLoad,className:"status-card__image-image"});let y=n.jsx("button",{type:"button",onClick:this.handleReveal,className:"spoiler-button__overlay",children:n.jsxs("span",{className:"spoiler-button__overlay__label",children:[n.jsx(k,{id:"status.sensitive_warning",defaultMessage:"Sensitive content"}),n.jsx("span",{className:"spoiler-button__overlay__action",children:n.jsx(k,{id:"status.media.show",defaultMessage:"Click to show"})})]})});return y=n.jsx("div",{className:w("spoiler-button",{"spoiler-button--minified":a}),children:y}),h?(o?c=this.renderVideo():c=n.jsxs("div",{className:"status-card__image",children:[g,b,a?n.jsx("div",{className:"status-card__actions",onClick:this.handleEmbedClick,role:"none",children:n.jsxs("div",{children:[n.jsx("button",{type:"button",onClick:this.handleEmbedClick,children:n.jsx(M,{id:"play",icon:X})}),n.jsx("a",{href:t.get("url"),onClick:this.handleExternalLinkClick,target:"_blank",rel:"noopener",children:n.jsx(M,{id:"external-link",icon:$})})]})}):y]}),n.jsxs("div",{className:w("status-card",{expanded:l}),ref:this.setRef,onClick:a?null:this.handleReveal,role:a?"button":null,children:[c,n.jsx("a",{href:t.get("url"),target:"_blank",rel:"noopener",children:d})]})):(t.get("image")?c=n.jsxs("div",{className:"status-card__image",children:[g,b]}):c=n.jsx("div",{className:"status-card__image",children:n.jsx(M,{id:"file-text",icon:me})}),n.jsxs(n.Fragment,{children:[n.jsxs("a",{href:t.get("url"),className:w("status-card",{expanded:l,bottomless:m}),target:"_blank",rel:"noopener",ref:this.setRef,children:[c,d]}),m&&n.jsx(pe,{accountId:t.getIn(["authors",0,"accountId"])})]}))}}export{ge as A,Fe as C,ee as I,Se as S,Le as W};
//# sourceMappingURL=card-CttmBekj.js.map
