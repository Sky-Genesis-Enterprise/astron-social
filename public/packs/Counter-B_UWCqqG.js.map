{"version":3,"file":"Counter-B_UWCqqG.js","sources":["../../app/javascript/mastodon/components/admin/Counter.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport { FormattedNumber } from 'react-intl';\n\nimport classNames from 'classnames';\n\nimport { Sparklines, SparklinesCurve } from 'react-sparklines';\n\nimport api from 'mastodon/api';\nimport { Skeleton } from 'mastodon/components/skeleton';\n\nconst percIncrease = (a, b) => {\n  let percent;\n\n  if (b !== 0) {\n    if (a !== 0) {\n      percent = (b - a) / a;\n    } else {\n      percent = 1;\n    }\n  } else if (b === 0 && a === 0) {\n    percent = 0;\n  } else {\n    percent = - 1;\n  }\n\n  return percent;\n};\n\nexport default class Counter extends PureComponent {\n\n  static propTypes = {\n    measure: PropTypes.string.isRequired,\n    start_at: PropTypes.string.isRequired,\n    end_at: PropTypes.string.isRequired,\n    label: PropTypes.string.isRequired,\n    href: PropTypes.string,\n    params: PropTypes.object,\n    target: PropTypes.string,\n  };\n\n  state = {\n    loading: true,\n    data: null,\n  };\n\n  componentDidMount () {\n    const { measure, start_at, end_at, params } = this.props;\n\n    api(false).post('/api/v1/admin/measures', { keys: [measure], start_at, end_at, [measure]: params }).then(res => {\n      this.setState({\n        loading: false,\n        data: res.data,\n      });\n    }).catch(err => {\n      console.error(err);\n    });\n  }\n\n  render () {\n    const { label, href, target } = this.props;\n    const { loading, data } = this.state;\n\n    let content;\n\n    if (loading) {\n      content = (\n        <>\n          <span className='sparkline__value__total'><Skeleton width={43} /></span>\n          <span className='sparkline__value__change'><Skeleton width={43} /></span>\n        </>\n      );\n    } else {\n      const measure = data[0];\n      const percentChange = measure.previous_total && percIncrease(measure.previous_total * 1, measure.total * 1);\n\n      content = (\n        <>\n          <span className='sparkline__value__total'>{measure.human_value || <FormattedNumber value={measure.total} />}</span>\n          {measure.previous_total && (<span className={classNames('sparkline__value__change', { positive: percentChange > 0, negative: percentChange < 0 })}>{percentChange > 0 && '+'}<FormattedNumber value={percentChange} style='percent' /></span>)}\n        </>\n      );\n    }\n\n    const inner = (\n      <>\n        <div className='sparkline__value'>\n          {content}\n        </div>\n\n        <div className='sparkline__label'>\n          {label}\n        </div>\n\n        <div className='sparkline__graph'>\n          {!loading && (\n            <Sparklines width={259} height={55} data={data[0].data.map(x => x.value * 1)}>\n              <SparklinesCurve />\n            </Sparklines>\n          )}\n        </div>\n      </>\n    );\n\n    if (href) {\n      return (\n        <a href={href} className='sparkline' target={target}>\n          {inner}\n        </a>\n      );\n    } else {\n      return (\n        <div className='sparkline'>\n          {inner}\n        </div>\n      );\n    }\n  }\n\n}\n"],"names":["percIncrease","a","b","percent","Counter","PureComponent","state","loading","data","componentDidMount","measure","start_at","end_at","params","props","api","post","keys","then","res","setState","catch","err","console","error","render","label","href","target","content","jsxs","Fragment","jsx","Skeleton","percentChange","previous_total","total","human_value","FormattedNumber","classNames","positive","negative","inner","Sparklines","map","x","value","SparklinesCurve"],"mappings":"yfAYA,MAAMA,EAAeA,CAACC,EAAGC,IAAM,CAC7B,IAAIC,EAEJ,OAAID,IAAM,EACJD,IAAM,EACRE,GAAWD,EAAID,GAAKA,EAEpBE,EAAU,EAEHD,IAAM,GAAKD,IAAM,EAC1BE,EAAU,EAEVA,EAAU,GAGLA,CACT,EAEA,MAAqBC,UAAgBC,EAAAA,aAAc,CAAnD,kCAYEC,EAAAA,aAAQ,CACNC,QAAS,GACTC,KAAM,IAAA,GAGRC,mBAAqB,CACnB,KAAM,CAAEC,QAAAA,EAASC,SAAAA,EAAUC,OAAAA,EAAQC,OAAAA,CAAAA,EAAW,KAAKC,MAEnDC,EAAI,EAAK,EAAEC,KAAK,yBAA0B,CAAEC,KAAM,CAACP,CAAO,EAAGC,SAAAA,EAAUC,OAAAA,EAAQ,CAACF,CAAO,EAAGG,CAAAA,CAAQ,EAAEK,KAAKC,GAAO,CAC9G,KAAKC,SAAS,CACZb,QAAS,GACTC,KAAMW,EAAIX,IAAAA,CACX,CAAA,CACF,EAAEa,MAAMC,GAAO,CACdC,QAAQC,MAAMF,CAAG,CAAA,CAClB,CAAA,CAGHG,QAAU,CACR,KAAM,CAAEC,MAAAA,EAAOC,KAAAA,EAAMC,OAAAA,CAAAA,EAAW,KAAKd,MAC/B,CAAEP,QAAAA,EAASC,KAAAA,CAAAA,EAAS,KAAKF,MAE/B,IAAIuB,EAEJ,GAAItB,EACFsB,EACEC,EAAAA,KAAAC,WAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,QAAK,UAAU,0BAA0B,eAACC,EAAA,CAAS,MAAO,GAAG,CAAA,CAAG,EACjED,EAAAA,IAAC,QAAK,UAAU,2BAA2B,eAACC,EAAA,CAAS,MAAO,GAAG,CAAA,CAAG,CAAA,EACpE,MAEG,CACL,MAAMvB,EAAUF,EAAK,CAAC,EAChB0B,EAAgBxB,EAAQyB,gBAAkBnC,EAAaU,EAAQyB,eAAiB,EAAGzB,EAAQ0B,MAAQ,CAAC,EAE1GP,EACEC,EAAAA,KAAAC,WAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,0BAA2BtB,SAAAA,EAAQ2B,mBAAgBC,EAAA,CAAgB,MAAO5B,EAAQ0B,KAAAA,CAAM,CAAA,CAAI,EAC3G1B,EAAQyB,gBAAmBL,OAAC,OAAA,CAAK,UAAWS,EAAW,2BAA4B,CAAEC,SAAUN,EAAgB,EAAGO,SAAUP,EAAgB,CAAA,CAAG,EAAIA,SAAAA,CAAAA,EAAgB,GAAK,IAAIF,EAAAA,IAACM,EAAA,CAAgB,MAAOJ,EAAe,MAAM,SAAA,CAAS,CAAA,CAAA,CAAG,CAAA,EACxO,CAAA,CAIJ,MAAMQ,EACJZ,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACZH,SAAAA,EACH,EAEAG,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACZN,SAAAA,EACH,EAEAM,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACZ,SAAA,CAACzB,GACAyB,EAAAA,IAACW,EAAAA,WAAA,CAAW,MAAO,IAAK,OAAQ,GAAI,KAAMnC,EAAK,CAAC,EAAEA,KAAKoC,IAAIC,GAAKA,EAAEC,MAAQ,CAAC,EACzE,SAAAd,EAAAA,IAACe,EAAAA,gBAAA,CAAA,CAAe,CAAA,CAClB,CAAA,CAEJ,CAAA,EACF,EAGF,OAAIpB,QAEC,IAAA,CAAE,KAAAA,EAAY,UAAU,YAAY,OAAAC,EAClCc,SAAAA,EACH,EAIAV,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZU,SAAAA,EACH,CAEJ,CAGJ"}