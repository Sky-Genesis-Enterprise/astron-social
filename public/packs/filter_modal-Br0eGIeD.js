var j=Object.defineProperty;var N=(r,o,e)=>o in r?j(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var i=(r,o,e)=>N(r,typeof o!="symbol"?o+"":o,e);import{j as t}from"./client-wT6vtYO_.js";import{P as c}from"./short_number-WomMu2iV.js";import{r as u,i as g,d as _}from"./index-BdTwX--g.js";import{j as m,I as b,y as S,a2 as y,dV as C,dW as v,dX as F,b as M}from"./useSelectableClick-DeaJbL2_.js";import{S as k}from"./close-BsPe8EbX.js";import{B as I}from"./index-BZWHsOPk.js";import{ap as f}from"./content_warning-DZ8mar1O.js";import{M as l}from"./message-UFwkQlnu.js";import{f as D}from"./fuzzysort-BUgAtj0X.js";import{S as T}from"./add-D8GR9P00.js";import"./numbers-CGZQWBYL.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./initial_state-BP3UcUr4.js";import"./ready-DpOgoWSg.js";import"./index-CAH5FfLP.js";import"./load_locale-tOpKhmcM.js";import"./index-DizoKcfL.js";import"./skeleton-D9NbTYr9.js";const A=(r,{filterId:o})=>({filter:r.getIn(["filters",o])});class K extends u.PureComponent{constructor(){super(...arguments);i(this,"handleCloseClick",()=>{const{onClose:e}=this.props;e()})}render(){const{filter:e,contextType:s}=this.props;let a=null;e.get("expires_at")&&e.get("expires_at")<new Date&&(a=t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"report-dialog-modal__subtitle",children:t.jsx(l,{id:"filter_modal.added.expired_title",defaultMessage:"Expired filter!"})}),t.jsx("p",{className:"report-dialog-modal__lead",children:t.jsx(l,{id:"filter_modal.added.expired_explanation",defaultMessage:"This filter category has expired, you will need to change the expiration date for it to apply."})})]}));let d=null;s&&!e.get("context").includes(f(s))&&(d=t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"report-dialog-modal__subtitle",children:t.jsx(l,{id:"filter_modal.added.context_mismatch_title",defaultMessage:"Context mismatch!"})}),t.jsx("p",{className:"report-dialog-modal__lead",children:t.jsx(l,{id:"filter_modal.added.context_mismatch_explanation",defaultMessage:"This filter category does not apply to the context in which you have accessed this post. If you want the post to be filtered in this context too, you will have to edit the filter."})})]}));const h=t.jsx("a",{href:`/filters/${e.get("id")}/edit`,children:t.jsx(l,{id:"filter_modal.added.settings_link",defaultMessage:"settings page"})});return t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"report-dialog-modal__title",children:t.jsx(l,{id:"filter_modal.added.title",defaultMessage:"Filter added!"})}),t.jsx("p",{className:"report-dialog-modal__lead",children:t.jsx(l,{id:"filter_modal.added.short_explanation",defaultMessage:"This post has been added to the following filter category: {title}.",values:{title:e.get("title")}})}),a,d,t.jsx("h4",{className:"report-dialog-modal__subtitle",children:t.jsx(l,{id:"filter_modal.added.review_and_configure_title",defaultMessage:"Filter settings"})}),t.jsx("p",{className:"report-dialog-modal__lead",children:t.jsx(l,{id:"filter_modal.added.review_and_configure",defaultMessage:"To review and further configure this filter category, go to the {settings_link}.",values:{settings_link:h}})}),t.jsx("div",{className:"flex-spacer"}),t.jsx("div",{className:"report-dialog-modal__actions",children:t.jsx(I,{onClick:this.handleCloseClick,children:t.jsx(l,{id:"report.close",defaultMessage:"Done"})})})]})}}const P=m(A)(K),z=t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13",children:t.jsx("path",{d:"M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"})}),V=t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",width:"13",height:"13",children:t.jsx("path",{d:"M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"})}),p=_({search:{id:"filter_modal.select_filter.search",defaultMessage:"Search or create"},clear:{id:"emoji_button.clear",defaultMessage:"Clear"}}),L=(r,{contextType:o})=>({filters:Array.from(r.get("filters").values()).map(e=>{var s;return[e.get("id"),e.get("title"),(s=e.get("keywords"))==null?void 0:s.map(a=>a.get("keyword")).join(`
`),e.get("expires_at")&&e.get("expires_at")<new Date,o&&!e.get("context").includes(f(o))]})});class R extends u.PureComponent{constructor(){super(...arguments);i(this,"state",{searchValue:""});i(this,"renderItem",e=>{let s=null;return(e[3]||e[4])&&(s=t.jsxs("span",{className:"language-dropdown__dropdown__results__item__common-name",children:["(",e[3]&&t.jsx(l,{id:"filter_modal.select_filter.expired",defaultMessage:"expired"}),e[3]&&e[4]&&", ",e[4]&&t.jsx(l,{id:"filter_modal.select_filter.context_mismatch",defaultMessage:"does not apply to this context"}),")"]})),t.jsxs("div",{role:"button",tabIndex:0,"data-index":e[0],className:"language-dropdown__dropdown__results__item",onClick:this.handleItemClick,onKeyDown:this.handleKeyDown,children:[t.jsx("span",{className:"language-dropdown__dropdown__results__item__native-name",children:e[1]})," ",s]},e[0])});i(this,"handleSearchChange",({target:e})=>{this.setState({searchValue:e.value})});i(this,"setListRef",e=>{this.listNode=e});i(this,"handleKeyDown",e=>{const s=Array.from(this.listNode.childNodes).findIndex(d=>d===e.currentTarget);let a=null;switch(e.key){case" ":case"Enter":e.currentTarget.click();break;case"ArrowDown":a=this.listNode.childNodes[s+1]||this.listNode.firstChild;break;case"ArrowUp":a=this.listNode.childNodes[s-1]||this.listNode.lastChild;break;case"Tab":e.shiftKey?a=this.listNode.childNodes[s-1]||this.listNode.lastChild:a=this.listNode.childNodes[s+1]||this.listNode.firstChild;break;case"Home":a=this.listNode.firstChild;break;case"End":a=this.listNode.lastChild;break}a&&(a.focus(),e.preventDefault(),e.stopPropagation())});i(this,"handleSearchKeyDown",e=>{let s=null;switch(e.key){case"Tab":case"ArrowDown":s=this.listNode.firstChild,s&&(s.focus(),e.preventDefault(),e.stopPropagation());break}});i(this,"handleClear",()=>{this.setState({searchValue:""})});i(this,"handleItemClick",e=>{const s=e.currentTarget.getAttribute("data-index");e.preventDefault(),this.props.onSelectFilter(s)});i(this,"handleNewFilterClick",e=>{e.preventDefault(),this.props.onNewFilter(this.state.searchValue)})}search(){const{filters:e}=this.props,{searchValue:s}=this.state;return s===""?e:D.go(s,e,{keys:["1","2"],limit:5,threshold:-1e4}).map(a=>a.obj)}renderCreateNew(e){return t.jsxs("div",{role:"button",tabIndex:0,className:"language-dropdown__dropdown__results__item",onClick:this.handleNewFilterClick,onKeyDown:this.handleKeyDown,children:[t.jsx(b,{id:"plus",icon:T})," ",t.jsx(l,{id:"filter_modal.select_filter.prompt_new",defaultMessage:"New category: {name}",values:{name:e}})]},"add-new-filter")}render(){const{intl:e}=this.props,{searchValue:s}=this.state,a=s!=="",d=this.search();return t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"report-dialog-modal__title",children:t.jsx(l,{id:"filter_modal.select_filter.title",defaultMessage:"Filter this post"})}),t.jsx("p",{className:"report-dialog-modal__lead",children:t.jsx(l,{id:"filter_modal.select_filter.subtitle",defaultMessage:"Use an existing category or create a new one"})}),t.jsxs("div",{className:"emoji-mart-search",children:[t.jsx("input",{type:"search",value:s,onChange:this.handleSearchChange,onKeyDown:this.handleSearchKeyDown,placeholder:e.formatMessage(p.search),autoFocus:!0}),t.jsx("button",{type:"button",className:"emoji-mart-search-icon",disabled:!a,"aria-label":e.formatMessage(p.clear),onClick:this.handleClear,children:a?V:z})]}),t.jsxs("div",{className:"language-dropdown__dropdown__results emoji-mart-scroll",role:"listbox",ref:this.setListRef,children:[d.map(this.renderItem),a&&this.renderCreateNew(s)]})]})}}const B=m(L)(g(R)),E=_({close:{id:"lightbox.close",defaultMessage:"Close"}});class x extends S{constructor(){super(...arguments);i(this,"state",{step:"select",filterId:null,isSubmitting:!1,isSubmitted:!1});i(this,"handleNewFilterSuccess",e=>{this.handleSelectFilter(e.id)});i(this,"handleSuccess",()=>{const{dispatch:e,statusId:s}=this.props;e(y(s,!0)),this.setState({isSubmitting:!1,isSubmitted:!0,step:"submitted"})});i(this,"handleFail",()=>{this.setState({isSubmitting:!1})});i(this,"handleNextStep",e=>{this.setState({step:e})});i(this,"handleSelectFilter",e=>{const{dispatch:s,statusId:a}=this.props;this.setState({isSubmitting:!0,filterId:e}),s(C({filter_id:e,status_id:a},this.handleSuccess,this.handleFail))});i(this,"handleNewFilter",e=>{const{dispatch:s}=this.props;this.setState({isSubmitting:!0}),s(v({title:e,context:["home","notifications","public","thread","account"],action:"warn"},this.handleNewFilterSuccess,this.handleFail))})}componentDidMount(){const{dispatch:e}=this.props;e(F())}render(){const{intl:e,statusId:s,contextType:a,onClose:d}=this.props,{step:h,filterId:w}=this.state;let n;switch(h){case"select":n=t.jsx(B,{contextType:a,onSelectFilter:this.handleSelectFilter,onNewFilter:this.handleNewFilter});break;case"create":n=null;break;case"submitted":n=t.jsx(P,{contextType:a,filterId:w,statusId:s,onClose:d})}return t.jsxs("div",{className:"modal-root__modal report-dialog-modal",children:[t.jsxs("div",{className:"report-modal__target",children:[t.jsx(M,{className:"report-modal__close",title:e.formatMessage(E.close),icon:"times",iconComponent:k,onClick:d,size:20}),t.jsx(l,{id:"filter_modal.title.status",defaultMessage:"Filter a post"})]}),t.jsx("div",{className:"report-dialog-modal__container",children:n})]})}}i(x,"propTypes",{statusId:c.string.isRequired,contextType:c.string,dispatch:c.func.isRequired,intl:c.object.isRequired});const de=m()(g(x));export{de as default};
//# sourceMappingURL=filter_modal-Br0eGIeD.js.map
