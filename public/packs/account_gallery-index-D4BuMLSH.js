import{j as t}from"./client-wT6vtYO_.js";import{r as l}from"./index-BdTwX--g.js";import{a as j,b4 as V,I as A,bZ as F,u as G,an as O,bX as C,dj as k,o as N}from"./useSelectableClick-DeaJbL2_.js";import{C as U,A as z,L as K}from"./limited_account_hint-Dq-fgEQD.js";import{R as S}from"./remote_hint-C4PyUXsc.js";import{S as R}from"./scrollable_list-lNykmhKA.js";import{B as Z}from"./bundle_column_error-Cn2E6aKL.js";import{C as X}from"./column-Cq3LGCyF.js";import{u as Y,a as J}from"./useAccountVisibility-CCmtTdvD.js";import{c as B}from"./index-DizoKcfL.js";import{S as Q}from"./visibility_off-CFNdrvj5.js";import{A as W}from"./alt_text_badge-CwO3PXb3.js";import{y as P,z as ee,l as te}from"./initial_state-BP3UcUr4.js";import{M as q}from"./message-UFwkQlnu.js";import"./short_number-WomMu2iV.js";import"./numbers-CGZQWBYL.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./index-CAH5FfLP.js";import"./load_locale-tOpKhmcM.js";import"./column_header-FN7GyEAs.js";import"./add-D8GR9P00.js";import"./chevron_left-CnYIoVsW.js";import"./close-BsPe8EbX.js";import"./Helmet-ZVWnGmbg.js";import"./content_warning-DZ8mar1O.js";import"./skeleton-D9NbTYr9.js";import"./notifications-CKA6ESoP.js";import"./notifications_active-fill-Bd5B72X1.js";import"./domain_blocks-CYnp0hav.js";import"./reports-DBOcsYZF.js";import"./group-Xgbn5g1L.js";import"./person-DcoiY4fW.js";import"./index-BZWHsOPk.js";import"./content_copy-CD6CbhEl.js";import"./counters-BJ0cOeaq.js";import"./follow_button-BdqDKUmA.js";import"./loading_indicator-7xMB1U6D.js";import"./formatted_date-jZOhBAMt.js";import"./react-textarea-autosize.browser.esm-GiEI5riT.js";import"./use-isomorphic-layout-effect.browser.esm-D-sFEUJ5.js";import"./permissions-Djze7cmB.js";import"./avatar_group-PUipFlog.js";import"./avatar_overlay-BeG39OK4.js";import"./timeline_hint-0fHjsenK.js";import"./scroll_container-Bq73vRM7.js";import"./react-router-scroll-4.es-CU7ja20b.js";import"./interopRequireDefault-CdiRfGvq.js";import"./schedule_idle_task-Co3Ydhdu.js";import"./load_more-qGthrhsi.js";import"./column-B4vwzadM.js";import"./scroll-BygYx8ga.js";import"./gif-BtN1axMk.js";const se=s=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...s},l.createElement("path",{d:"M360-120H200q-33 0-56.5-23.5T120-200v-280q0-75 28.5-140.5t77-114q48.5-48.5 114-77T480-840q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480v280q0 33-23.5 56.5T760-120H600v-320h160v-40q0-117-81.5-198.5T480-760q-117 0-198.5 81.5T200-480v40h160v320Z"})),ae=s=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,...s},l.createElement("path",{d:"m160-800 80 160h120l-80-160h80l80 160h120l-80-160h80l80 160h120l-80-160h120q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800Z"})),oe=({attachment:s,onOpenMedia:i})=>{const e=j(o=>o.accounts.get(s.getIn(["status","account"]))),[r,d]=l.useState(P!=="hide_all"&&!s.getIn(["status","sensitive"])||P==="show_all"),[g,T]=l.useState(!1),[I,_]=l.useState(!1),p=l.useCallback(()=>{T(!0)},[T]),f=l.useCallback(()=>{_(!0)},[_]),y=l.useCallback(o=>{o.target instanceof HTMLVideoElement&&o.target.play()},[]),E=l.useCallback(o=>{o.target instanceof HTMLVideoElement&&(o.target.pause(),o.target.currentTime=0)},[]),w=l.useCallback(o=>{o.button===0&&!(o.ctrlKey||o.metaKey)&&(o.preventDefault(),r?i(s):d(!0))},[s,r,i,d]),n=s.get("status"),m=s.getIn(["translation","description"])||s.get("description"),v=s.get("preview_url"),a=s.get("url"),h=e==null?void 0:e.avatar_static,c=n.get("language"),M=s.get("blurhash"),L=n.get("id"),u=s.get("type");let x;const b=[];if(m&&m.length>0&&b.push(t.jsx(W,{description:m},"alt")),!r)x=t.jsx("div",{className:"media-gallery__item__overlay",children:t.jsx(A,{id:"eye-slash",icon:Q})});else if(u==="audio")x=t.jsxs(t.Fragment,{children:[t.jsx("img",{src:v||h,alt:m,lang:c,onLoad:p,onError:f}),t.jsx("div",{className:"media-gallery__item__overlay media-gallery__item__overlay--corner",children:t.jsx(A,{id:"music",icon:se})})]});else if(u==="image"){const o=s.getIn(["meta","focus","x"])||0,H=s.getIn(["meta","focus","y"])||0,D=(o/2+.5)*100,$=(H/-2+.5)*100;x=t.jsx("img",{src:v,alt:m,lang:c,style:{objectPosition:`${D}% ${$}%`},onLoad:p,onError:f})}else if(["video","gifv"].includes(u)){const o=s.getIn(["meta","original","duration"]);x=t.jsxs("div",{className:"media-gallery__gifv",children:[t.jsx("video",{className:"media-gallery__item-gifv-thumbnail","aria-label":m,lang:c,src:a,onMouseEnter:y,onMouseLeave:E,onLoadedData:p,autoPlay:te,playsInline:!0,loop:!0,muted:!0}),u==="video"&&t.jsx("div",{className:"media-gallery__item__overlay media-gallery__item__overlay--corner",children:t.jsx(A,{id:"play",icon:ae})})]}),u==="gifv"?b.push(t.jsx("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:"GIF"},"gif")):b.push(t.jsx("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:F(Math.floor(o))},"video"))}return t.jsxs("div",{className:B("media-gallery__item media-gallery__item--square",{"media-gallery__item--error":I}),children:[t.jsx(V,{hash:M,className:B("media-gallery__preview",{"media-gallery__preview--hidden":r&&g}),dummy:!ee}),t.jsx("a",{className:"media-gallery__item-thumbnail",href:`/@${e==null?void 0:e.acct}/${L}`,onClick:w,target:"_blank",rel:"noopener noreferrer",children:x}),b.length>0&&t.jsx("div",{className:"media-gallery__item__badges",children:b})]})},ie=O([(s,i)=>s.timelines.getIn([`account:${i}:media`,"items"],C()),s=>s.statuses],(s,i)=>{let e=C();return s.forEach(r=>{const d=i.get(r);d&&(e=e.concat(d.get("media_attachments").map(g=>g.set("status",d))))}),e}),lt=({multiColumn:s})=>{var v;const i=G(),e=Y(),r=j(a=>e?ie(a,e):C()),d=j(a=>a.timelines.getIn([`account:${e}:media`,"isLoading"])),g=j(a=>a.timelines.getIn([`account:${e}:media`,"hasMore"])),I=!!j(a=>e?a.accounts.get(e):void 0),{suspended:_,blockedBy:p,hidden:f}=J(e),y=(v=r.last())==null?void 0:v.getIn(["status","id"]);l.useEffect(()=>{e&&I&&i(k(e))},[i,e,I]);const E=l.useCallback(()=>{y&&i(k(e,{maxId:y}))},[i,e,y]),w=l.useCallback(a=>{const h=a.getIn(["status","id"]),c=a.getIn(["status","language"]);if(a.get("type")==="video")i(N({modalType:"VIDEO",modalProps:{media:a,statusId:h,lang:c,options:{autoPlay:!0}}}));else if(a.get("type")==="audio")i(N({modalType:"AUDIO",modalProps:{media:a,statusId:h,lang:c,options:{autoPlay:!0}}}));else{const M=a.getIn(["status","media_attachments"]),L=M.findIndex(u=>u.get("id")===a.get("id"));i(N({modalType:"MEDIA",modalProps:{media:M,index:L,statusId:h,lang:c}}))}},[i]);if(e===null)return t.jsx(Z,{multiColumn:s,errorType:"routing"});let n;e&&(_?n=t.jsx(q,{id:"empty_column.account_suspended",defaultMessage:"Account suspended"}):f?n=t.jsx(K,{accountId:e}):p?n=t.jsx(q,{id:"empty_column.account_unavailable",defaultMessage:"Profile unavailable"}):r.isEmpty()?n=t.jsx(S,{accountId:e}):n=t.jsx(q,{id:"empty_column.account_timeline",defaultMessage:"No posts found"}));const m=_||p||f;return t.jsxs(X,{children:[t.jsx(U,{}),t.jsx(R,{className:"account-gallery__container",prepend:e&&t.jsx(z,{accountId:e,hideTabs:m}),alwaysPrepend:!0,append:e&&t.jsx(S,{accountId:e}),scrollKey:"account_gallery",isLoading:d,hasMore:!m&&g,onLoadMore:E,emptyMessage:n,bindToDocument:!s,children:r.map(a=>t.jsx(oe,{attachment:a,onOpenMedia:w},a.get("id")))})]})};export{lt as AccountGallery,lt as default};
//# sourceMappingURL=account_gallery-index-D4BuMLSH.js.map
