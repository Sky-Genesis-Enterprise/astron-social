var P=Object.defineProperty;var T=(h,l,e)=>l in h?P(h,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[l]=e;var t=(h,l,e)=>T(h,typeof l!="symbol"?l+"":l,e);import{j as i}from"./client-wT6vtYO_.js";import{r as N}from"./index-BdTwX--g.js";import{c as v}from"./index-DizoKcfL.js";import{be as z,H as R,bY as $,b4 as k,bZ as F}from"./useSelectableClick-DeaJbL2_.js";import{A}from"./alt_text_badge-CwO3PXb3.js";import{y as f,l as D,z as M}from"./initial_state-BP3UcUr4.js";import{M as B}from"./message-UFwkQlnu.js";import"./short_number-WomMu2iV.js";import"./numbers-CGZQWBYL.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./index-CAH5FfLP.js";import"./load_locale-tOpKhmcM.js";class b extends N.PureComponent{constructor(){super(...arguments);t(this,"state",{loaded:!1,error:!1});t(this,"handleMouseEnter",e=>{this.hoverToPlay()&&e.target.play()});t(this,"handleMouseLeave",e=>{this.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0)});t(this,"handleClick",e=>{const{index:o,onClick:g}=this.props;e.button===0&&!(e.ctrlKey||e.metaKey)&&(this.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0),e.preventDefault(),g(o)),e.stopPropagation()});t(this,"handleImageLoad",()=>{this.setState({loaded:!0})});t(this,"handleImageError",()=>{this.setState({error:!0})})}getAutoPlay(){return this.props.autoplay||D}hoverToPlay(){const{attachment:e}=this.props;return!this.getAutoPlay()&&["gifv","video"].includes(e.get("type"))}render(){const{attachment:e,lang:o,index:g,size:u,standalone:_,displayWidth:y,visible:r}=this.props;let n=[],m,d=50,p=100;u===1&&(d=100),(u===4||u===3&&g>0)&&(p=50);const s=e.getIn(["translation","description"])||e.get("description");if((s==null?void 0:s.length)>0&&n.push(i.jsx(A,{description:s},"alt")),e.get("type")==="unknown")return i.jsx("div",{className:v("media-gallery__item",{standalone:_,"media-gallery__item--tall":p===100,"media-gallery__item--wide":d===100}),children:i.jsx("a",{className:"media-gallery__item-thumbnail",href:e.get("remote_url")||e.get("url"),style:{cursor:"pointer"},title:s,lang:o,target:"_blank",rel:"noopener",children:i.jsx(k,{hash:e.get("blurhash"),className:"media-gallery__preview",dummy:!M})})},e.get("id"));if(e.get("type")==="image"){const a=e.get("preview_url"),c=e.getIn(["meta","small","width"]),x=e.get("url"),w=e.getIn(["meta","original","width"]),j=typeof w=="number"&&typeof c=="number",C=j?`${x} ${w}w, ${a} ${c}w`:null,I=j&&y>0?`${y*(d/100)}px`:null,E=e.getIn(["meta","focus","x"])||0,S=e.getIn(["meta","focus","y"])||0,W=(E/2+.5)*100,L=(S/-2+.5)*100;m=i.jsx("a",{className:"media-gallery__item-thumbnail",href:e.get("remote_url")||x,onClick:this.handleClick,target:"_blank",rel:"noopener",children:i.jsx("img",{src:a,srcSet:C,sizes:I,alt:s,lang:o,style:{objectPosition:`${W}% ${L}%`},onLoad:this.handleImageLoad,onError:this.handleImageError})})}else if(["gifv","video"].includes(e.get("type"))){const a=this.getAutoPlay(),c=e.getIn(["meta","original","duration"]);e.get("type")==="gifv"?n.push(i.jsx("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:"GIF"},"gif")):n.push(i.jsx("span",{className:"media-gallery__alt__label media-gallery__alt__label--non-interactive",children:F(Math.floor(c))},"video")),m=i.jsx("div",{className:v("media-gallery__gifv",{autoplay:a}),children:i.jsx("video",{className:"media-gallery__item-gifv-thumbnail","aria-label":s,lang:o,role:"application",src:e.get("url"),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onLoadedData:this.handleImageLoad,autoPlay:a,playsInline:!0,loop:!0,muted:!0})})}return i.jsxs("div",{className:v("media-gallery__item",{standalone:_,"media-gallery__item--error":this.state.error,"media-gallery__item--tall":p===100,"media-gallery__item--wide":d===100}),children:[i.jsx(k,{hash:e.get("blurhash"),dummy:!M,className:v("media-gallery__preview",{"media-gallery__preview--hidden":r&&this.state.loaded})}),r&&m,r&&n&&i.jsx("div",{className:"media-gallery__item__badges",children:n})]},e.get("id"))}}t(b,"defaultProps",{standalone:!1,index:0,size:1});class se extends N.PureComponent{constructor(){super(...arguments);t(this,"state",{visible:this.props.visible!==void 0?this.props.visible:f!=="hide_all"&&!this.props.sensitive||f==="show_all",width:this.props.defaultWidth});t(this,"handleResize",R(()=>{this.node&&this._setDimensions()},250,{trailing:!0}));t(this,"handleOpen",()=>{this.props.onToggleVisibility?this.props.onToggleVisibility():this.setState({visible:!this.state.visible})});t(this,"handleClick",e=>{this.props.onOpenMedia(this.props.media,e,this.props.lang)});t(this,"handleRef",e=>{this.node=e,this.node&&this._setDimensions()})}componentDidMount(){window.addEventListener("resize",this.handleResize,{passive:!0})}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}UNSAFE_componentWillReceiveProps(e){!z(e.media,this.props.media)&&e.visible===void 0?this.setState({visible:f!=="hide_all"&&!e.sensitive||f==="show_all"}):!z(e.visible,this.props.visible)&&e.visible!==void 0&&this.setState({visible:e.visible})}_setDimensions(){const e=this.node.offsetWidth;this.props.cacheWidth&&this.props.cacheWidth(e),this.setState({width:e})}isFullSizeEligible(){const{media:e}=this.props;return e.size===1&&e.getIn([0,"meta","small","aspect"])}render(){const{media:e,lang:o,sensitive:g,defaultWidth:u,autoplay:_,matchedFilters:y}=this.props,{visible:r}=this.state,n=this.state.width||u;let m;const d={};this.isFullSizeEligible()?d.aspectRatio=`${this.props.media.getIn([0,"meta","small","aspect"])}`:d.aspectRatio="3 / 2";const p=e.size,s=e.every(a=>a.get("type")==="unknown");return this.isFullSizeEligible()?m=i.jsx(b,{standalone:!0,autoplay:_,onClick:this.handleClick,attachment:e.get(0),lang:o,displayWidth:n,visible:r}):m=e.map((a,c)=>i.jsx(b,{autoplay:_,onClick:this.handleClick,attachment:a,index:c,lang:o,size:p,displayWidth:n,visible:r||s},a.get("id"))),i.jsxs("div",{className:`media-gallery media-gallery--layout-${p}`,style:d,ref:this.handleRef,children:[m,(!r||s)&&i.jsx($,{uncached:s,sensitive:g,onClick:this.handleOpen,matchedFilters:y}),r&&!s&&i.jsx("div",{className:"media-gallery__actions",children:i.jsx("button",{className:"media-gallery__actions__pill",onClick:this.handleOpen,children:i.jsx(B,{id:"media_gallery.hide",defaultMessage:"Hide"})})})]})}}export{se as default};
//# sourceMappingURL=media_gallery-DTAKF-fT.js.map
