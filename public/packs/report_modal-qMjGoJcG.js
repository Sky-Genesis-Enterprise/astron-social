var F=Object.defineProperty;var B=(o,i,t)=>i in o?F(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var n=(o,i,t)=>B(o,typeof i!="symbol"?i+"":i,t);import{j as e}from"./client-wT6vtYO_.js";import{P as S}from"./short_number-WomMu2iV.js";import{i as P,r as p,d as I,u as z}from"./index-BdTwX--g.js";import{j,bX as D,u as E,a as A,an as L,dE as x,f as q,dF as Y,A as K,ah as U,bL as O,bI as W,y as G,z as V,de as H,e as X,b as J}from"./useSelectableClick-DeaJbL2_.js";import{S as Q}from"./close-BsPe8EbX.js";import{s as Z}from"./reports-DBOcsYZF.js";import{B as m}from"./index-BZWHsOPk.js";import{O as T}from"./option-D2m0pPLV.js";import{M as l}from"./message-UFwkQlnu.js";import{T as ee}from"./index-Dk6IJ02w.js";import{L as te}from"./loading_indicator-7xMB1U6D.js";import{m as se}from"./index-OwtqmxAM.js";import{D as ae,ak as oe}from"./content_warning-DZ8mar1O.js";import{M as le}from"./media_attachments-DPEx4Q1o.js";import{R as ie}from"./index-CAH5FfLP.js";import{S as re}from"./status_content-CaIN8-0B.js";import{V as ne}from"./visibility_icon-DbVVvHFb.js";import"./initial_state-BP3UcUr4.js";import"./numbers-CGZQWBYL.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./load_locale-tOpKhmcM.js";import"./index-DizoKcfL.js";import"./done-illPsXew.js";import"./skeleton-D9NbTYr9.js";import"./poll-CjurB963.js";const N=I({dislike:{id:"report.reasons.dislike",defaultMessage:"I don't like it"},dislike_description:{id:"report.reasons.dislike_description",defaultMessage:"It is not something you want to see"},spam:{id:"report.reasons.spam",defaultMessage:"It's spam"},spam_description:{id:"report.reasons.spam_description",defaultMessage:"Malicious links, fake engagement, or repetitive replies"},legal:{id:"report.reasons.legal",defaultMessage:"It's illegal"},legal_description:{id:"report.reasons.legal_description",defaultMessage:"You believe it violates the law of your or the server's country"},violation:{id:"report.reasons.violation",defaultMessage:"It violates server rules"},violation_description:{id:"report.reasons.violation_description",defaultMessage:"You are aware that it breaks specific rules"},other:{id:"report.reasons.other",defaultMessage:"It's something else"},other_description:{id:"report.reasons.other_description",defaultMessage:"The issue does not fit into other categories"},status:{id:"report.category.title_status",defaultMessage:"post"},account:{id:"report.category.title_account",defaultMessage:"profile"}}),de=o=>({rules:o.getIn(["server","server","rules"],D())});class ce extends p.PureComponent{constructor(){super(...arguments);n(this,"handleNextClick",()=>{const{onNextStep:t,category:s}=this.props;switch(s){case"dislike":t("thanks");break;case"violation":t("rules");break;default:t("statuses");break}});n(this,"handleCategoryToggle",(t,s)=>{const{onChangeCategory:a}=this.props;s&&a(t)})}render(){const{category:t,startedFrom:s,rules:a,intl:d}=this.props,u=a.size>0?["dislike","spam","legal","violation","other"]:["dislike","spam","legal","other"];return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"report-dialog-modal__title",children:e.jsx(l,{id:"report.category.title",defaultMessage:"Tell us what's going on with this {type}",values:{type:d.formatMessage(N[s])}})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.category.subtitle",defaultMessage:"Choose the best match"})}),e.jsx("div",{children:u.map(c=>e.jsx(T,{name:"category",value:c,checked:t===c,onToggle:this.handleCategoryToggle,label:d.formatMessage(N[c]),description:d.formatMessage(N[`${c}_description`])},c))}),e.jsx("div",{className:"flex-spacer"}),e.jsx("div",{className:"report-dialog-modal__actions",children:e.jsx(m,{onClick:this.handleNextClick,disabled:t===null,children:e.jsx(l,{id:"report.next",defaultMessage:"Next"})})})]})}}const ue=j(de)(P(ce)),pe=I({placeholder:{id:"report.placeholder",defaultMessage:"Type or paste additional comments"}}),he=L([o=>o.get("statuses"),(o,i)=>i],(o,i)=>i.map(t=>o.getIn([t,"in_reply_to_account_id"])),{resultEqualityCheck:Y}),me=({comment:o,domain:i,statusIds:t,isRemote:s,isSubmitting:a,selectedDomains:d,onSubmit:u,onChangeComment:c,onToggleDomain:g})=>{const C=z(),y=E(),k=p.useRef(!1),_=p.useCallback(()=>u(),[u]),v=p.useCallback(r=>c(r.target.value),[c]),b=p.useCallback(r=>g(r.target.value,r.target.checked),[g]),M=p.useCallback(r=>{r.keyCode===13&&(r.ctrlKey||r.metaKey)&&_()},[_]),h=A(r=>i?he(r,t):D()),w=A(r=>r.get("accounts")),R=i?x([i]).union(h.map(r=>w.getIn([r,"acct"],"").split("@")[1]).filter(r=>!!r)):x();return p.useEffect(()=>{if(k.current)return;k.current=!0,R.forEach(f=>{g(f,!0)}),x(h.filter(f=>f&&!w.has(f))).forEach(f=>{y(q(f))})}),e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"report-dialog-modal__title",children:e.jsx(l,{id:"report.comment.title",defaultMessage:"Is there anything else you think we should know?"})}),e.jsx("textarea",{className:"report-dialog-modal__textarea",placeholder:C.formatMessage(pe.placeholder),value:o,onChange:v,onKeyDown:M,disabled:a}),s&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.forward_hint",defaultMessage:"The account is from another server. Send an anonymized copy of the report there as well?"})}),R.map(r=>e.jsxs("label",{className:"report-dialog-modal__toggle",children:[e.jsx(ee,{checked:d.includes(r),disabled:a,onChange:b,value:r}),e.jsx(l,{id:"report.forward",defaultMessage:"Forward to {target}",values:{target:r}})]},`toggle-${r}`))]}),e.jsx("div",{className:"flex-spacer"}),e.jsx("div",{className:"report-dialog-modal__actions",children:e.jsx(m,{onClick:_,disabled:a,children:e.jsx(l,{id:"report.submit",defaultMessage:"Submit report"})})})]})},ge=o=>({rules:o.getIn(["server","server","rules"]),locale:o.getIn(["meta","locale"])});class xe extends p.PureComponent{constructor(){super(...arguments);n(this,"handleNextClick",()=>{const{onNextStep:t}=this.props;t("statuses")});n(this,"handleRulesToggle",(t,s)=>{const{onToggle:a}=this.props;a(t,s)})}render(){const{rules:t,locale:s,selectedRuleIds:a}=this.props;return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"report-dialog-modal__title",children:e.jsx(l,{id:"report.rules.title",defaultMessage:"Which rules are being violated?"})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.rules.subtitle",defaultMessage:"Select all that apply"})}),e.jsx("div",{children:t.map(d=>e.jsx(T,{name:"rule_ids",value:d.get("id"),checked:a.includes(d.get("id")),onToggle:this.handleRulesToggle,label:d.getIn(["translations",s,"text"])||d.getIn(["translations",s.split("-")[0],"text"])||d.get("text"),multiple:!0},d.get("id")))}),e.jsx("div",{className:"flex-spacer"}),e.jsx("div",{className:"report-dialog-modal__actions",children:e.jsx(m,{onClick:this.handleNextClick,disabled:a.size<1,children:e.jsx(l,{id:"report.next",defaultMessage:"Next"})})})]})}}const fe=j(ge)(xe);let je=class extends p.PureComponent{constructor(){super(...arguments);n(this,"handleStatusesToggle",(t,s)=>{const{onToggle:a}=this.props;a(t,s)})}render(){const{status:t,checked:s}=this.props;if(t.get("reblog"))return null;const a=e.jsxs("div",{className:"status-check-box__status poll__option__text",children:[e.jsxs("div",{className:"detailed-status__display-name",children:[e.jsx("div",{className:"detailed-status__display-avatar",children:e.jsx(K,{account:t.get("account"),size:46})}),e.jsxs("div",{children:[e.jsx(ae,{account:t.get("account")})," Â· ",e.jsx("span",{className:"status__visibility-icon",children:e.jsx(ne,{visibility:t.get("visibility")})})," ",e.jsx(ie,{timestamp:t.get("created_at")})]})]}),e.jsx(re,{status:t}),e.jsx(le,{status:t,visible:!1})]});return e.jsx(T,{name:"status_ids",value:t.get("id"),checked:s,onToggle:this.handleStatusesToggle,label:t.get("search_index"),labelComponent:a,multiple:!0})}};const _e=()=>{const o=se();return(t,{id:s})=>({status:o(t,{id:s})})},ke=j(_e)(je),be=(o,{accountId:i})=>({availableStatusIds:x(o.getIn(["timelines",`account:${i}:with_replies`,"items"])),isLoading:o.getIn(["timelines",`account:${i}:with_replies`,"isLoading"])});class Se extends p.PureComponent{constructor(){super(...arguments);n(this,"handleNextClick",()=>{const{onNextStep:t}=this.props;t("comment")})}render(){const{availableStatusIds:t,selectedStatusIds:s,onToggle:a,isLoading:d}=this.props;return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"report-dialog-modal__title",children:e.jsx(l,{id:"report.statuses.title",defaultMessage:"Are there any posts that back up this report?"})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.statuses.subtitle",defaultMessage:"Select all that apply"})}),e.jsx("div",{className:"report-dialog-modal__statuses",children:d?e.jsx(te,{}):t.union(s).map(u=>e.jsx(ke,{id:u,checked:s.includes(u),onToggle:a},u))}),e.jsx("div",{className:"flex-spacer"}),e.jsx("div",{className:"report-dialog-modal__actions",children:e.jsx(m,{onClick:this.handleNextClick,children:e.jsx(l,{id:"report.next",defaultMessage:"Next"})})})]})}}const Ce=j(be)(Se),ye=()=>({});class ve extends p.PureComponent{constructor(){super(...arguments);n(this,"handleCloseClick",()=>{const{onClose:t}=this.props;t()});n(this,"handleUnfollowClick",()=>{const{dispatch:t,account:s,onClose:a}=this.props;t(U(s.get("id"))),a()});n(this,"handleMuteClick",()=>{const{dispatch:t,account:s,onClose:a}=this.props;t(O(s.get("id"))),a()});n(this,"handleBlockClick",()=>{const{dispatch:t,account:s,onClose:a}=this.props;t(W(s.get("id"))),a()})}render(){const{account:t,submitted:s}=this.props;return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"report-dialog-modal__title",children:s?e.jsx(l,{id:"report.thanks.title_actionable",defaultMessage:"Thanks for reporting, we'll look into this."}):e.jsx(l,{id:"report.thanks.title",defaultMessage:"Don't want to see this?"})}),e.jsx("p",{className:"report-dialog-modal__lead",children:s?e.jsx(l,{id:"report.thanks.take_action_actionable",defaultMessage:"While we review this, you can take action against @{name}:",values:{name:t.get("username")}}):e.jsx(l,{id:"report.thanks.take_action",defaultMessage:"Here are your options for controlling what you see on Mastodon:"})}),t.getIn(["relationship","following"])&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"report-dialog-modal__subtitle",children:e.jsx(l,{id:"report.unfollow",defaultMessage:"Unfollow @{name}",values:{name:t.get("username")}})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.unfollow_explanation",defaultMessage:"You are following this account. To not see their posts in your home feed anymore, unfollow them."})}),e.jsx(m,{secondary:!0,onClick:this.handleUnfollowClick,children:e.jsx(l,{id:"account.unfollow",defaultMessage:"Unfollow"})}),e.jsx("hr",{})]}),e.jsx("h4",{className:"report-dialog-modal__subtitle",children:e.jsx(l,{id:"account.mute",defaultMessage:"Mute @{name}",values:{name:t.get("username")}})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.mute_explanation",defaultMessage:"You will not see their posts. They can still follow you and see your posts and will not know that they are muted."})}),e.jsx(m,{secondary:!0,onClick:this.handleMuteClick,children:t.getIn(["relationship","muting"])?e.jsx(l,{id:"account.muted",defaultMessage:"Muted"}):e.jsx(l,{id:"report.mute",defaultMessage:"Mute"})}),e.jsx("hr",{}),e.jsx("h4",{className:"report-dialog-modal__subtitle",children:e.jsx(l,{id:"account.block",defaultMessage:"Block @{name}",values:{name:t.get("username")}})}),e.jsx("p",{className:"report-dialog-modal__lead",children:e.jsx(l,{id:"report.block_explanation",defaultMessage:"You will not see their posts. They will not be able to see your posts or follow you. They will be able to tell that they are blocked."})}),e.jsx(m,{secondary:!0,onClick:this.handleBlockClick,children:t.getIn(["relationship","blocking"])?e.jsx(l,{id:"account.blocked",defaultMessage:"Blocked"}):e.jsx(l,{id:"report.block",defaultMessage:"Block"})}),e.jsx("div",{className:"flex-spacer"}),e.jsx("div",{className:"report-dialog-modal__actions",children:e.jsx(m,{onClick:this.handleCloseClick,children:e.jsx(l,{id:"report.close",defaultMessage:"Done"})})})]})}}const Me=j(ye)(ve),Ne=I({close:{id:"lightbox.close",defaultMessage:"Close"}}),Ie=()=>{const o=oe();return(t,{accountId:s})=>({account:o(t,s)})};class $ extends G{constructor(){super(...arguments);n(this,"state",{step:"category",selectedStatusIds:x(this.props.statusId?[this.props.statusId]:[]),selectedDomains:x(),comment:"",category:null,selectedRuleIds:x(),isSubmitting:!1,isSubmitted:!1});n(this,"handleSubmit",()=>{const{dispatch:t,accountId:s}=this.props,{selectedStatusIds:a,selectedDomains:d,comment:u,category:c,selectedRuleIds:g}=this.state;this.setState({isSubmitting:!0}),t(Z({account_id:s,status_ids:a.toArray(),forward_to_domains:d.toArray(),comment:u,forward:d.size>0,category:c,rule_ids:g.toArray()},this.handleSuccess,this.handleFail))});n(this,"handleSuccess",()=>{this.setState({isSubmitting:!1,isSubmitted:!0,step:"thanks"})});n(this,"handleFail",()=>{this.setState({isSubmitting:!1})});n(this,"handleStatusToggle",(t,s)=>{const{selectedStatusIds:a}=this.state;s?this.setState({selectedStatusIds:a.add(t)}):this.setState({selectedStatusIds:a.remove(t)})});n(this,"handleDomainToggle",(t,s)=>{s?this.setState(a=>({selectedDomains:a.selectedDomains.add(t)})):this.setState(a=>({selectedDomains:a.selectedDomains.remove(t)}))});n(this,"handleRuleToggle",(t,s)=>{s?this.setState(a=>({selectedRuleIds:a.selectedRuleIds.add(t)})):this.setState(a=>({selectedRuleIds:a.selectedRuleIds.remove(t)}))});n(this,"handleChangeCategory",t=>{this.setState({category:t})});n(this,"handleChangeComment",t=>{this.setState({comment:t})});n(this,"handleNextStep",t=>{this.setState({step:t})})}componentDidMount(){const{dispatch:t,accountId:s}=this.props;t(H(s,{withReplies:!0})),t(X())}render(){const{accountId:t,account:s,intl:a,onClose:d}=this.props;if(!s)return null;const{step:u,selectedStatusIds:c,selectedRuleIds:g,selectedDomains:C,comment:y,category:k,isSubmitting:_,isSubmitted:v}=this.state,b=s.get("acct").split("@")[1],M=!!b;let h;switch(u){case"category":h=e.jsx(ue,{onNextStep:this.handleNextStep,startedFrom:this.props.statusId?"status":"account",category:k,onChangeCategory:this.handleChangeCategory});break;case"rules":h=e.jsx(fe,{onNextStep:this.handleNextStep,selectedRuleIds:g,onToggle:this.handleRuleToggle});break;case"statuses":h=e.jsx(Ce,{onNextStep:this.handleNextStep,accountId:t,selectedStatusIds:c,onToggle:this.handleStatusToggle});break;case"comment":h=e.jsx(me,{onSubmit:this.handleSubmit,isSubmitting:_,isRemote:M,comment:y,domain:b,onChangeComment:this.handleChangeComment,statusIds:c,selectedDomains:C,onToggleDomain:this.handleDomainToggle});break;case"thanks":h=e.jsx(Me,{submitted:v,account:s,onClose:d})}return e.jsxs("div",{className:"modal-root__modal report-dialog-modal",children:[e.jsxs("div",{className:"report-modal__target",children:[e.jsx(J,{className:"report-modal__close",title:a.formatMessage(Ne.close),icon:"times",iconComponent:Q,onClick:d,size:20}),e.jsx(l,{id:"report.target",defaultMessage:"Report {target}",values:{target:e.jsx("strong",{children:s.get("acct")})}})]}),e.jsx("div",{className:"report-dialog-modal__container",children:h})]})}}n($,"propTypes",{accountId:S.string.isRequired,statusId:S.string,dispatch:S.func.isRequired,intl:S.object.isRequired,account:V.record.isRequired});const ot=j(Ie)(P($));export{ot as default};
//# sourceMappingURL=report_modal-qMjGoJcG.js.map
