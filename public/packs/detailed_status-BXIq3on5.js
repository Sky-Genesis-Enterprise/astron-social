import{j as t}from"./client-wT6vtYO_.js";import{r as n}from"./index-BdTwX--g.js";import{c as Q}from"./index-DizoKcfL.js";import{L as S}from"./short_number-WomMu2iV.js";import{b as G,d as U,D as Y,ag as J}from"./content_warning-DZ8mar1O.js";import{u as K,a as M,bV as X,o as Z,c as ee,V as te,bW as E,I as ae,A as ie}from"./useSelectableClick-DeaJbL2_.js";import{F as P}from"./formatted_date-jZOhBAMt.js";import{I as ne}from"./inline_account-Dg3-UMsJ.js";import{R as se}from"./index-CAH5FfLP.js";import{M as l}from"./message-UFwkQlnu.js";import{g as re,F as oe,P as le}from"./status-CiF0hsk4.js";import{C as ce,I as de}from"./card-CttmBekj.js";import me from"./media_gallery-DTAKF-fT.js";import{S as ge}from"./status_content-CaIN8-0B.js";import{Q as he}from"./status_quoted-COu-QToA.js";import{V as pe}from"./visibility_icon-DbVVvHFb.js";import{s as _e}from"./schedule_idle_task-Co3Ydhdu.js";const ue=({statusId:e,timestamp:x})=>{const r=K(),d=M(i=>{var o;return(o=i.history.getIn([e,"items"]))==null?void 0:o.toArray()}),m=M(i=>i.history.getIn([e,"loading"])),g=n.useCallback(()=>{r(X(e))},[r,e]),N=n.useCallback((i,o)=>{r(Z({modalType:"COMPARE_HISTORY",modalProps:{index:o,statusId:e}}))},[r,e]),h=n.useCallback(i=>t.jsx(l,{id:"status.edited_x_times",defaultMessage:"Edited {count, plural, one {# time} other {# times}}",values:{count:i.length-1}}),[]),C=n.useCallback((i,o,{onClick:p,onKeyUp:_})=>{const s=t.jsx(se,{timestamp:i.get("created_at"),short:!1}),v=t.jsx(ne,{accountId:i.get("account")}),j=i.get("original")?t.jsx(l,{id:"status.history.created",defaultMessage:"{name} created {date}",values:{name:v,date:s}}):t.jsx(l,{id:"status.history.edited",defaultMessage:"{name} edited {date}",values:{name:v,date:s}});return t.jsx("li",{className:"dropdown-menu__item edited-timestamp__history__item",children:t.jsx("button",{"data-index":o,onClick:p,onKeyUp:_,children:j})},i.get("created_at"))},[]);return t.jsx(G,{items:d,loading:m,renderItem:C,scrollable:!0,renderHeader:h,onOpen:g,onItemClick:N,forceDropdown:!0,children:t.jsx("button",{className:"dropdown-menu__text-button",children:t.jsx(l,{id:"status.edited",defaultMessage:"Edited {date}",values:{date:t.jsx(P,{className:"animated-number",value:x,month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}})})})},Me=({status:e,onOpenMedia:x,onOpenVideo:r,onTranslate:d,measureHeight:m,onHeightChange:g,domain:N,showMedia:h,withLogo:C,overrideDisplayName:i,pictureInPicture:o,onToggleMediaVisibility:p,onToggleHidden:_})=>{const s=(e==null?void 0:e.get("reblog"))??e,[v,j]=n.useState(0),[u,w]=n.useState(!1),b=n.useRef(),L=n.useCallback(a=>{const f=e.getIn(["translation","language"])||e.get("language");r&&r(e.getIn(["media_attachments",0]),f,a)},[r,e]),q=n.useCallback(()=>{w(!u)},[u,w]),z=n.useCallback(()=>{_&&_(e)},[_,e]),D=n.useCallback(a=>{m&&b.current&&(_e(()=>{b.current&&j(Math.ceil(b.current.scrollHeight)+1)}),g&&a&&g())},[g,m,j]),T=n.useCallback(a=>{b.current=a,D()},[D]),V=n.useCallback(()=>{d&&d(e)},[d,e]);if(!s)return null;let c,R,I,y;s.get("media_attachments").getIn([0,"type"])==="video"?y=`${s.get("media_attachments").getIn([0,"meta","original","width"])} / ${s.get("media_attachments").getIn([0,"meta","original","height"])}`:s.get("media_attachments").getIn([0,"type"])==="audio"?y="16 / 9":y=s.get("media_attachments").size===1&&s.get("media_attachments").getIn([0,"meta","small","aspect"])?s.get("media_attachments").getIn([0,"meta","small","aspect"]):"3 / 2";const A={boxSizing:"border-box"};m&&(A.height=v);const F=e.getIn(["translation","language"])||e.get("language");if(o.get("inUse"))c=t.jsx(le,{aspectRatio:y});else if(e.get("media_attachments").size>0){if(["image","gifv","unknown"].includes(e.getIn(["media_attachments",0,"type"]))||e.get("media_attachments").size>1)c=t.jsx(me,{standalone:!0,sensitive:e.get("sensitive"),media:e.get("media_attachments"),lang:F,height:300,onOpenMedia:x,visible:h,onToggleVisibility:p,matchedFilters:e.get("matched_media_filters")});else if(e.getIn(["media_attachments",0,"type"])==="audio"){const a=e.getIn(["media_attachments",0]),f=a.getIn(["translation","description"])||a.get("description");c=t.jsx(ee,{src:a.get("url"),alt:f,lang:F,poster:a.get("preview_url")||e.getIn(["account","avatar_static"]),duration:a.getIn(["meta","original","duration"],0),backgroundColor:a.getIn(["meta","colors","background"]),foregroundColor:a.getIn(["meta","colors","foreground"]),accentColor:a.getIn(["meta","colors","accent"]),sensitive:e.get("sensitive"),visible:h,blurhash:a.get("blurhash"),onToggleVisibility:p,matchedFilters:e.get("matched_media_filters")})}else if(e.getIn(["media_attachments",0,"type"])==="video"){const a=e.getIn(["media_attachments",0]),f=a.getIn(["translation","description"])||a.get("description");c=t.jsx(te,{preview:a.get("preview_url"),frameRate:a.getIn(["meta","original","frame_rate"]),aspectRatio:`${a.getIn(["meta","original","width"])} / ${a.getIn(["meta","original","height"])}`,blurhash:a.get("blurhash"),src:a.get("url"),alt:f,lang:F,onOpenVideo:L,sensitive:e.get("sensitive"),visible:h,onToggleVisibility:p,matchedFilters:e.get("matched_media_filters")})}}else e.get("card")&&!e.get("quote")&&(c=t.jsx(ce,{sensitive:e.get("sensitive"),onOpenMedia:x,card:e.get("card")}));e.get("application")&&(R=t.jsxs(t.Fragment,{children:["·",t.jsx("a",{className:"detailed-status__application",href:e.getIn(["application","website"]),target:"_blank",rel:"noopener noreferrer",children:e.getIn(["application","name"])})]}));const W=t.jsxs(t.Fragment,{children:["·",t.jsx(pe,{visibility:e.get("visibility")})]});["private","direct"].includes(e.get("visibility"))?I="":I=t.jsxs(S,{to:`/@${e.getIn(["account","acct"])}/${e.get("id")}/reblogs`,className:"detailed-status__link",children:[t.jsx("span",{className:"detailed-status__reblogs",children:t.jsx(E,{value:e.get("reblogs_count")})}),t.jsx(l,{id:"status.reblogs",defaultMessage:"{count, plural, one {boost} other {boosts}}",values:{count:e.get("reblogs_count")}})]});const H=t.jsxs(S,{to:`/@${e.getIn(["account","acct"])}/${e.get("id")}/favourites`,className:"detailed-status__link",children:[t.jsx("span",{className:"detailed-status__favorites",children:t.jsx(E,{value:e.get("favourites_count")})}),t.jsx(l,{id:"status.favourites",defaultMessage:"{count, plural, one {favorite} other {favorites}}",values:{count:e.get("favourites_count")}})]}),{statusContentProps:O,hashtagBar:B}=re(e),k=e.get("matched_filters"),$=(!k||u)&&(!e.get("hidden")||e.get("spoiler_text").length===0);return t.jsx("div",{style:A,children:t.jsxs("div",{ref:T,className:Q("detailed-status",{"status--has-quote":!!e.get("quote")}),children:[e.get("visibility")==="direct"&&t.jsxs("div",{className:"status__prepend",children:[t.jsx("div",{className:"status__prepend-icon-wrapper",children:t.jsx(ae,{id:"at",icon:U,className:"status__prepend-icon"})}),t.jsx(l,{id:"status.direct_indicator",defaultMessage:"Private mention"})]}),t.jsxs(S,{to:`/@${e.getIn(["account","acct"])}`,"data-hover-card-account":e.getIn(["account","id"]),className:"detailed-status__display-name",children:[t.jsx("div",{className:"detailed-status__display-avatar",children:t.jsx(ie,{account:e.get("account"),size:46})}),i??t.jsx(Y,{account:e.get("account"),localDomain:N}),C&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spacer"}),t.jsx(de,{})]})]}),k&&t.jsx(oe,{title:k.join(", "),expanded:u,onClick:q}),e.get("spoiler_text").length>0&&(!k||u)&&t.jsx(J,{text:e.getIn(["translation","spoilerHtml"])||e.get("spoilerHtml"),expanded:$,onClick:z}),$&&t.jsxs(t.Fragment,{children:[t.jsx(ge,{status:e,onTranslate:V,...O}),c,B,e.get("quote")&&t.jsx(he,{quote:e.get("quote")})]}),t.jsxs("div",{className:"detailed-status__meta",children:[t.jsxs("div",{className:"detailed-status__meta__line",children:[t.jsx("a",{className:"detailed-status__datetime",href:`/@${e.getIn(["account","acct"])}/${e.get("id")}`,target:"_blank",rel:"noopener noreferrer",children:t.jsx(P,{value:new Date(e.get("created_at")),year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),W,R]}),e.get("edited_at")&&t.jsx("div",{className:"detailed-status__meta__line",children:t.jsx(ue,{statusId:e.get("id"),timestamp:e.get("edited_at")})}),t.jsxs("div",{className:"detailed-status__meta__line",children:[I,I&&t.jsx(t.Fragment,{children:"·"}),H]})]})]})})};export{Me as D};
//# sourceMappingURL=detailed_status-BXIq3on5.js.map
