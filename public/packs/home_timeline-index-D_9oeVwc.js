var E=Object.defineProperty;var F=(o,a,e)=>a in o?E(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var r=(o,a,e)=>F(o,typeof a!="symbol"?a+"":a,e);import{j as n}from"./client-wT6vtYO_.js";import{i as I,d as P,b,r as x}from"./index-BdTwX--g.js";import{c as R}from"./index-DizoKcfL.js";import{H}from"./Helmet-ZVWnGmbg.js";import{y as _,z as f,b as S,aQ as z,cN as Y,I as $,aR as U,i as B,bW as K,j as N,an as W,bv as G,cO as O,cP as Q,cQ as J,a as V,u as X,aM as Z,B as ee,ae as te,cF as ne,cG as se,N as A,aL as ie,cR as oe}from"./useSelectableClick-DeaJbL2_.js";import{S as ae}from"./campaign-B6cnb957.js";import{S as re}from"./home-fill-BjwEpYg3.js";import{S as le}from"./card-CttmBekj.js";import{I as ce}from"./icon_with_badge-zn31jvrZ.js";import{N as me}from"./not_signed_in_indicator-CCzEFwYn.js";import{P as m,w as de}from"./short_number-WomMu2iV.js";import{R as pe}from"./index-Dy8WPmut.js";import{e as ue}from"./elephant_ui_plane-BHprlJ8c.js";import{S as he}from"./add-D8GR9P00.js";import{S as ge}from"./chevron_left-CnYIoVsW.js";import{E as fe}from"./emoji_picker_dropdown_container-BZPW7vKM.js";import{u as v,b as xe}from"./index-CAH5FfLP.js";import{J as je,A as ve,k as _e,l as C,K as be}from"./initial_state-BP3UcUr4.js";import{M as h}from"./message-UFwkQlnu.js";import{w as Me}from"./useBreakpoint-lQ5WUdV4.js";import{C as Ce}from"./column-B4vwzadM.js";import{C as Re}from"./column_header-FN7GyEAs.js";import{S as ye}from"./status_list_container-7VQVJmu6.js";import{S as M}from"./setting_toggle-56grnhBH.js";import"./api-B2m7efUy.js";import"./index-lj9VQs0f.js";import"./ready-DpOgoWSg.js";import"./load_locale-tOpKhmcM.js";import"./numbers-CGZQWBYL.js";import"./content_warning-DZ8mar1O.js";import"./skeleton-D9NbTYr9.js";import"./scroll-BygYx8ga.js";import"./close-BsPe8EbX.js";import"./status_list-DPL_DhlK.js";import"./gif-BtN1axMk.js";import"./info-HtHaDKcq.js";import"./follow_button-BdqDKUmA.js";import"./index-BZWHsOPk.js";import"./loading_indicator-7xMB1U6D.js";import"./verified_badge-CtK79Pb7.js";import"./status_quoted-COu-QToA.js";import"./domain_blocks-CYnp0hav.js";import"./reports-DBOcsYZF.js";import"./status-CiF0hsk4.js";import"./index.es-B0ZBMj49.js";import"./avatar_overlay-BeG39OK4.js";import"./toString-Cy1Ecq9L.js";import"./status_content-CaIN8-0B.js";import"./poll-CjurB963.js";import"./permissions-Djze7cmB.js";import"./visibility_icon-DbVVvHFb.js";import"./index-OwtqmxAM.js";import"./load_gap-6rwcZCuh.js";import"./scrollable_list-lNykmhKA.js";import"./scroll_container-Bq73vRM7.js";import"./react-router-scroll-4.es-CU7ja20b.js";import"./interopRequireDefault-CdiRfGvq.js";import"./schedule_idle_task-Co3Ydhdu.js";import"./load_more-qGthrhsi.js";import"./index-Dk6IJ02w.js";const w=P({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"}});class D extends _{constructor(){super(...arguments);r(this,"setRef",e=>{this.node=e});r(this,"onMentionClick",(e,t)=>{this.props.history&&t.button===0&&!(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.props.history.push(`/@${e.get("acct")}`))});r(this,"onHashtagClick",(e,t)=>{e=e.replace(/^#/,""),this.props.history&&t.button===0&&!(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.props.history.push(`/tags/${e}`))});r(this,"onStatusClick",(e,t)=>{this.props.history&&t.button===0&&!(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.props.history.push(`/@${e.getIn(["account","acct"])}/${e.get("id")}`))});r(this,"handleMouseEnter",({currentTarget:e})=>{if(C)return;const t=e.querySelectorAll(".custom-emoji");for(var i=0;i<t.length;i++){let s=t[i];s.src=s.getAttribute("data-original")}});r(this,"handleMouseLeave",({currentTarget:e})=>{if(C)return;const t=e.querySelectorAll(".custom-emoji");for(var i=0;i<t.length;i++){let s=t[i];s.src=s.getAttribute("data-static")}})}componentDidMount(){this._updateLinks()}componentDidUpdate(){this._updateLinks()}_updateLinks(){const e=this.node;if(!e)return;const t=e.querySelectorAll("a");for(var i=0;i<t.length;++i){let s=t[i];if(s.classList.contains("status-link"))continue;s.classList.add("status-link");let c=this.props.announcement.get("mentions").find(d=>s.href===d.get("url"));if(c)s.addEventListener("click",this.onMentionClick.bind(this,c),!1),s.setAttribute("title",c.get("acct"));else if(s.textContent[0]==="#"||s.previousSibling&&s.previousSibling.textContent&&s.previousSibling.textContent[s.previousSibling.textContent.length-1]==="#")s.addEventListener("click",this.onHashtagClick.bind(this,s.text),!1);else{let d=this.props.announcement.get("statuses").find(l=>s.href===l.get("url"));d&&s.addEventListener("click",this.onStatusClick.bind(this,d),!1),s.setAttribute("title",s.href),s.classList.add("unhandled-link")}s.setAttribute("target","_blank"),s.setAttribute("rel","noopener")}}render(){const{announcement:e}=this.props;return n.jsx("div",{className:"announcements__item__content translate",ref:this.setRef,dangerouslySetInnerHTML:{__html:e.get("contentHtml")},onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave})}}r(D,"propTypes",{announcement:f.map.isRequired,...U});const ke=de(D);class Se extends x.PureComponent{render(){const{emoji:a,emojiMap:e,hovered:t}=this.props;if(v[a]){const{filename:i,shortCode:s}=v[this.props.emoji],c=s?`:${s}:`:"";return n.jsx("img",{draggable:"false",className:"emojione",alt:a,title:c,src:`${xe}/emoji/${i}.svg`})}else if(e.get(a)){const i=C||t?e.getIn([a,"url"]):e.getIn([a,"static_url"]),s=`:${a}:`;return n.jsx("img",{draggable:"false",className:"emojione custom-emoji",alt:s,title:s,src:i})}else return null}}class T extends _{constructor(){super(...arguments);r(this,"state",{hovered:!1});r(this,"handleClick",()=>{const{reaction:e,announcementId:t,addReaction:i,removeReaction:s}=this.props;e.get("me")?s(t,e.get("name")):i(t,e.get("name"))});r(this,"handleMouseEnter",()=>this.setState({hovered:!0}));r(this,"handleMouseLeave",()=>this.setState({hovered:!1}))}render(){const{reaction:e}=this.props;let t=e.get("name");return v[t]&&(t=v[t].shortCode),n.jsxs(B.button,{className:R("reactions-bar__item",{active:e.get("me")}),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,title:`:${t}:`,style:this.props.style,children:[n.jsx("span",{className:"reactions-bar__item__emoji",children:n.jsx(Se,{hovered:this.state.hovered,emoji:e.get("name"),emojiMap:this.props.emojiMap})}),n.jsx("span",{className:"reactions-bar__item__count",children:n.jsx(K,{value:e.get("count")})})]})}}r(T,"propTypes",{announcementId:m.string.isRequired,reaction:f.map.isRequired,addReaction:m.func.isRequired,removeReaction:m.func.isRequired,emojiMap:f.map.isRequired,style:m.object});const Ae=({announcementId:o,reactions:a,emojiMap:e,addReaction:t,removeReaction:i})=>{const s=x.useMemo(()=>a.filter(l=>l.get("count")>0).toArray(),[a]),c=x.useCallback(l=>{t(o,l.native.replaceAll(/:/g,""))},[t,o]),d=Y(s,{from:{scale:0},enter:{scale:1},leave:{scale:0},keys:s.map(l=>l.get("name"))});return n.jsxs("div",{className:R("reactions-bar",{"reactions-bar--empty":s.length===0}),children:[d(({scale:l},u)=>n.jsx(T,{reaction:u,style:{transform:l.to(p=>`scale(${p})`)},addReaction:t,removeReaction:i,announcementId:o,emojiMap:e},u.get("name"))),s.length<8&&n.jsx(fe,{onPickEmoji:c,button:n.jsx($,{id:"plus",icon:he})})]})};class L extends _{constructor(){super(...arguments);r(this,"state",{unread:!this.props.announcement.get("read")})}componentDidUpdate(){const{selected:e,announcement:t}=this.props;!e&&this.state.unread!==!t.get("read")&&this.setState({unread:!t.get("read")})}render(){const{announcement:e}=this.props,{unread:t}=this.state,i=e.get("starts_at")&&new Date(e.get("starts_at")),s=e.get("ends_at")&&new Date(e.get("ends_at")),c=new Date,d=i&&s,l=e.get("all_day");let u=null;if(d){const p=i.getFullYear()===s.getFullYear()&&s.getFullYear()===c.getFullYear(),j=i.getDate()===s.getDate()&&i.getMonth()===s.getMonth()&&i.getFullYear()===s.getFullYear();u=n.jsxs(n.Fragment,{children:[n.jsx(b,{value:i,year:p||i.getFullYear()===c.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:l?void 0:"2-digit",minute:l?void 0:"2-digit"})," - ",n.jsx(b,{value:s,year:p||s.getFullYear()===c.getFullYear()?void 0:"numeric",month:j?void 0:"short",day:j?void 0:"2-digit",hour:l?void 0:"2-digit",minute:l?void 0:"2-digit"})]})}else{const p=new Date(e.get("published_at"));u=n.jsx(b,{value:p,year:p.getFullYear()===c.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:l?void 0:"2-digit",minute:l?void 0:"2-digit"})}return n.jsxs("div",{className:"announcements__item",children:[n.jsxs("strong",{className:"announcements__item__range",children:[n.jsx(h,{id:"announcement.announcement",defaultMessage:"Announcement"}),n.jsxs("span",{children:[" Â· ",u]})]}),n.jsx(ke,{announcement:e}),n.jsx(Ae,{reactions:e.get("reactions"),announcementId:e.get("id"),addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap}),t&&n.jsx("span",{className:"announcements__item__unread"})]})}}r(L,"propTypes",{announcement:f.map.isRequired,emojiMap:f.map.isRequired,addReaction:m.func.isRequired,removeReaction:m.func.isRequired,intl:m.object.isRequired,selected:m.bool});class q extends _{constructor(){super(...arguments);r(this,"state",{index:0});r(this,"handleChangeIndex",e=>{this.setState({index:e%this.props.announcements.size})});r(this,"handleNextClick",()=>{this.setState({index:(this.state.index+1)%this.props.announcements.size})});r(this,"handlePrevClick",()=>{this.setState({index:(this.props.announcements.size+this.state.index-1)%this.props.announcements.size})})}static getDerivedStateFromProps(e,t){return e.announcements.size>0&&t.index>=e.announcements.size?{index:e.announcements.size-1}:null}componentDidMount(){this._markAnnouncementAsRead()}componentDidUpdate(){this._markAnnouncementAsRead()}_markAnnouncementAsRead(){const{dismissAnnouncement:e,announcements:t}=this.props,{index:i}=this.state,s=t.get(t.size-1-i);s.get("read")||e(s.get("id"))}render(){const{announcements:e,intl:t}=this.props,{index:i}=this.state;return e.isEmpty()?null:n.jsxs("div",{className:"announcements",children:[n.jsx("img",{className:"announcements__mastodon",alt:"",draggable:"false",src:je||ue}),n.jsxs("div",{className:"announcements__container",children:[n.jsx(pe,{animateHeight:!0,animateTransitions:!_e,index:i,onChangeIndex:this.handleChangeIndex,children:e.map((s,c)=>n.jsx(L,{announcement:s,emojiMap:this.props.emojiMap,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,intl:t,selected:i===c,disabled:ve},s.get("id"))).reverse()}),e.size>1&&n.jsxs("div",{className:"announcements__pagination",children:[n.jsx(S,{disabled:e.size===1,title:t.formatMessage(w.previous),icon:"chevron-left",iconComponent:ge,onClick:this.handlePrevClick,size:13}),n.jsxs("span",{children:[i+1," / ",e.size]}),n.jsx(S,{disabled:e.size===1,title:t.formatMessage(w.next),icon:"chevron-right",iconComponent:z,onClick:this.handleNextClick,size:13})]})]})]})}}r(q,"propTypes",{announcements:f.list,emojiMap:f.map.isRequired,dismissAnnouncement:m.func.isRequired,addReaction:m.func.isRequired,removeReaction:m.func.isRequired,intl:m.object.isRequired});const we=I(q),Ie=W([o=>o.get("custom_emojis")],o=>o.reduce((a,e)=>a.set(e.get("shortcode"),e),G())),Pe=o=>({announcements:o.getIn(["announcements","items"]),emojiMap:Ie(o)}),Ne=o=>({dismissAnnouncement:a=>o(J(a)),addReaction:(a,e)=>o(Q(a,e)),removeReaction:(a,e)=>o(O(a,e))}),De=N(Pe,Ne)(we),Te=()=>{const o=V(t=>t.settings.get("home")),a=X(),e=x.useCallback((t,i)=>{a(Z(["home",...t],i))},[a]);return n.jsx("div",{className:"column-settings",children:n.jsx("section",{children:n.jsxs("div",{className:"column-settings__row",children:[n.jsx(M,{prefix:"home_timeline",settings:o,settingPath:["shows","reblog"],onChange:e,label:n.jsx(h,{id:"home.column_settings.show_reblogs",defaultMessage:"Show boosts"})}),n.jsx(M,{prefix:"home_timeline",settings:o,settingPath:["shows","quote"],onChange:e,label:n.jsx(h,{id:"home.column_settings.show_quotes",defaultMessage:"Show quotes"})}),n.jsx(M,{prefix:"home_timeline",settings:o,settingPath:["shows","reply"],onChange:e,label:n.jsx(h,{id:"home.column_settings.show_replies",defaultMessage:"Show replies"})})]})})})},Le=()=>n.jsx("div",{className:"warning-banner",children:n.jsxs("div",{className:"warning-banner__message",children:[n.jsx("h1",{children:n.jsx(h,{id:"home.pending_critical_update.title",defaultMessage:"Critical security update available!"})}),n.jsxs("p",{children:[n.jsx(h,{id:"home.pending_critical_update.body",defaultMessage:"Please update your Mastodon server as soon as possible!"})," ",n.jsx("a",{href:"/admin/software_updates",children:n.jsx(h,{id:"home.pending_critical_update.link",defaultMessage:"See updates"})})]})]})}),g=P({title:{id:"column.home",defaultMessage:"Home"},show_announcements:{id:"home.show_announcements",defaultMessage:"Show announcements"},hide_announcements:{id:"home.hide_announcements",defaultMessage:"Hide announcements"}}),qe=o=>({hasUnread:o.getIn(["timelines","home","unread"])>0,isPartial:o.getIn(["timelines","home","isPartial"]),hasAnnouncements:!o.getIn(["announcements","items"]).isEmpty(),unreadAnnouncements:o.getIn(["announcements","items"]).count(a=>!a.get("read")),showAnnouncements:o.getIn(["announcements","show"])});class Ee extends x.PureComponent{constructor(){super(...arguments);r(this,"handlePin",()=>{const{columnId:e,dispatch:t}=this.props;t(e?te(e):ne("HOME",{}))});r(this,"handleMove",e=>{const{columnId:t,dispatch:i}=this.props;i(se(t,e))});r(this,"handleHeaderClick",()=>{this.column.scrollTop()});r(this,"setRef",e=>{this.column=e});r(this,"handleLoadMore",e=>{this.props.dispatch(A({maxId:e}))});r(this,"handleToggleAnnouncementsClick",e=>{e.stopPropagation(),this.props.dispatch(oe())})}componentDidMount(){setTimeout(()=>this.props.dispatch(ie()),700),this._checkIfReloadNeeded(!1,this.props.isPartial)}componentDidUpdate(e){this._checkIfReloadNeeded(e.isPartial,this.props.isPartial)}componentWillUnmount(){this._stopPolling()}_checkIfReloadNeeded(e,t){const{dispatch:i}=this.props;e!==t&&(!e&&t?this.polling=setInterval(()=>{i(A())},3e3):e&&!t&&this._stopPolling())}_stopPolling(){this.polling&&(clearInterval(this.polling),this.polling=null)}render(){const{intl:e,hasUnread:t,columnId:i,multiColumn:s,hasAnnouncements:c,unreadAnnouncements:d,showAnnouncements:l,matchesBreakpoint:u}=this.props,p=!!i,{signedIn:j}=this.props.identity,y=[];let k;return c&&(k=n.jsx("button",{type:"button",className:R("column-header__button",{active:l}),title:e.formatMessage(l?g.hide_announcements:g.show_announcements),"aria-label":e.formatMessage(l?g.hide_announcements:g.show_announcements),onClick:this.handleToggleAnnouncementsClick,children:n.jsx(ce,{id:"bullhorn",icon:ae,count:d})})),be&&y.push(n.jsx(Le,{},"critical-update-banner")),n.jsxs(Ce,{bindToDocument:!s,ref:this.setRef,label:e.formatMessage(g.title),children:[n.jsx(Re,{icon:"home",iconComponent:u?le:re,active:t,title:e.formatMessage(g.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:p,multiColumn:s,extraButton:k,appendContent:c&&l&&n.jsx(De,{}),children:n.jsx(Te,{})}),j?n.jsx(ye,{prepend:y,alwaysPrepend:!0,trackScroll:!p,scrollKey:`home_timeline-${i}`,onLoadMore:this.handleLoadMore,timelineId:"home",emptyMessage:n.jsx(h,{id:"empty_column.home",defaultMessage:"Your home timeline is empty! Follow more people to fill it up."}),bindToDocument:!s}):n.jsx(me,{}),n.jsxs(H,{children:[n.jsx("title",{children:e.formatMessage(g.title)}),n.jsx("meta",{name:"robots",content:"noindex"})]})]})}}const Kt=N(qe)(Me(ee(I(Ee))));export{Kt as default};
//# sourceMappingURL=home_timeline-index-D_9oeVwc.js.map
