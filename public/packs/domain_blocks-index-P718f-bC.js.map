{"version":3,"file":"domain_blocks-index-P718f-bC.js","sources":["../../app/javascript/mastodon/api/domain_blocks.ts","../../app/javascript/mastodon/components/domain.tsx","../../app/javascript/mastodon/features/domain_blocks/index.tsx"],"sourcesContent":["import api, { getLinks } from 'mastodon/api';\n\nexport const apiGetDomainBlocks = async (url?: string) => {\n  const response = await api().request<string[]>({\n    method: 'GET',\n    url: url ?? '/api/v1/domain_blocks',\n  });\n\n  return {\n    domains: response.data,\n    links: getLinks(response),\n  };\n};\n","import { useCallback } from 'react';\n\nimport { FormattedMessage } from 'react-intl';\n\nimport { unblockDomain } from 'mastodon/actions/domain_blocks';\nimport { useAppDispatch } from 'mastodon/store';\n\nimport { Button } from './button';\n\nexport const Domain: React.FC<{\n  domain: string;\n}> = ({ domain }) => {\n  const dispatch = useAppDispatch();\n\n  const handleDomainUnblock = useCallback(() => {\n    dispatch(unblockDomain(domain));\n  }, [dispatch, domain]);\n\n  return (\n    <div className='domain'>\n      <div className='domain__domain-name'>\n        <strong>{domain}</strong>\n      </div>\n\n      <div className='domain__buttons'>\n        <Button onClick={handleDomainUnblock}>\n          <FormattedMessage\n            id='account.unblock_domain_short'\n            defaultMessage='Unblock'\n          />\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import { useEffect, useRef, useCallback, useState } from 'react';\n\nimport { defineMessages, useIntl, FormattedMessage } from 'react-intl';\n\nimport { Helmet } from 'react-helmet';\n\nimport BlockIcon from '@/material-icons/400-24px/block-fill.svg?react';\nimport { apiGetDomainBlocks } from 'mastodon/api/domain_blocks';\nimport { Column } from 'mastodon/components/column';\nimport type { ColumnRef } from 'mastodon/components/column';\nimport { ColumnHeader } from 'mastodon/components/column_header';\nimport { Domain } from 'mastodon/components/domain';\nimport ScrollableList from 'mastodon/components/scrollable_list';\n\nconst messages = defineMessages({\n  heading: { id: 'column.domain_blocks', defaultMessage: 'Blocked domains' },\n});\n\nconst Blocks: React.FC<{ multiColumn: boolean }> = ({ multiColumn }) => {\n  const intl = useIntl();\n  const [domains, setDomains] = useState<string[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [next, setNext] = useState<string | undefined>();\n  const hasMore = !!next;\n  const columnRef = useRef<ColumnRef>(null);\n\n  useEffect(() => {\n    setLoading(true);\n\n    void apiGetDomainBlocks()\n      .then(({ domains, links }) => {\n        const next = links.refs.find((link) => link.rel === 'next');\n\n        setLoading(false);\n        setDomains(domains);\n        setNext(next?.uri);\n\n        return '';\n      })\n      .catch(() => {\n        setLoading(false);\n      });\n  }, [setLoading, setDomains, setNext]);\n\n  const handleLoadMore = useCallback(() => {\n    setLoading(true);\n\n    void apiGetDomainBlocks(next)\n      .then(({ domains, links }) => {\n        const next = links.refs.find((link) => link.rel === 'next');\n\n        setLoading(false);\n        setDomains((previousDomains) => [...previousDomains, ...domains]);\n        setNext(next?.uri);\n\n        return '';\n      })\n      .catch(() => {\n        setLoading(false);\n      });\n  }, [setLoading, setDomains, setNext, next]);\n\n  const handleHeaderClick = useCallback(() => {\n    columnRef.current?.scrollTop();\n  }, []);\n\n  const emptyMessage = (\n    <FormattedMessage\n      id='empty_column.domain_blocks'\n      defaultMessage='There are no blocked domains yet.'\n    />\n  );\n\n  return (\n    <Column\n      bindToDocument={!multiColumn}\n      ref={columnRef}\n      label={intl.formatMessage(messages.heading)}\n    >\n      <ColumnHeader\n        icon='ban'\n        iconComponent={BlockIcon}\n        title={intl.formatMessage(messages.heading)}\n        onClick={handleHeaderClick}\n        multiColumn={multiColumn}\n        showBackButton\n      />\n\n      <ScrollableList\n        scrollKey='domain_blocks'\n        onLoadMore={handleLoadMore}\n        hasMore={hasMore}\n        isLoading={loading}\n        showLoading={loading && domains.length === 0}\n        emptyMessage={emptyMessage}\n        trackScroll={!multiColumn}\n        bindToDocument={!multiColumn}\n      >\n        {domains.map((domain) => (\n          <Domain key={domain} domain={domain} />\n        ))}\n      </ScrollableList>\n\n      <Helmet>\n        <title>{intl.formatMessage(messages.heading)}</title>\n        <meta name='robots' content='noindex' />\n      </Helmet>\n    </Column>\n  );\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default Blocks;\n"],"names":["apiGetDomainBlocks","url","response","api","request","method","domains","data","links","getLinks","Domain","domain","dispatch","useAppDispatch","handleDomainUnblock","useCallback","unblockDomain","jsxs","jsx","Button","FormattedMessage","messages","defineMessages","heading","id","defaultMessage","Blocks","multiColumn","intl","useIntl","setDomains","useState","loading","setLoading","next","setNext","hasMore","columnRef","useRef","useEffect","then","refs","find","link","rel","uri","catch","handleLoadMore","previousDomains","handleHeaderClick","current","scrollTop","emptyMessage","Column","formatMessage","ColumnHeader","BlockIcon","ScrollableList","length","map","Helmet"],"mappings":"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"}