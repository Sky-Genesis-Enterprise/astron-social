{"version":3,"file":"ReportReasonSelector-D1Q64ifo.js","sources":["../../app/javascript/mastodon/components/admin/ReportReasonSelector.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport { injectIntl, defineMessages } from 'react-intl';\n\nimport classNames from 'classnames';\n\nimport api from 'mastodon/api';\n\nconst messages = defineMessages({\n  legal: { id: 'report.categories.legal', defaultMessage: 'Legal' },\n  other: { id: 'report.categories.other', defaultMessage: 'Other' },\n  spam: { id: 'report.categories.spam', defaultMessage: 'Spam' },\n  violation: { id: 'report.categories.violation', defaultMessage: 'Content violates one or more server rules' },\n});\n\nclass Category extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    text: PropTypes.string.isRequired,\n    selected: PropTypes.bool,\n    disabled: PropTypes.bool,\n    onSelect: PropTypes.func,\n    children: PropTypes.node,\n  };\n\n  handleClick = () => {\n    const { id, disabled, onSelect } = this.props;\n\n    if (!disabled) {\n      onSelect(id);\n    }\n  };\n\n  render () {\n    const { id, text, disabled, selected, children } = this.props;\n\n    return (\n      <div tabIndex={0} role='button' className={classNames('report-reason-selector__category', { selected, disabled })} onClick={this.handleClick}>\n        {selected && <input type='hidden' name='report[category]' value={id} />}\n\n        <div className='report-reason-selector__category__label'>\n          <span className={classNames('poll__input', { active: selected, disabled })} />\n          {text}\n        </div>\n\n        {(selected && children) && (\n          <div className='report-reason-selector__category__rules'>\n            {children}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n}\n\nclass Rule extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    text: PropTypes.string.isRequired,\n    selected: PropTypes.bool,\n    disabled: PropTypes.bool,\n    onToggle: PropTypes.func,\n  };\n\n  handleClick = () => {\n    const { id, disabled, onToggle } = this.props;\n\n    if (!disabled) {\n      onToggle(id);\n    }\n  };\n\n  render () {\n    const { id, text, disabled, selected } = this.props;\n\n    return (\n      <div tabIndex={0} role='button' className={classNames('report-reason-selector__rule', { selected, disabled })} onClick={this.handleClick}>\n        <span className={classNames('poll__input', { checkbox: true, active: selected, disabled })} />\n        {selected && <input type='hidden' name='report[rule_ids][]' value={id} />}\n        {text}\n      </div>\n    );\n  }\n\n}\n\nclass ReportReasonSelector extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    category: PropTypes.string.isRequired,\n    rule_ids: PropTypes.arrayOf(PropTypes.string),\n    disabled: PropTypes.bool,\n    intl: PropTypes.object.isRequired,\n  };\n\n  state = {\n    category: this.props.category,\n    rule_ids: this.props.rule_ids || [],\n    rules: [],\n  };\n\n  componentDidMount() {\n    api(false).get('/api/v2/instance').then(res => {\n      this.setState({\n        rules: res.data.rules,\n      });\n    }).catch(err => {\n      console.error(err);\n    });\n  }\n\n  _save = () => {\n    const { id, disabled } = this.props;\n    const { category, rule_ids } = this.state;\n\n    if (disabled) {\n      return;\n    }\n\n    api(false).put(`/api/v1/admin/reports/${id}`, {\n      category,\n      rule_ids: category === 'violation' ? rule_ids : [],\n    }).catch(err => {\n      console.error(err);\n    });\n  };\n\n  handleSelect = id => {\n    this.setState({ category: id }, () => this._save());\n  };\n\n  handleToggle = id => {\n    const { rule_ids } = this.state;\n\n    if (rule_ids.includes(id)) {\n      this.setState({ rule_ids: rule_ids.filter(x => x !== id ) }, () => this._save());\n    } else {\n      this.setState({ rule_ids: [...rule_ids, id] }, () => this._save());\n    }\n  };\n\n  render () {\n    const { disabled, intl } = this.props;\n    const { rules, category, rule_ids } = this.state;\n\n    return (\n      <div className='report-reason-selector'>\n        <Category id='other' text={intl.formatMessage(messages.other)} selected={category === 'other'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='legal' text={intl.formatMessage(messages.legal)} selected={category === 'legal'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='spam' text={intl.formatMessage(messages.spam)} selected={category === 'spam'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='violation' text={intl.formatMessage(messages.violation)} selected={category === 'violation'} onSelect={this.handleSelect} disabled={disabled || rules.length === 0}>\n          {rules.map(rule => <Rule key={rule.id} id={rule.id} text={rule.text} selected={rule_ids.includes(rule.id)} onToggle={this.handleToggle} disabled={disabled} />)}\n        </Category>\n      </div>\n    );\n  }\n\n}\n\nexport default injectIntl(ReportReasonSelector);\n"],"names":["messages","defineMessages","legal","id","defaultMessage","other","spam","violation","Category","PureComponent","handleClick","disabled","onSelect","props","render","text","selected","children","jsxs","classNames","jsx","active","Rule","onToggle","checkbox","ReportReasonSelector","state","category","rule_ids","rules","_save","api","put","catch","err","console","error","handleSelect","setState","handleToggle","includes","filter","x","componentDidMount","get","then","res","data","intl","formatMessage","length","map","rule","ReportReasonSelector$1","injectIntl"],"mappings":"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"}