var M=Object.defineProperty;var j=(r,l,t)=>l in r?M(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t;var c=(r,l,t)=>j(r,typeof l!="symbol"?l+"":l,t);import{j as n}from"./client-wT6vtYO_.js";import{i as C,r as x}from"./index-BdTwX--g.js";import{c as k}from"./index-DizoKcfL.js";import{B as S,j as y,I as L,aQ as N}from"./useSelectableClick-DeaJbL2_.js";import{P as I}from"./poll-CjurB963.js";import{l as b,B as T}from"./initial_state-BP3UcUr4.js";import{w as A}from"./short_number-WomMu2iV.js";import{M as g}from"./message-UFwkQlnu.js";const w=706;function E(r){return r.getIn(["translation","contentHtml"])||r.get("contentHtml")}class H extends x.PureComponent{render(){const{translation:l,onClick:t}=this.props;if(l){const s=T.find(e=>e[0]===l.get("detected_source_language")),o=s?s[1]:l.get("detected_source_language"),i=l.get("provider");return n.jsxs("div",{className:"translate-button",children:[n.jsx("div",{className:"translate-button__meta",children:n.jsx(g,{id:"status.translated_from_with",defaultMessage:"Translated from {lang} using {provider}",values:{lang:o,provider:i}})}),n.jsx("button",{className:"link-button",onClick:t,children:n.jsx(g,{id:"status.show_original",defaultMessage:"Show original"})})]})}return n.jsx("button",{className:"status__content__translate-button",onClick:t,children:n.jsx(g,{id:"status.translate",defaultMessage:"Translate"})})}}const X=r=>({languages:r.getIn(["server","translationLanguages","items"])});class R extends x.PureComponent{constructor(){super(...arguments);c(this,"handleMouseEnter",({currentTarget:t})=>{if(b)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let i=s[o];i.src=i.getAttribute("data-original")}});c(this,"handleMouseLeave",({currentTarget:t})=>{if(b)return;const s=t.querySelectorAll(".custom-emoji");for(var o=0;o<s.length;o++){let i=s[o];i.src=i.getAttribute("data-static")}});c(this,"onMentionClick",(t,s)=>{this.props.history&&s.button===0&&!(s.ctrlKey||s.metaKey)&&(s.preventDefault(),this.props.history.push(`/@${t.get("acct")}`))});c(this,"onHashtagClick",(t,s)=>{t=t.replace(/^#/,""),this.props.history&&s.button===0&&!(s.ctrlKey||s.metaKey)&&(s.preventDefault(),this.props.history.push(`/tags/${t}`))});c(this,"handleMouseDown",t=>{this.startXY=[t.clientX,t.clientY]});c(this,"handleMouseUp",t=>{if(!this.startXY)return;const[s,o]=this.startXY,[i,e]=[Math.abs(t.clientX-s),Math.abs(t.clientY-o)];let a=t.target;for(;a;){if(a.localName==="button"||a.localName==="a"||a.localName==="label")return;a=a.parentNode}i+e<5&&(t.button===0||t.button===1)&&t.detail>=1&&this.props.onClick&&this.props.onClick(t),this.startXY=null});c(this,"handleTranslate",()=>{this.props.onTranslate()});c(this,"setRef",t=>{this.node=t})}_updateStatusLinks(){const t=this.node;if(!t)return;const{status:s,onCollapsedToggle:o}=this.props,i=t.querySelectorAll("a");let e,a;for(var d=0;d<i.length;++d)e=i[d],!e.classList.contains("status-link")&&(e.classList.add("status-link"),a=this.props.status.get("mentions").find(u=>e.href===u.get("url")),a?(e.addEventListener("click",this.onMentionClick.bind(this,a),!1),e.setAttribute("title",`@${a.get("acct")}`),e.setAttribute("href",`/@${a.get("acct")}`),e.setAttribute("data-hover-card-account",a.get("id"))):e.textContent[0]==="#"||e.previousSibling&&e.previousSibling.textContent&&e.previousSibling.textContent[e.previousSibling.textContent.length-1]==="#"?(e.addEventListener("click",this.onHashtagClick.bind(this,e.text),!1),e.setAttribute("href",`/tags/${e.text.replace(/^#/,"")}`),e.setAttribute("data-menu-hashtag",this.props.status.getIn(["account","id"]))):(e.setAttribute("title",e.href),e.classList.add("unhandled-link")));if(s.get("collapsed",null)===null&&o){const{collapsible:u,onClick:h}=this.props,p=u&&h&&t.clientHeight>w&&s.get("spoiler_text").length===0;o(p)}}componentDidMount(){this._updateStatusLinks()}componentDidUpdate(){this._updateStatusLinks()}render(){var f;const{status:t,intl:s,statusContent:o}=this.props,i=this.props.onClick&&t.get("collapsed"),e=s.locale.replace(/[_-].*/,""),a=(f=this.props.languages)==null?void 0:f.get(t.get("language")||"und"),d=this.props.onTranslate&&this.props.identity.signedIn&&["public","unlisted"].includes(t.get("visibility"))&&t.get("search_index").trim().length>0&&(a==null?void 0:a.includes(e)),u={__html:o??E(t)},h=t.getIn(["translation","language"])||t.get("language"),p=k("status__content",{"status__content--with-action":this.props.onClick&&this.props.history,"status__content--collapsed":i}),v=i&&n.jsxs("button",{className:"status__content__read-more-button",onClick:this.props.onClick,children:[n.jsx(g,{id:"status.read_more",defaultMessage:"Read more"}),n.jsx(L,{id:"angle-right",icon:N})]},"read-more"),m=d&&n.jsx(H,{onClick:this.handleTranslate,translation:t.get("translation")}),_=!!t.get("poll")&&n.jsx(I,{pollId:t.get("poll"),status:t,lang:h});return this.props.onClick?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:p,ref:this.setRef,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[n.jsx("div",{className:"status__content__text status__content__text--visible translate",lang:h,dangerouslySetInnerHTML:u}),_,m]},"status-content"),v]}):n.jsxs("div",{className:p,ref:this.setRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,children:[n.jsx("div",{className:"status__content__text status__content__text--visible translate",lang:h,dangerouslySetInnerHTML:u}),_,m]})}}const G=A(S(y(X)(C(R))));export{G as S,E as g};
//# sourceMappingURL=status_content-CaIN8-0B.js.map
